<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VUE3工具函数源码解析 | 繁华中自律，落魄中自愈</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="javascript" href="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="Just playing around">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.b00b0d60.css" as="style"><link rel="preload" href="/assets/js/app.9cb6cb91.js" as="script"><link rel="preload" href="/assets/js/3.03642533.js" as="script"><link rel="preload" href="/assets/js/77.40f0c81e.js" as="script"><link rel="preload" href="/assets/js/18.5accd157.js" as="script"><link rel="preload" href="/assets/js/25.81b712db.js" as="script"><link rel="preload" href="/assets/js/8.419a7c8d.js" as="script"><link rel="prefetch" href="/assets/js/10.aa92fecb.js"><link rel="prefetch" href="/assets/js/11.a919d34c.js"><link rel="prefetch" href="/assets/js/12.46ab0c71.js"><link rel="prefetch" href="/assets/js/13.4e7e005b.js"><link rel="prefetch" href="/assets/js/14.04771986.js"><link rel="prefetch" href="/assets/js/15.92728e2b.js"><link rel="prefetch" href="/assets/js/16.4458c94c.js"><link rel="prefetch" href="/assets/js/17.1a61381f.js"><link rel="prefetch" href="/assets/js/19.7a01c125.js"><link rel="prefetch" href="/assets/js/20.74fae2ee.js"><link rel="prefetch" href="/assets/js/21.233abb32.js"><link rel="prefetch" href="/assets/js/22.5b04a247.js"><link rel="prefetch" href="/assets/js/23.14dc515c.js"><link rel="prefetch" href="/assets/js/24.987a94e0.js"><link rel="prefetch" href="/assets/js/26.423544f6.js"><link rel="prefetch" href="/assets/js/27.e01fca51.js"><link rel="prefetch" href="/assets/js/28.5219898f.js"><link rel="prefetch" href="/assets/js/29.39712b5b.js"><link rel="prefetch" href="/assets/js/30.87c0b45b.js"><link rel="prefetch" href="/assets/js/31.010117ff.js"><link rel="prefetch" href="/assets/js/32.52edddb9.js"><link rel="prefetch" href="/assets/js/33.a4172ed9.js"><link rel="prefetch" href="/assets/js/34.b6b6a002.js"><link rel="prefetch" href="/assets/js/35.f186d2ff.js"><link rel="prefetch" href="/assets/js/36.e5e39c4e.js"><link rel="prefetch" href="/assets/js/37.5374e732.js"><link rel="prefetch" href="/assets/js/38.ed31199c.js"><link rel="prefetch" href="/assets/js/39.a0f71283.js"><link rel="prefetch" href="/assets/js/4.73ddb48a.js"><link rel="prefetch" href="/assets/js/40.331843b6.js"><link rel="prefetch" href="/assets/js/41.11922ce9.js"><link rel="prefetch" href="/assets/js/42.0293ce66.js"><link rel="prefetch" href="/assets/js/43.17f5222e.js"><link rel="prefetch" href="/assets/js/44.a6e414b3.js"><link rel="prefetch" href="/assets/js/45.9380344f.js"><link rel="prefetch" href="/assets/js/46.6f93a39e.js"><link rel="prefetch" href="/assets/js/47.25a57560.js"><link rel="prefetch" href="/assets/js/48.437b3871.js"><link rel="prefetch" href="/assets/js/49.a1dd51e8.js"><link rel="prefetch" href="/assets/js/5.4957ea56.js"><link rel="prefetch" href="/assets/js/50.7d06ff09.js"><link rel="prefetch" href="/assets/js/51.2728fed0.js"><link rel="prefetch" href="/assets/js/52.c3c7dd89.js"><link rel="prefetch" href="/assets/js/53.6c852ac8.js"><link rel="prefetch" href="/assets/js/54.ae062372.js"><link rel="prefetch" href="/assets/js/55.75f465f1.js"><link rel="prefetch" href="/assets/js/56.5be80d04.js"><link rel="prefetch" href="/assets/js/57.1339366e.js"><link rel="prefetch" href="/assets/js/58.ccbcef2e.js"><link rel="prefetch" href="/assets/js/59.3d9af96d.js"><link rel="prefetch" href="/assets/js/6.249b89fa.js"><link rel="prefetch" href="/assets/js/60.e42f8579.js"><link rel="prefetch" href="/assets/js/61.07c4f876.js"><link rel="prefetch" href="/assets/js/62.58569e5d.js"><link rel="prefetch" href="/assets/js/63.0748a2c6.js"><link rel="prefetch" href="/assets/js/64.a3ee2ac2.js"><link rel="prefetch" href="/assets/js/65.a94a2a10.js"><link rel="prefetch" href="/assets/js/66.c8c7d1a9.js"><link rel="prefetch" href="/assets/js/67.b4e65dc2.js"><link rel="prefetch" href="/assets/js/68.6f38264a.js"><link rel="prefetch" href="/assets/js/69.4b1e3123.js"><link rel="prefetch" href="/assets/js/7.1d4ac482.js"><link rel="prefetch" href="/assets/js/70.34728be1.js"><link rel="prefetch" href="/assets/js/71.07093362.js"><link rel="prefetch" href="/assets/js/72.8be6356b.js"><link rel="prefetch" href="/assets/js/73.70c5efae.js"><link rel="prefetch" href="/assets/js/74.66a9e9d5.js"><link rel="prefetch" href="/assets/js/75.e7218f11.js"><link rel="prefetch" href="/assets/js/76.2113a1e4.js"><link rel="prefetch" href="/assets/js/78.6d35b888.js"><link rel="prefetch" href="/assets/js/79.4edf6c28.js"><link rel="prefetch" href="/assets/js/80.896984e2.js"><link rel="prefetch" href="/assets/js/81.e2503db8.js"><link rel="prefetch" href="/assets/js/82.d6b3a1ea.js"><link rel="prefetch" href="/assets/js/83.dfea4f37.js"><link rel="prefetch" href="/assets/js/84.292d1467.js"><link rel="prefetch" href="/assets/js/85.91a3d200.js"><link rel="prefetch" href="/assets/js/9.d687db5a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.9a91fc01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b00b0d60.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="繁华中自律，落魄中自愈" class="logo"> <span class="site-name can-hide">繁华中自律，落魄中自愈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Knowledge/" class="nav-link">知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/Info/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/bingbing.jpg"> <div class="blogger-info"><h3>石怜安</h3> <span>在线找大长腿小姐姐</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Knowledge/" class="nav-link">知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/Info/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=Knowledge" title="分类" data-v-1baff76c>Knowledge</a></li><li data-v-1baff76c><a href="/categories/?category=FrontEnd" title="分类" data-v-1baff76c>FrontEnd</a></li><li data-v-1baff76c><a href="/categories/?category=Vue" title="分类" data-v-1baff76c>Vue</a></li><li data-v-1baff76c><a href="/categories/?category=ToolFunction" title="分类" data-v-1baff76c>ToolFunction</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="404" target="_blank" title="作者" class="beLink" data-v-1baff76c>JSH</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-07-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="/dijia.jpg">VUE3工具函数源码解析<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>具体文件是 <code>shared.cjs.prod.js</code> 和 <code>shared.cjs.js</code> 文件下针对源码中的工具函数和较冷门知识点的提取分析。</p> <p>vue 版本为 3.2.31</p></div> <h2 id="常量定义"><a href="#常量定义" class="header-anchor">#</a> 常量定义</h2> <h3 id="empty-obj、empty-arr-对象"><a href="#empty-obj、empty-arr-对象" class="header-anchor">#</a> EMPTY_OBJ、EMPTY_ARR 对象</h3> <p>typescript是通过 <code>readonly</code> 的方式来定义一个冻结对象的类型的， <code>readonly</code> 是只读修饰符。 <code>Object.freeze</code> 冻结对象属性功能。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token constant">EMPTY_OBJ</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> __DEV__ <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token constant">EMPTY_ARR</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> __DEV__ <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> emptyObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">12</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  total<span class="token operator">:</span> <span class="token number">1000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 无法修改第一层属性</span>
emptyObj<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">0</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'emptyObj.total'</span><span class="token punctuation">,</span> emptyObj<span class="token punctuation">.</span>total<span class="token punctuation">)</span>
<span class="token comment">// 可以修改第二层对象的属性</span>
emptyObj<span class="token punctuation">.</span>props<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">13</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'emptyObj.props.age'</span><span class="token punctuation">,</span> emptyObj<span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
<span class="token comment">// 无法新建本不存在的属性</span>
emptyObj<span class="token punctuation">.</span>props2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'emptyObj.props2'</span><span class="token punctuation">,</span> emptyObj<span class="token punctuation">.</span>props2<span class="token punctuation">)</span>


<span class="token keyword">let</span> arr <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> arr1 <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'jack'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// arr.push(1) // 无法添加元素, 会直接报错</span>
arr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">3</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'arr'</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>
<span class="token comment">// 对象内的属性可以修改</span>
arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'rose'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'arr1[0].name'</span><span class="token punctuation">,</span> arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// rose</span>
</code></pre></div><h3 id="noop-空函数"><a href="#noop-空函数" class="header-anchor">#</a> NOOP 空函数</h3> <p>定义一个空函数，而不是 <code>function () {}</code> 这样定义，是为了方便压缩。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">NOOP</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> <span class="token function-variable function">obj</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">getName</span> <span class="token punctuation">(</span>cb <span class="token operator">=&gt;</span> <span class="token constant">NOOP</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="no-返回false常量函数"><a href="#no-返回false常量函数" class="header-anchor">#</a> NO 返回false常量函数</h3> <p>永远返回 <code>false</code> 的函数, 就是一个返回 <code>boolean</code> 值的函数的备选项</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">NO</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
</code></pre></div><h2 id="函数定义"><a href="#函数定义" class="header-anchor">#</a> 函数定义</h2> <h3 id="totypestring-复杂数据类型区分"><a href="#totypestring-复杂数据类型区分" class="header-anchor">#</a> toTypeString  复杂数据类型区分</h3> <p><code>toTypeString</code> 主要是返回数据的类型，使用了 <code>Object.prototype.toString.call</code> 的方法，实现了对复杂数据类型的区分</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> objectToString <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">toTypeString</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">objectToString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toTypeString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Object]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toTypeString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Array]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toTypeString</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Map]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toTypeString</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Set]</span>
</code></pre></div><h3 id="torawtype-取出数据类型"><a href="#torawtype-取出数据类型" class="header-anchor">#</a> toRawType 取出数据类型</h3> <p>这里需要注意的是前面的 <code>toTypeString</code> 返回了 <code>[object xxType]</code>，现在则是使用 <code>slice</code> 方法来将 <code>xxType</code> 取出</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> toRawType <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// extract &quot;RawType&quot; from strings like &quot;[object RawType]&quot;</span>
  <span class="token keyword">return</span> <span class="token function">toTypeString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> objectToString <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toString
<span class="token keyword">const</span> <span class="token function-variable function">toTypeString</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">objectToString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">toRawType</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">toRawType</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token comment">// 'String'</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">toRawType</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span> <span class="token comment">// 'Number'</span>
</code></pre></div><h3 id="ison-事件名on判断"><a href="#ison-事件名on判断" class="header-anchor">#</a> isOn 事件名on判断</h3> <p>利用正则来判断当前的事件名是否是 <code>on + EventName</code> 的格式</p> <p>注意: <code>^</code> 在正则开头表示首位占位符，其他地方都是非的含义，<code>[^a-z]</code> 表示不是 a 到 z 的字母</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> onRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^on[^a-z]</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isOn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> onRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</code></pre></div><h3 id="ismodellistener-事件名onupdate判断"><a href="#ismodellistener-事件名onupdate判断" class="header-anchor">#</a> isModelListener 事件名onUpdate判断</h3> <p>检验监听事件名是否是<code>onUpdate:</code>开头</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isModelListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'onUpdate:'</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><code>startsWith</code> 是 <code>es6</code> 当中的方法，可以获取一个字符串是否以指定的子字符串开头，返回Boolean类型</p></blockquote> <ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isModeListener</span><span class="token punctuation">(</span><span class="token string">'onUpdate:change'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="extend-合并对象"><a href="#extend-合并对象" class="header-anchor">#</a> extend 合并对象</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> extend <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'jack'</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'rose'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token comment">// { name: 'rose', age: 18 }</span>
<span class="token comment">// 注意, 原本的obj1也会被改变</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'obj1'</span><span class="token punctuation">,</span> obj1<span class="token punctuation">)</span> <span class="token comment">// { name: 'rose', age: 18 }</span>
</code></pre></div><h3 id="remove-删除数组元素"><a href="#remove-删除数组元素" class="header-anchor">#</a> remove 删除数组元素</h3> <p>删除数组中的某个元素，但是使用splice方法，其实是比较消耗性能的。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> remove <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> el<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> i <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token function">remove</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// [ 1, 3 ] 'arr数据'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token string">'arr数据'</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>axios源码中 <code>lib/core/interceptorManager.js</code> , 使用以下的方式删除数组中的元素:</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code>InterceptorManager<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eject</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">eject</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 第46行</span>
<span class="token comment">/**
 * Iterate over all the registered interceptors
 *
 * This method is particularly useful for skipping over any
 * interceptors that may have become `null` calling `eject`.
 *
 * @param {Function} fn The function to call for each interceptor
 */</span>
InterceptorManager<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">forEach</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  utils<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlers<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">forEachHandler</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <h3 id="hasown-是否包含属性"><a href="#hasown-是否包含属性" class="header-anchor">#</a> hasOwn 是否包含属性</h3> <p>判断一个属性是否是一个对象本身的属性，利用了 <code>Object.prototype.hasOwnProperty.call</code> 的形式来实现功能</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> hasOwnProperty <span class="token operator">=</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty

<span class="token comment">/**
 * Vue3 的写法
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> hasOwn <span class="token operator">=</span> <span class="token punctuation">(</span>
  val<span class="token operator">:</span> object<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span>
<span class="token punctuation">)</span><span class="token operator">:</span> key <span class="token keyword">is</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> val <span class="token operator">=&gt;</span> <span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> key<span class="token punctuation">)</span>

<span class="token comment">/**
 * Vue3.2 的写法
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> hasOwn <span class="token operator">=</span> <span class="token punctuation">(</span>
  val<span class="token operator">:</span> object<span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span>
<span class="token punctuation">)</span><span class="token operator">:</span> key <span class="token keyword">is</span> <span class="token builtin">never</span> <span class="token operator">=&gt;</span> <span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <ul><li><code>is</code> 关键字：它被称为类型谓词，用来判断一个变量属于某个接口或类型，比如：</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> isNumber <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">number</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'number'</span>
<span class="token keyword">const</span> isString <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'string'</span>
</code></pre></div><ul><li><code>keyof</code> 关键字：用于获取某种类型的所有键，其返回类型是联合类型，比如：</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">K</span></span> <span class="token operator">=</span> <span class="token keyword">keyof</span> Person<span class="token punctuation">;</span> <span class="token comment">// &quot;name&quot; | &quot;age&quot;</span>
</code></pre></div><ul><li><code>typeof</code> 关键字：js 中的 typeof 只能获取几种类型，而在 ts 中 typeof 用来获取一个变量声明或对象的类型，比如：</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">const</span> sem<span class="token operator">:</span> Person <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'semlinker'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Sem</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> sem<span class="token punctuation">;</span> <span class="token comment">// -&gt; Person</span>
</code></pre></div></div> <h3 id="isarray-是否数组"><a href="#isarray-是否数组" class="header-anchor">#</a> isArray 是否数组</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isArray <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">:</span> arg <span class="token keyword">is</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> fakeArray <span class="token operator">=</span> <span class="token punctuation">{</span> __proto__<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> length<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'isArray(fakeArray)'</span><span class="token punctuation">,</span> <span class="token function">isArray</span><span class="token punctuation">(</span>fakeArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fakeArray instanceof Array'</span><span class="token punctuation">,</span> fakeArray <span class="token keyword">instanceof</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="ismap-isset-是否map-set"><a href="#ismap-isset-是否map-set" class="header-anchor">#</a> isMap/isSet 是否Map/Set</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isMap <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> Map<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Map]'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> isSet <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> Set<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token function">toTypeString</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Set]'</span>
</code></pre></div><h4 id="map"><a href="#map" class="header-anchor">#</a> Map</h4> <p>Map 是一种 <code>es6</code> 提供的新的一种键值对数据结构的数据类型，相比于对象，它的键不同于对象那种只能是字符串的键，可以是各种类型。</p> <ul><li>基础方法</li></ul> <blockquote><p><code>get</code> 获取元素，
<code>set</code> 新增元素成员，
<code>has</code> 是否包含某元素，
<code>delete</code> 删除元素成员，
<code>clear</code> 清空所有元素，
<code>Array.from</code> 转为普通的二维数组</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// 1. 定义一个函数作为键</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is function'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'jack'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fn<span class="token punctuation">,</span> <span class="token string">'我是函数的值'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 形式上, Map类型是二维数组</span>

<span class="token comment">// 2. get方法获取元素</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'func -&gt; result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
<span class="token comment">// func -&gt; result 我是函数的值</span>

<span class="token comment">// 3. 通过Array.from可以转为普通的二维数组</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'func -&gt; arr'</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>
<span class="token comment">// func -&gt; arr [ [ 'jack', 100 ], [ [Function: func], '我是函数的值' ] ]</span>

<span class="token comment">// 4. set方法新增元素成员</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'jack'</span> <span class="token punctuation">}</span>
m<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'28岁了都'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set新元素之后'</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
<span class="token comment">// set新元素之后 Map {</span>
<span class="token comment">// 'jack' =&gt; 100,</span>
<span class="token comment">//  [Function: func] =&gt; '我是函数的值',</span>
<span class="token comment">//  { name: 'jack' } =&gt; '28岁了都' }</span>

<span class="token comment">// 5. has 判断是否包含某元素</span>
m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'func -&gt; m.has(fn)'</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// 6. delete删除元素成员</span>
m<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除后的结果'</span><span class="token punctuation">,</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 删除后的结果 [ [ 'jack', 100 ], [ [Function: func], '我是函数的值' ] ]</span>

<span class="token comment">// 7. clear清空所有元素</span>
m<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'清空后的结果'</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
</code></pre></div><ul><li>遍历相关的方法</li></ul> <blockquote><p><code>keys</code> 返回包含映射中 <strong>键</strong> 的迭代器对象，<code>entries</code> 返回包含映射中的 <strong>键值</strong> 的迭代器对象，<code>values</code> 返回包含映射中的 <strong>值</strong> 的迭代器对象，<code>forEach</code></p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is function'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'jack'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>fn<span class="token punctuation">,</span> <span class="token string">'我是函数的值'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
m<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'forEach -&gt; item'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * forEach -&gt; item 100
 * forEach -&gt; item 我是函数的值
 */</span>


<span class="token comment">// 1. keys 方法, 返回包含映射中键的迭代器对象</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'it'</span><span class="token punctuation">,</span> it<span class="token punctuation">)</span> <span class="token comment">// it [Map Iterator] { 'jack', [Function: func] }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// jack</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// [Function: func]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token comment">// 或者</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; key'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 
  for...of... -&gt; key jack
  for...of... -&gt; key function func() {
    console.log('this is function');
  }
 */</span>

<span class="token comment">// 2. entries 方法, 返回包含映射中的键值的迭代器对象</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// [ 'jack', 100 ]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// [ [Function: func], '我是函数的值' ]</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token comment">// 或者</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; entries'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * for...of... -&gt; entries [ 'jack', 100 ]
 * for...of... -&gt; entries [ [Function: func], '我是函数的值' ]
 */</span>

<span class="token comment">// 3. values 方法, 返回包含映射中的值的迭代器对象</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 100</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 我是函数的值</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token comment">// 或者</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; value'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// /**</span>
<span class="token comment">//  * for...of... -&gt; value 100</span>
<span class="token comment">//  * for...of... -&gt; value 我是函数的值</span>
<span class="token comment">//  */</span>
</code></pre></div><div class="custom-block theorem"><p class="title">Map和Object的区别:</p><ul><li>Map的键可以是<code>任意类型</code>, Object只能是 <code>String</code> 或者 <code>Symbol</code></li> <li>Map的可以通过<code>size</code>属性获取元素数量, Object则必须<code>手动计算</code></li> <li>Map在频繁<code>增减键值对</code>的场景下, <code>性能较好</code></li> <li>Map中的数据是<code>有序</code>的, 而Object则是<code>无序</code>的</li></ul></div><h4 id="set"><a href="#set" class="header-anchor">#</a> Set</h4> <p>Set类型是<code>es6</code>提供的一种新的数据类型，它允许你存入 <code>任意类型</code> 的 <code>唯一值</code> ，无论是 <code>基本数据类型</code> 还是 <code>引用类型</code> ，尽管NaN !== NaN，Set仍然认为这是同一个数据。</p> <ul><li>基础方法</li></ul> <blockquote><p><code>add</code> 新增元素成员，
<code>has</code> 是否包含某元素，
<code>delete</code> 删除元素成员，
<code>clear</code> 清空所有元素，
<code>Array.from</code> 转为数组</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// 1. NaN</span>
<span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 尽管NaN !== NaN, 但是, 在Set中仍然被认为是相同的数据</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NaN === NaN'</span><span class="token punctuation">,</span> <span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span> set<span class="token punctuation">)</span> <span class="token comment">// Set {NaN}</span>

<span class="token comment">// 2.add 方法</span>
<span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'大明'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> person2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'小明'</span>
<span class="token punctuation">}</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'add的结果'</span><span class="token punctuation">,</span> set<span class="token punctuation">)</span>
<span class="token comment">// add的结果 Set { { name: '大明' }, { name: '小明' } }</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Array.from'</span><span class="token punctuation">,</span> <span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// Array.from [ { name: '大明' }, { name: '小明' } ]</span>

<span class="token comment">// 3. delete方法</span>
set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'delete之后'</span><span class="token punctuation">,</span> set<span class="token punctuation">)</span> <span class="token comment">// delete之后 Set { { name: '小明' } }</span>

<span class="token comment">// 4. has方法</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'has person1 --&gt;'</span><span class="token punctuation">,</span> set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>person1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// has person1 --&gt; false</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'has person2 --&gt;'</span><span class="token punctuation">,</span> set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>person2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// has person2 --&gt; true</span>

<span class="token comment">// 5.清空</span>
set<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'set clear --&gt;'</span><span class="token punctuation">,</span> set<span class="token punctuation">)</span> <span class="token comment">// set clear --&gt; Set {}</span>
</code></pre></div><ul><li>遍历相关的方法</li></ul> <blockquote><p>主要有<code>keys</code>，<code>entries</code>，<code>values</code>，<code>forEach</code></p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// 1. keys方法</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// { name: '大明' }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// { name: '小明' }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token comment">// 或者</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; keys'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * for...of... -&gt; keys { name: '大明' }
 * for...of... -&gt; keys { name: '小明' }
 */</span>

<span class="token comment">// 2. entries 方法</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// SetIterator {{…} =&gt; {…}, {…} =&gt; {…}}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; entries'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * for...of... -&gt; entries [ { name: '大明' }, { name: '大明' } ]
 * for...of... -&gt; entries [ { name: '小明' }, { name: '小明' } ]
 */</span>

<span class="token comment">// 3. values</span>
<span class="token keyword">let</span> it <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// SetIterator {{…}, {…}}</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// { name: '大明' }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// { name: '小明' }</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token comment">// 或者</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> it<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for...of... -&gt; values'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * for...of... -&gt; values { name: '大明' }
 * for...of... -&gt; values { name: '小明' }
 */</span>

<span class="token comment">// 4. forEach</span>
set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * item { name: '大明' }
 * item { name: '小明' }
 */</span>
</code></pre></div><h3 id="isdate-是否时间"><a href="#isdate-是否时间" class="header-anchor">#</a> isDate 是否时间</h3> <ul><li>源码实现 <span class="badge error" style="vertical-align:top;" data-v-d5affa18>有风险</span></li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isDate <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> Date <span class="token operator">=&gt;</span> val <span class="token keyword">instanceof</span> <span class="token class-name">Date</span>
</code></pre></div><p>这么做有一定的漏洞，但一般还是可以判断</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">isDate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token keyword">instanceof</span> <span class="token class-name">Date</span>
<span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">isDate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> __proto__<span class="token operator">:</span> Date<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> length<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// result true</span>
</code></pre></div><h3 id="isfunction-是否函数"><a href="#isfunction-是否函数" class="header-anchor">#</a> isFunction 是否函数</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isFunction <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">Function</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'function'</span>
</code></pre></div><h3 id="isobject-是否对象"><a href="#isobject-是否对象" class="header-anchor">#</a> isObject 是否对象</h3> <ul><li>注意事项</li></ul> <blockquote><p><code>typeof null === 'object'</code>，所以必须确保val不为null。</p> <p><code>Record</code>是 <code>typescript</code> 中的一种工具类型，它的作用是限制一个对象的键值类型，其两个泛型参数就是一个限制键类型，一个限制值类型。</p></blockquote> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> Record<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> val <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'object'</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// 第1469行代码</span>
<span class="token keyword">type</span> <span class="token class-name">Record<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 从这里我们可以看出, 键的类型只能从K(第一个泛型参数中得到), 而值的类型只能是T</span>
</code></pre></div><p>Record使用案例:</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">Animal</span> <span class="token operator">=</span> <span class="token string">'dog'</span> <span class="token operator">|</span> <span class="token string">'cat'</span> <span class="token operator">|</span> <span class="token string">'pig'</span>

<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">AnimalInfo</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span>Animal<span class="token punctuation">,</span> Info<span class="token operator">&gt;</span>

<span class="token comment">// animalInfo的键, 只能是dog, cat, pig中的一个</span>
<span class="token keyword">const</span> animalInfo<span class="token operator">:</span> AnimalInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
  dog<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'阿旺'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  cat<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'阿花'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  pig<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'二师兄'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">3</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <h3 id="isplainobject-是否纯粹对象"><a href="#isplainobject-是否纯粹对象" class="header-anchor">#</a> isPlainObject 是否纯粹对象</h3> <p>该方法作用是，判断一个对象<code>是否是纯粹的对象</code>，前面一个isObject方法，<code>isObject([])是true</code>，<code>isObject({})也是true</code>，而此处的isPlainObject则仅限于真正的Object。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isPlainObject <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> object <span class="token operator">=&gt;</span> <span class="token function">toTypeString</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span>
</code></pre></div><h3 id="ispromise-是否promise"><a href="#ispromise-是否promise" class="header-anchor">#</a> isPromise 是否Promise</h3> <p>判断是否是promise对象，这里要注意的是Promise的类型，typescript 中 <code>Promise&lt;T&gt;</code> 类型，接受一个<code>泛型参数T</code>，用以确定这个promise对象最终<code>resolve的值的类型</code>。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isPromise <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=&gt;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>then<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>val<span class="token punctuation">.</span>catch<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>我们如何控制声明Promise返回值的类型:</p> <ul><li>使用这里的泛型方式声明</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> promiseString<span class="token operator">:</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> promiseNumber<span class="token operator">:</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>单独声明resolve方法</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> promiseString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function-variable function">resolve</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="isintegerkey-是否数字型的字符串"><a href="#isintegerkey-是否数字型的字符串" class="header-anchor">#</a> isIntegerKey 是否数字型的字符串</h3> <p>主要是用于判断是否是数字型的字符串，形如: '123'，'888' 则为true，'123hello'则为false。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> isString <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> val <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">'string'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isIntegerKey</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">isString</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
  key <span class="token operator">!==</span> <span class="token string">'NaN'</span> <span class="token operator">&amp;&amp;</span>
  key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'-'</span> <span class="token operator">&amp;&amp;</span>
  <span class="token string">''</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">===</span> key
<span class="token function">isIntegerKey</span><span class="token punctuation">(</span><span class="token string">'888hello'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>parseInt 的第一个参数大家都很熟悉，就是要被转换的字符串，但是第二个出现的概率可能相对偏低，第二个表示的就是<code>进制</code>，一般<code>默认是10</code>，也就是十进制！
这里指明进制数是为了保证在不同的环境下运行结果能保证一致！</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// 以二进制的方式解析'010'</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token comment">// 我们都知道，如果 '010'是二进制，那么，转为10进制，就是使用: 0*2^0 + 1*2^1 + 0*2^2 结果自然就是2，同理我们可以知道用三进制来解析：</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 结果自然就是3</span>
</code></pre></div><span class="badge tip" style="vertical-align:top;" data-v-d5affa18>思考</span> <p>第二个参数的取值最大能达到多少？</p> <span class="badge warning" style="vertical-align:top;" data-v-d5affa18>猜测</span> <p>我们知道，十进制最大的数也就是9，那么如果我要解析十进制以上的数字呢？
最常见的就是十六进制。不错，我们会用字母代替！也就是a-z，共26个字母，那么我们大胆猜测下，最大取值，是不是就是36？</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// 36</span>
<span class="token comment">// 那再往上加一呢:</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// NaN</span>
</code></pre></div><p>由此我们得知, parseInt最多只能取到36!</p></div> <h3 id="makemap-构造带逗号的字符串校验字符函数"><a href="#makemap-构造带逗号的字符串校验字符函数" class="header-anchor">#</a> makeMap 构造带逗号的字符串校验字符函数</h3> <p>该方法主要是接收一个<code>带逗号的字符串</code>，将该字符串以<code>逗号拆分</code>为一个个子字符串，再用这些子字符串作为一个对象的<code>键</code>，<code>值全部为true</code>；返回一个方法，这个方法可以检测出这个方法接收的参数是否是对象中的键。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>
  str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  expectsLowerCase<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">boolean</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> map<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> list<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">[</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> expectsLowerCase <span class="token operator">?</span> val <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>map<span class="token punctuation">[</span>val<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">:</span> val <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>map<span class="token punctuation">[</span>val<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>难点解析</li></ul> <p>类型上来看，其实就是一个这样的方法：<code>(params1:string, params2?:boolean) =&gt; (key: string) =&gt; boolean</code>，其返回了一个检测函数，该检测函数接受一个字符串，返回是该字符串是否存在！</p> <ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span><span class="token string">'dog,cat,bird'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'fish'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span> <span class="token comment">// false, 不存在fish</span>
<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span> <span class="token comment">// true, 存在dog</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <span class="badge tip" style="vertical-align:top;" data-v-d5affa18>思考</span> <p>创建对象为何要用 <code>Object.create(null)</code> 而不是直接使用 <code>const map = {}</code></p> <span class="badge warning" style="vertical-align:top;" data-v-d5affa18>解答</span> <p><code>Object.create(proto, [propertiesObject])</code>，返回一个新的对象。第一个参数<code>proto</code>，将会被挂在到<code>新对象的原型对象</code>上。
第二个参数<code>propertiesObject</code>，对应了<code>Object.defineProperties</code>的第二个参数，也就是所谓的属性描述符:</p> <ul><li>value 属性的值</li> <li>writable 是否可以写，默认为true</li> <li>enumerable  属性是否可枚举, 所谓可枚举，就是能够被以下方法访问到</li> <li>for...in 能将该属性遍历出来</li> <li>Object.keys 能将该属性包含在返回的数组中</li> <li>JSON.stringify 能够将其变为JSON字符串的一部分</li> <li>configurable 默认true，如果为false，则属性无法被改变，无法被删除，无法修改属性描述符</li> <li>set 存值函数</li> <li>get 取值函数</li></ul> <p>我们可以看到，<code>Object.create(null)</code>创建的对象更为纯粹，当方法执行到<code>map[val.toLowerCase()]</code>时，不会受到<code>__proto__</code>的影响。</p></div> <h3 id="cachestringfunction-缓存结果函数"><a href="#cachestringfunction-缓存结果函数" class="header-anchor">#</a> cacheStringFunction 缓存结果函数</h3> <p>函数<code>返回一个函数</code>，这个函数接收<code>一个字符串</code>参数，如果第一次传入了一个参数，计算结果就会被<code>闭包``缓存</code>起来，下次再遇到相同参数的时候，就不会再走<code>fn方法重新计算</code>了。
本质上是一个<code>单例模式</code>，利用闭包，保存了之前的计算结果。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> cacheStringFunction <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>fn<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cache<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hit <span class="token operator">=</span> cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span>
    <span class="token keyword">return</span> hit <span class="token operator">||</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>str<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> fn1 <span class="token operator">=</span> <span class="token function">cacheStringFunction</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'通过了计算得到'</span><span class="token punctuation">,</span> key <span class="token operator">+</span> <span class="token string">'world'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">'world'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token string">'goodbye'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 
 * 通过了计算得到 helloworld
 * helloworld
 * helloworld
 * 通过了计算得到 goodbyeworld
 * goodbyeworld
 */</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <span class="badge tip" style="vertical-align:top;" data-v-d5affa18>思考</span> <p>为何返回的函数要被<code>as any</code>？去掉会如何？</p> <span class="badge warning" style="vertical-align:top;" data-v-d5affa18>猜测</span> <p><code>(str:string) =&gt; string</code> 是符合 <code>T</code> 的类型要求，但是，<code>T</code>也可以是另一种形式的<code>子类</code>，也就无法保证和参数的类型完全一致。举个例子，假如以下函数不报错：</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> testGenerics <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> minNum<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> minNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> params
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> length<span class="token operator">:</span> minNum <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">T</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那我们直接运行下</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token function">testGenerics</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">// 此时的data,讲道理应该是Array类型</span>
data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 直接报错, 因为根本就不是数组!</span>
</code></pre></div></div> <h3 id="camelize-驼峰转化"><a href="#camelize-驼峰转化" class="header-anchor">#</a> camelize 驼峰转化</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> camelizeRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-(\w)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span>
<span class="token keyword">export</span> <span class="token keyword">const</span> camelize <span class="token operator">=</span> <span class="token function">cacheStringFunction</span><span class="token punctuation">(</span><span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>camelizeRE<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>c <span class="token operator">?</span> c<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'on-handle-click'</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// result onHandleClick</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>关于replace的使用: <code>replace(regexp|substr, newSubStr|function)</code></p> <blockquote><p>第一个参数既可以是<code>字符串</code>，也可以是<code>正则</code>，总之就是需要<code>被替换的字符串的文本模式</code>。</p> <p>第二个参数，它既可以是用于<code>替换掉</code>第一个参数在原字符串中的匹配部分的<code>字符串</code>（该字符串中可以内插一些<code>特殊的变量名</code>），也可以是一个用来创建新子字符串的<code>函数</code>，该函数的返回值将替换掉第一个参数匹配到的结果。</p></blockquote> <ul><li>正则替换表达式</li></ul> <blockquote><p>$&amp; 用于无分组的情况</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'史记真是史家之绝唱,无韵之离骚'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'史记'</span><span class="token punctuation">,</span> <span class="token string">'《$&amp;》'</span><span class="token punctuation">)</span> <span class="token comment">// 这里的$&amp;就是`史记`二字, 也就是用《史记》代替史记</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// 《史记》真是史家之绝唱,无韵之离骚</span>
</code></pre></div><blockquote><p>$` 匹配到的数据的左边字符串</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'研究一下replace该怎么用'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'replace'</span><span class="token punctuation">,</span> <span class="token string">',$`前端技术'</span><span class="token punctuation">)</span> <span class="token comment">// 这里的 $` === 研究一下，也就是用 ',研究一下前端技术' 代替 'replace' </span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// 研究一下,研究一下前端技术该怎么用</span>
</code></pre></div><blockquote><p>$' 和 $` 相反，代表匹配到的数据的右边字符串</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'研究一下replace该怎么用'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'replace'</span><span class="token punctuation">,</span> <span class="token string">&quot;,vue3$',&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 此处的 $' === 该怎么用，也就是用 ',vue3该怎么用,' 代替 'replace'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token comment">// 研究一下,vue3该怎么用,该怎么用</span>
</code></pre></div><blockquote><p>$1,$2,$3,.....$n，表示第几个分组</p></blockquote> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'西瓜,番薯,大番薯,咸鱼,萝卜,苹果'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(西瓜)(.*)(苹果)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;$1(水果)$2$3(水果)&quot;</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * $1 === 西瓜
 * $2 === ,番薯,大番薯,咸鱼,萝卜,
 * $3 === 苹果
 */</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token comment">// 西瓜(水果),番薯,大番薯,咸鱼,萝卜,苹果(水果)</span>
</code></pre></div><ul><li>函数</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'今年是2022年,时间好快'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(今年).+?(时间).*</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
  <span class="token comment">/**
   * 0: &quot;今年是2022年,时间好快&quot;
   * 1: &quot;今年&quot;
   * 2: &quot;时间&quot;
   * 3: 0
   * 4: &quot;今年是2022年,时间好快&quot;
   */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以得出结论，那就是<code>有分组</code>的情况下，第二个参数开始就是<code>依次展示</code>每次分组<code>匹配到的内容</code>。
所以，我们回到源码中，此处的<code>c</code>，实际上就是前面说的每次匹配到的<code>第一个分组</code>，本案例中依次为：h, c两个，然后将其改为大写，直接return，就能将<code>-x</code>替换为<code>X</code>，从而实现我们的目标。</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'on-handle-click'</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-(\w)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
  <span class="token comment">// { '0': '-h', '1': 'h', '2': 2, '3': 'on-handle-click' }</span>
  <span class="token comment">// { '0': '-c', '1': 'c', '2': 9, '3': 'on-handle-click' }</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>camelizeRE<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>c <span class="token operator">?</span> c<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <h3 id="haschanged-比较变量相同"><a href="#haschanged-比较变量相同" class="header-anchor">#</a> hasChanged 比较变量相同</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// compare whether a value has changed, accounting for NaN.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> hasChanged <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> oldValue<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>Object<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>可能有人感到疑问，两个值是否不同还需要封装？多此一举，我直接 <code>a !== b</code> 不就行了？我们来看几个例子：</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// +0 和 -0问题</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
Object<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// NaN 问题</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
Object<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>由此可以看出，<code>Object.is</code>可以弥补 <code>正负0</code> 和 <code>NaN</code> 比较上存在的问题。MDN网站上还提供了一个<code>polyfill</code>：</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code>Object<span class="token punctuation">.</span><span class="token function-variable function">is</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	 <span class="token comment">// 如果两个值不同(有可能是正负0)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token operator">/</span>x <span class="token operator">===</span> <span class="token number">1</span><span class="token operator">/</span>y
    <span class="token comment">/**
     * 如果x,y分别为+0 和 -0, 那么, 一个将会是Infinity 另一个是-Infinity
     */</span>
    <span class="token comment">// 如果不同, 也可能是NaN</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 自己都不等于自己, 那肯定是NaN了</span>
    <span class="token keyword">return</span> x <span class="token operator">!==</span> x <span class="token operator">&amp;&amp;</span> y <span class="token operator">!==</span>y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'NaN === NaN --&gt;'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'+0 === -0 --&gt;'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token keyword">is</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// NaN === NaN --&gt; true ⠼ : timing npm:load:cleanupLog Completed in 2ms</span>
<span class="token comment">// +0 === -0 --&gt; false</span>
</code></pre></div></div> <h3 id="def-添加不可枚举属性"><a href="#def-添加不可枚举属性" class="header-anchor">#</a> def 添加不可枚举属性</h3> <p>就是给对象<code>obj</code>，加上一个<code>可以删除</code>，其属性描述符<code>可以改变</code>，且<code>不可枚举的属性key</code>，其值为<code>value</code>。</p> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">def</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token operator">:</span> object<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    value
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用案例</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'human'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">100</span>
<span class="token punctuation">}</span>
<span class="token function">def</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token string">'gender'</span><span class="token punctuation">,</span> <span class="token string">'male'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'person --&gt; '</span><span class="token punctuation">,</span> person<span class="token punctuation">)</span> 
<span class="token comment">/**
 * nodejs 环境下 { name: 'human', age: 100 }
 * chrome 浏览器下 { name: 'human', age: 100, gender: 'male' }
 *  */</span> 
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'gender --&gt; '</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>gender<span class="token punctuation">)</span> <span class="token comment">// male</span>
</code></pre></div><p>测试可枚举性，按照我们之前说的<code>for...in</code>，<code>Object.keys</code>，<code>JSON.stringify</code>三种方法</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token comment">// for...in</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token comment">/**
   * key name
   * key age
   */</span>
<span class="token punctuation">}</span>

<span class="token comment">// JSON.stringify</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'JSON.stringify(person)'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {&quot;name&quot;:&quot;human&quot;,&quot;age&quot;:100}</span>

<span class="token comment">// Object.keys(person)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Object.keys(person)'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [ 'name', 'age' ]</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>属性描述符可以细分为<code>数据描述符</code>和<code>存取描述符</code>。注意，configurable 和 enumerable既是数据描述符又是存取描述符。除了这两个属性之外，其他不同的描述符不得共用！</p> <p>数据描述符：<code>writable</code> 只有writable为true的时候，该属性才能被改变值。 <code>value</code> 属性的值</p> <p>存取描述符： <code>get</code>，<code>set</code></p></div> <h3 id="tonumber-尝试转换数字"><a href="#tonumber-尝试转换数字" class="header-anchor">#</a> toNumber 尝试转换数字</h3> <ul><li>源码实现</li></ul> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> toNumber <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">?</span> val <span class="token operator">:</span> n
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>isNaN一看字面意思就知道: 判断一个值是否为NaN. 但他有一些怪异行为, 例如:</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'haha'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>很明显, 这个方法关心的根本不是一个值是否是NaN, 它似乎更关心一个值是否无法被转为数字! 所以, 我们有了Number.isNaN</p> <div class="language-TypeScript extra-class"><pre class="language-typescript"><code>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'haha'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><p>所以, 一定要注意了, <code>isNaN</code>和<code>Number.isNaN</code>不是一回事!</p></div></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Vue%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" title="标签">#Vue源码分析</a></div> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">7/22/2022, 3:41:31 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/Draw/Svg/"><div>
            Svg 入门
            <!----></div></a> <span class="date">08-19</span></dt></dl><dl><dd>02</dd> <dt><a href="/InterviewQuestion/FrontEnd/LRU/"><div>
            请使用JS完成一个LRU缓存
            <!----></div></a> <span class="date">08-18</span></dt></dl><dl><dd>03</dd> <dt><a href="/Vue/Component/"><div>
            VUE3组件库
            <!----></div></a> <span class="date">08-18</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="String" title="1051131737" target="_blank" class="iconfont icon-QQ"></a><a href="String" title="1051131737@qq.com" target="_blank" class="iconfont icon-youjian"></a><a href="String" title="jsh1051131737" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>JSH</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.9cb6cb91.js" defer></script><script src="/assets/js/3.03642533.js" defer></script><script src="/assets/js/77.40f0c81e.js" defer></script><script src="/assets/js/18.5accd157.js" defer></script><script src="/assets/js/25.81b712db.js" defer></script><script src="/assets/js/8.419a7c8d.js" defer></script>
  </body>
</html>
