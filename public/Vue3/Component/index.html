<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VUE3组件库 | 繁华中自律，落魄中自愈</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="javascript" href="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <meta name="description" content="Just playing around">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.ef7b7088.css" as="style"><link rel="preload" href="/assets/js/app.7b063f2c.js" as="script"><link rel="preload" href="/assets/js/3.904774fa.js" as="script"><link rel="preload" href="/assets/js/74.952acfac.js" as="script"><link rel="preload" href="/assets/js/24.68206407.js" as="script"><link rel="preload" href="/assets/js/8.4300a81b.js" as="script"><link rel="prefetch" href="/assets/js/10.44cba04b.js"><link rel="prefetch" href="/assets/js/11.4e2ffac4.js"><link rel="prefetch" href="/assets/js/12.f615d765.js"><link rel="prefetch" href="/assets/js/13.445f1347.js"><link rel="prefetch" href="/assets/js/14.c329a67c.js"><link rel="prefetch" href="/assets/js/15.3c0dba35.js"><link rel="prefetch" href="/assets/js/16.c25e1396.js"><link rel="prefetch" href="/assets/js/17.7f5f0603.js"><link rel="prefetch" href="/assets/js/18.8bf30a4e.js"><link rel="prefetch" href="/assets/js/19.1290aca5.js"><link rel="prefetch" href="/assets/js/20.fa601d6a.js"><link rel="prefetch" href="/assets/js/21.12b635ac.js"><link rel="prefetch" href="/assets/js/22.c58de2b6.js"><link rel="prefetch" href="/assets/js/23.d85d8e29.js"><link rel="prefetch" href="/assets/js/25.713868dc.js"><link rel="prefetch" href="/assets/js/26.2e8fb324.js"><link rel="prefetch" href="/assets/js/27.3ce61bd0.js"><link rel="prefetch" href="/assets/js/28.142ab1ea.js"><link rel="prefetch" href="/assets/js/29.5a884ea0.js"><link rel="prefetch" href="/assets/js/30.b46be45c.js"><link rel="prefetch" href="/assets/js/31.d00089f7.js"><link rel="prefetch" href="/assets/js/32.638f26a2.js"><link rel="prefetch" href="/assets/js/33.ce22f61d.js"><link rel="prefetch" href="/assets/js/34.18a0de9f.js"><link rel="prefetch" href="/assets/js/35.422d341a.js"><link rel="prefetch" href="/assets/js/36.bd5637de.js"><link rel="prefetch" href="/assets/js/37.aafcad17.js"><link rel="prefetch" href="/assets/js/38.b6032a0e.js"><link rel="prefetch" href="/assets/js/39.97f54870.js"><link rel="prefetch" href="/assets/js/4.bc920e45.js"><link rel="prefetch" href="/assets/js/40.560b205c.js"><link rel="prefetch" href="/assets/js/41.442df3db.js"><link rel="prefetch" href="/assets/js/42.af8ce086.js"><link rel="prefetch" href="/assets/js/43.ef654c77.js"><link rel="prefetch" href="/assets/js/44.77dddeab.js"><link rel="prefetch" href="/assets/js/45.142dab35.js"><link rel="prefetch" href="/assets/js/46.212e13ae.js"><link rel="prefetch" href="/assets/js/47.9c98ef0f.js"><link rel="prefetch" href="/assets/js/48.d320e3fe.js"><link rel="prefetch" href="/assets/js/49.f0cad698.js"><link rel="prefetch" href="/assets/js/5.af9040d6.js"><link rel="prefetch" href="/assets/js/50.2d978d94.js"><link rel="prefetch" href="/assets/js/51.f10a7a24.js"><link rel="prefetch" href="/assets/js/52.9a4a6bc1.js"><link rel="prefetch" href="/assets/js/53.5a6b3eb8.js"><link rel="prefetch" href="/assets/js/54.427823a6.js"><link rel="prefetch" href="/assets/js/55.9f18902f.js"><link rel="prefetch" href="/assets/js/56.3f3b2be2.js"><link rel="prefetch" href="/assets/js/57.e3d50c28.js"><link rel="prefetch" href="/assets/js/58.a04912fb.js"><link rel="prefetch" href="/assets/js/59.3b8e4622.js"><link rel="prefetch" href="/assets/js/6.8abb545e.js"><link rel="prefetch" href="/assets/js/60.e41690ae.js"><link rel="prefetch" href="/assets/js/61.3fc15bc2.js"><link rel="prefetch" href="/assets/js/62.5f27984f.js"><link rel="prefetch" href="/assets/js/63.ae4b88b8.js"><link rel="prefetch" href="/assets/js/64.75dd8b29.js"><link rel="prefetch" href="/assets/js/65.ccf8d9a3.js"><link rel="prefetch" href="/assets/js/66.8d840a2c.js"><link rel="prefetch" href="/assets/js/67.fc620d06.js"><link rel="prefetch" href="/assets/js/68.ff85d5fe.js"><link rel="prefetch" href="/assets/js/69.1377c5a9.js"><link rel="prefetch" href="/assets/js/7.422ae0ef.js"><link rel="prefetch" href="/assets/js/70.f3345bca.js"><link rel="prefetch" href="/assets/js/71.3f9b43a1.js"><link rel="prefetch" href="/assets/js/72.ebe9f060.js"><link rel="prefetch" href="/assets/js/73.f54fac25.js"><link rel="prefetch" href="/assets/js/75.b4f24805.js"><link rel="prefetch" href="/assets/js/76.aa4d0dda.js"><link rel="prefetch" href="/assets/js/77.c0866283.js"><link rel="prefetch" href="/assets/js/78.754bcc28.js"><link rel="prefetch" href="/assets/js/79.21ed4ea4.js"><link rel="prefetch" href="/assets/js/80.9db536ae.js"><link rel="prefetch" href="/assets/js/81.df0e0ce0.js"><link rel="prefetch" href="/assets/js/82.c37ed1f7.js"><link rel="prefetch" href="/assets/js/83.fef00509.js"><link rel="prefetch" href="/assets/js/9.5b9d2548.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a2631af3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ef7b7088.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="繁华中自律，落魄中自愈" class="logo"> <span class="site-name can-hide">繁华中自律，落魄中自愈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Knowledge/" class="nav-link">知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/Info/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/bingbing.jpg"> <div class="blogger-info"><h3>石怜安</h3> <span>在线找大长腿小姐姐</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/Knowledge/" class="nav-link">知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/Info/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=Knowledge" title="分类" data-v-1baff76c>Knowledge</a></li><li data-v-1baff76c><a href="/categories/?category=FrontEnd" title="分类" data-v-1baff76c>FrontEnd</a></li><li data-v-1baff76c><a href="/categories/?category=Vue" title="分类" data-v-1baff76c>Vue</a></li><li data-v-1baff76c><a href="/categories/?category=Component" title="分类" data-v-1baff76c>Component</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="404" target="_blank" title="作者" class="beLink" data-v-1baff76c>JSH</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-07-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="/bingbing.jpg">VUE3组件库<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>随着前端技术的发展，业界涌现出了许多的 <code>UI组件库</code> 。例如熟知的<code>ElementUI</code>，<code>Vant</code>，<code>AntDesign</code>等等。</p> <p>但是作为一个前端开发者，你知道一个UI组件库是如何被打造出来的吗?</p> <p>读完这篇文章你将学会:</p> <ul><li>如何使用 <code>pnpm</code> 搭建出一个 <code>Monorepo</code> 环境</li> <li>如何使用 <code>vite</code> 搭建一个基本的 <code>Vue3</code> 脚手架项目</li> <li>如何开发调试一个自己的 <code>UI组件库</code></li> <li>如何使用vite <code>打包</code> 并 <code>发布</code> 自己的UI组件库</li></ul> <h2 id="monorepo环境"><a href="#monorepo环境" class="header-anchor">#</a> Monorepo环境</h2> <p>在一个大的项目仓库中，管理多个<code>模块/包</code>（package），这种类型的项目大都在项目 <code>根目录</code> 下有一个 <code>packages</code> 文件夹，分多个项目管理。大概结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>-- packages
  -- pkg1
    --package.json
  -- pkg2
    --package.json
--package.json
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>简单来说就是<code>单仓库</code> <code>多项目</code></p> <p>目前很多我们熟知的项目都是采用这种模式，如<code>Vant</code>，<code>ElementUI</code>，<code>Vue3</code>等。打造一个<code>menorepo</code>环境的工具有很多，如：<code>lerna</code>、<code>pnpm</code>、<code>yarn</code>等，这里我们将使用<code>pnpm</code>来开发<code>UI组件库</code>。</p></div> <h3 id="为什么要使用-pnpm"><a href="#为什么要使用-pnpm" class="header-anchor">#</a> 为什么要使用 pnpm ?</h3> <p>因为它简单高效，它没有太多杂乱的配置，它相比于lerna操作起来方便太多</p> <h2 id="组件库搭建"><a href="#组件库搭建" class="header-anchor">#</a> 组件库搭建</h2> <h3 id="初始化-package-json"><a href="#初始化-package-json" class="header-anchor">#</a> 初始化 package.json</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> init
</code></pre></div><h3 id="新建配置文件-npmrc"><a href="#新建配置文件-npmrc" class="header-anchor">#</a> 新建配置文件 .npmrc</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>shamefully-hoist <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre></div><h4 id="为什么要配置shamefully-hoist。"><a href="#为什么要配置shamefully-hoist。" class="header-anchor">#</a> 为什么要配置<code>shamefully-hoist</code>。</h4> <p>如果某些工具仅在 <code>根目录</code> 的 <code>node_modules</code> 时才有效，可以将其设置为 <code>true</code> 来提升那些<code>不在根目录</code>的<code>node_modules</code>，就是将你安装的<code>依赖包</code>的<code>依赖包</code>的<code>依赖包</code>的...都放到同一级别（<code>扁平化</code>）。说白了就是不设置为<code>true</code>有些包就有可能会出问题。</p> <h4 id="monorepo的实现"><a href="#monorepo的实现" class="header-anchor">#</a> monorepo的实现</h4> <p>为了我们各个项目之间能够互相引用我们要新建一个<code>pnpm-workspace.yaml</code>文件将我们的包<code>关联</code>起来</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'packages/**'</span>
  <span class="token punctuation">-</span> <span class="token string">'examples'</span>
</code></pre></div><p>根据上面的<code>目录结构</code>很显然在根目录下新建 <code>packages</code> 和 <code>examples</code> 文件夹，<code>packages</code>文件夹存放我们<code>开发的包</code>，<code>examples</code>用来<code>调试</code>的<code>组件</code></p> <p><code>examples文件夹</code>就是接下来我们要使用<code>vite</code>搭建一个基本的<code>Vue3脚手架项目</code>的地方</p> <h3 id="安装对应依赖"><a href="#安装对应依赖" class="header-anchor">#</a> 安装对应依赖</h3> <p><code>开发环境</code>中的依赖一般<code>全部安装</code>在整个项目<code>根目录</code>下，方便下面<code>每个包</code>都可以<code>引用</code>,所以在安装的时候需要加个<code>-w</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> vue@next typescript <span class="token function">less</span> -D -w
</code></pre></div><h3 id="配置tsconfig-json"><a href="#配置tsconfig-json" class="header-anchor">#</a> 配置tsconfig.json</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>npx tsc --init
</code></pre></div><h4 id="调整-tsconfig-json"><a href="#调整-tsconfig-json" class="header-anchor">#</a> 调整 tsconfig.json</h4> <div class="language-json5 extra-class"><pre class="language-json5"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Visit https://aka.ms/tsconfig to read more about this file */</span>

    <span class="token comment">/* Projects */</span>
    <span class="token comment">// &quot;incremental&quot;: true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */</span>
    <span class="token comment">// &quot;composite&quot;: true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */</span>
    <span class="token comment">// &quot;tsBuildInfoFile&quot;: &quot;./.tsbuildinfo&quot;,              /* Specify the path to .tsbuildinfo incremental compilation file. */</span>
    <span class="token comment">// &quot;disableSourceOfProjectReferenceRedirect&quot;: true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */</span>
    <span class="token comment">// &quot;disableSolutionSearching&quot;: true,                 /* Opt a project out of multi-project reference checking when editing. */</span>
    <span class="token comment">// &quot;disableReferencedProjectLoad&quot;: true,             /* Reduce the number of projects loaded automatically by TypeScript. */</span>

    <span class="token comment">/* Language and Environment */</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ES2015&quot;</span><span class="token punctuation">,</span>                                  <span class="token comment">/* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                                        <span class="token comment">/* Specify a set of bundled library declaration files that describe the target runtime environment. */</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span>                                <span class="token comment">/* Specify what JSX code is generated. */</span>
    <span class="token comment">// &quot;experimentalDecorators&quot;: true,                   /* Enable experimental support for TC39 stage 2 draft decorators. */</span>
    <span class="token comment">// &quot;emitDecoratorMetadata&quot;: true,                    /* Emit design-type metadata for decorated declarations in source files. */</span>
    <span class="token comment">// &quot;jsxFactory&quot;: &quot;&quot;,                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. 'React.createElement' or 'h'. */</span>
    <span class="token comment">// &quot;jsxFragmentFactory&quot;: &quot;&quot;,                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. 'React.Fragment' or 'Fragment'. */</span>
    <span class="token comment">// &quot;jsxImportSource&quot;: &quot;&quot;,                            /* Specify module specifier used to import the JSX factory functions when using 'jsx: react-jsx*'. */</span>
    <span class="token comment">// &quot;reactNamespace&quot;: &quot;&quot;,                             /* Specify the object invoked for 'createElement'. This only applies when targeting 'react' JSX emit. */</span>
    <span class="token comment">// &quot;noLib&quot;: true,                                    /* Disable including any library files, including the default lib.d.ts. */</span>
    <span class="token comment">// &quot;useDefineForClassFields&quot;: true,                  /* Emit ECMAScript-standard-compliant class fields. */</span>
    <span class="token comment">// &quot;moduleDetection&quot;: &quot;auto&quot;,                        /* Control what method is used to detect module-format JS files. */</span>

    <span class="token comment">/* Modules */</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>                                <span class="token comment">/* Specify what module code is generated. */</span>
    <span class="token comment">// &quot;rootDir&quot;: &quot;./&quot;,                                  /* Specify the root folder within your source files. */</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>                       <span class="token comment">/* Specify how TypeScript looks up a file from a given module specifier. */</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>                                  <span class="token comment">/* Specify the base directory to resolve non-relative module names. */</span>
    <span class="token comment">// &quot;paths&quot;: {},                                      /* Specify a set of entries that re-map imports to additional lookup locations. */</span>
    <span class="token comment">// &quot;rootDirs&quot;: [],                                   /* Allow multiple folders to be treated as one when resolving modules. */</span>
    <span class="token comment">// &quot;typeRoots&quot;: [],                                  /* Specify multiple folders that act like './node_modules/@types'. */</span>
    <span class="token comment">// &quot;types&quot;: [],                                      /* Specify type package names to be included without being referenced in a source file. */</span>
    <span class="token comment">// &quot;allowUmdGlobalAccess&quot;: true,                     /* Allow accessing UMD globals from modules. */</span>
    <span class="token comment">// &quot;moduleSuffixes&quot;: [],                             /* List of file name suffixes to search when resolving a module. */</span>
    <span class="token comment">// &quot;resolveJsonModule&quot;: true,                        /* Enable importing .json files. */</span>
    <span class="token comment">// &quot;noResolve&quot;: true,                                /* Disallow 'import's, 'require's or '&lt;reference&gt;'s from expanding the number of files TypeScript should add to a project. */</span>

    <span class="token comment">/* JavaScript Support */</span>
    <span class="token comment">// &quot;allowJs&quot;: true,                                  /* Allow JavaScript files to be a part of your program. Use the 'checkJS' option to get errors from these files. */</span>
    <span class="token comment">// &quot;checkJs&quot;: true,                                  /* Enable error reporting in type-checked JavaScript files. */</span>
    <span class="token comment">// &quot;maxNodeModuleJsDepth&quot;: 1,                        /* Specify the maximum folder depth used for checking JavaScript files from 'node_modules'. Only applicable with 'allowJs'. */</span>

    <span class="token comment">/* Emit */</span>
    <span class="token comment">// &quot;declaration&quot;: true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */</span>
    <span class="token comment">// &quot;declarationMap&quot;: true,                           /* Create sourcemaps for d.ts files. */</span>
    <span class="token comment">// &quot;emitDeclarationOnly&quot;: true,                      /* Only output d.ts files and not JavaScript files. */</span>
    <span class="token comment">// &quot;sourceMap&quot;: true,                                /* Create source map files for emitted JavaScript files. */</span>
    <span class="token comment">// &quot;outFile&quot;: &quot;./&quot;,                                  /* Specify a file that bundles all outputs into one JavaScript file. If 'declaration' is true, also designates a file that bundles all .d.ts output. */</span>
    <span class="token comment">// &quot;outDir&quot;: &quot;./&quot;,                                   /* Specify an output folder for all emitted files. */</span>
    <span class="token comment">// &quot;removeComments&quot;: true,                           /* Disable emitting comments. */</span>
    <span class="token comment">// &quot;noEmit&quot;: true,                                   /* Disable emitting files from a compilation. */</span>
    <span class="token comment">// &quot;importHelpers&quot;: true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */</span>
    <span class="token comment">// &quot;importsNotUsedAsValues&quot;: &quot;remove&quot;,               /* Specify emit/checking behavior for imports that are only used for types. */</span>
    <span class="token comment">// &quot;downlevelIteration&quot;: true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */</span>
    <span class="token comment">// &quot;sourceRoot&quot;: &quot;&quot;,                                 /* Specify the root path for debuggers to find the reference source code. */</span>
    <span class="token comment">// &quot;mapRoot&quot;: &quot;&quot;,                                    /* Specify the location where debugger should locate map files instead of generated locations. */</span>
    <span class="token comment">// &quot;inlineSourceMap&quot;: true,                          /* Include sourcemap files inside the emitted JavaScript. */</span>
    <span class="token comment">// &quot;inlineSources&quot;: true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */</span>
    <span class="token comment">// &quot;emitBOM&quot;: true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */</span>
    <span class="token comment">// &quot;newLine&quot;: &quot;crlf&quot;,                                /* Set the newline character for emitting files. */</span>
    <span class="token comment">// &quot;stripInternal&quot;: true,                            /* Disable emitting declarations that have '@internal' in their JSDoc comments. */</span>
    <span class="token comment">// &quot;noEmitHelpers&quot;: true,                            /* Disable generating custom helper functions like '__extends' in compiled output. */</span>
    <span class="token comment">// &quot;noEmitOnError&quot;: true,                            /* Disable emitting files if any type checking errors are reported. */</span>
    <span class="token comment">// &quot;preserveConstEnums&quot;: true,                       /* Disable erasing 'const enum' declarations in generated code. */</span>
    <span class="token comment">// &quot;declarationDir&quot;: &quot;./&quot;,                           /* Specify the output directory for generated declaration files. */</span>
    <span class="token comment">// &quot;preserveValueImports&quot;: true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */</span>

    <span class="token comment">/* Interop Constraints */</span>
    <span class="token comment">// &quot;isolatedModules&quot;: true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */</span>
    <span class="token comment">// &quot;allowSyntheticDefaultImports&quot;: true,             /* Allow 'import x from y' when a module doesn't have a default export. */</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                             <span class="token comment">/* Emit additional JavaScript to ease support for importing CommonJS modules. This enables 'allowSyntheticDefaultImports' for type compatibility. */</span>
    <span class="token comment">// &quot;preserveSymlinks&quot;: true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */</span>
    <span class="token property">&quot;forceConsistentCasingInFileNames&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>            <span class="token comment">/* Ensure that casing is correct in imports. */</span>

    <span class="token comment">/* Type Checking */</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                                      <span class="token comment">/* Enable all strict type-checking options. */</span>
    <span class="token comment">// &quot;noImplicitAny&quot;: true,                            /* Enable error reporting for expressions and declarations with an implied 'any' type. */</span>
    <span class="token comment">// &quot;strictNullChecks&quot;: true,                         /* When type checking, take into account 'null' and 'undefined'. */</span>
    <span class="token comment">// &quot;strictFunctionTypes&quot;: true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */</span>
    <span class="token comment">// &quot;strictBindCallApply&quot;: true,                      /* Check that the arguments for 'bind', 'call', and 'apply' methods match the original function. */</span>
    <span class="token comment">// &quot;strictPropertyInitialization&quot;: true,             /* Check for class properties that are declared but not set in the constructor. */</span>
    <span class="token comment">// &quot;noImplicitThis&quot;: true,                           /* Enable error reporting when 'this' is given the type 'any'. */</span>
    <span class="token comment">// &quot;useUnknownInCatchVariables&quot;: true,               /* Default catch clause variables as 'unknown' instead of 'any'. */</span>
    <span class="token comment">// &quot;alwaysStrict&quot;: true,                             /* Ensure 'use strict' is always emitted. */</span>
    <span class="token comment">// &quot;noUnusedLocals&quot;: true,                           /* Enable error reporting when local variables aren't read. */</span>
    <span class="token comment">// &quot;noUnusedParameters&quot;: true,                       /* Raise an error when a function parameter isn't read. */</span>
    <span class="token comment">// &quot;exactOptionalPropertyTypes&quot;: true,               /* Interpret optional property types as written, rather than adding 'undefined'. */</span>
    <span class="token comment">// &quot;noImplicitReturns&quot;: true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */</span>
    <span class="token comment">// &quot;noFallthroughCasesInSwitch&quot;: true,               /* Enable error reporting for fallthrough cases in switch statements. */</span>
    <span class="token comment">// &quot;noUncheckedIndexedAccess&quot;: true,                 /* Add 'undefined' to a type when accessed using an index. */</span>
    <span class="token comment">// &quot;noImplicitOverride&quot;: true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */</span>
    <span class="token comment">// &quot;noPropertyAccessFromIndexSignature&quot;: true,       /* Enforces using indexed accessors for keys declared using an indexed type. */</span>
    <span class="token comment">// &quot;allowUnusedLabels&quot;: true,                        /* Disable error reporting for unused labels. */</span>
    <span class="token comment">// &quot;allowUnreachableCode&quot;: true,                     /* Disable error reporting for unreachable code. */</span>

    <span class="token comment">/* Completeness */</span>
    <span class="token comment">// &quot;skipDefaultLibCheck&quot;: true,                      /* Skip type checking .d.ts files that are included with TypeScript. */</span>
    <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>                                 <span class="token comment">/* Skip type checking all .d.ts files. */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="搭建一个基于-vite-的-vue3-项目"><a href="#搭建一个基于-vite-的-vue3-项目" class="header-anchor">#</a> 搭建一个基于 vite 的 vue3 项目</h3> <p>其实搭建一个<code>vite + vue3</code>项目是非常容易的，因为 <code>vite</code> 已经帮我们做了大部分事情</p> <h4 id="初始化仓库"><a href="#初始化仓库" class="header-anchor">#</a> 初始化仓库</h4> <p>进入<code>examples</code>文件夹，执行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> init
</code></pre></div><h4 id="安装-vite-和-vitejs-plugin-vue"><a href="#安装-vite-和-vitejs-plugin-vue" class="header-anchor">#</a> 安装 vite 和 @vitejs/plugin-vue</h4> <p><code>@vitejs/plugin-vue</code> 用来支持 <code>.vue</code> 文件的转译</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> vite @vitejs/plugin-vue -D -w
</code></pre></div><p>这里安装的插件都放在 <code>根目录</code> 下</p> <h4 id="配置-vite-config-ts"><a href="#配置-vite-config-ts" class="header-anchor">#</a> 配置 vite.config.ts</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token operator">:</span><span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="新建-html-文件"><a href="#新建-html-文件" class="header-anchor">#</a> 新建 html 文件</h4> <p><code>@vitejs/plugin-vue</code> 会默认加载<code>examples</code>下的<code>index.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main.ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>vite 是基于 <code>esmodule</code> 的，所以 <code>type=&quot;module&quot;</code></p></div> <h4 id="新建-app-vue-模板"><a href="#新建-app-vue-模板" class="header-anchor">#</a> 新建 app.vue 模板</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    启动测试
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="新建-main-ts"><a href="#新建-main-ts" class="header-anchor">#</a> 新建 main.ts</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./app.vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此时会发现编译器会提示个错误：找不到模块 “<code>./app.vue</code>” 或其相应的类型声明</p> <p>因为直接引入<code>.vue</code>文件 <code>TS</code> 会找不到对应的 <code>类型声明</code> ；所以需要新建<code>types</code>（命名没有明确规定，TS会自动寻找 <code>.d.ts</code> 文件）文件夹来专门放这些声明文件，即文件路径 <code>types/vue-shim.d.ts</code>。</p> <p><code>TypeScript</code> 默认只认 <code>ES</code> 模块。如果你要导入<code>.vue</code>文件就要 <code>declare module</code> 把他们 <code>声明</code> 出来。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;*.vue&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> DefineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> component<span class="token operator">:</span> DefineComponent<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="配置脚本启动项目"><a href="#配置脚本启动项目" class="header-anchor">#</a> 配置脚本启动项目</h4> <p>最后在<code>package.json</code>文件中配置<code>scripts</code>脚本</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;examples&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;main.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JSH&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;sla-ui&quot;</span><span class="token operator">:</span> <span class="token string">&quot;workspace:^1.0.3&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>终端输入命令：<code>pnpm run dev</code></p> <p>在浏览器中打开  <code>http://127.0.0.1:5173/</code> 就会看我们的<code>启动测试</code>页面。</p> <h3 id="本地调试"><a href="#本地调试" class="header-anchor">#</a> 本地调试</h3> <h4 id="新建-packages-文件"><a href="#新建-packages-文件" class="header-anchor">#</a> 新建 packages 文件</h4> <p>本节和组件的开发关联不大，但是未来组件需要引入一些<code>工具方法</code>的时候会用到。</p> <p>接下来就是要往我们的packages文件夹冲填充内容了。</p> <h4 id="utils-这里命名为-sla-ui-utils"><a href="#utils-这里命名为-sla-ui-utils" class="header-anchor">#</a> utils (这里命名为 @sla-ui/utils)</h4> <h5 id="初始化-utils"><a href="#初始化-utils" class="header-anchor">#</a> 初始化 utils</h5> <p>一般 <code>packages</code> 要有 <code>utils</code> 包来存放<code>公共方法</code>、<code>工具函数</code>等</p> <p>既然它是一个包，所以新建 <code>utils</code> 目录后就需要<code>初始化</code>它，让它变成一个包；</p> <ol><li>终端进入 <code>utils</code> 文件夹执行：<code>pnpm init</code>，然后会生成一个<code>package.json</code>文件；</li> <li>这里需要改一下包名，这里将 <code>name</code> 改成 <code>@sla-ui/utils</code> 表示这个 <code>utils</code> 包是属于 <code>sla-ui</code> 这个组织下的。所以记住发布之前要登录 <code>npm</code> 新建一个组织；例如<code>sla-ui</code></li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@sla-ui/utils&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sla-ui的公共方法、工具函数&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JSH&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="新建入口文件"><a href="#新建入口文件" class="header-anchor">#</a> 新建入口文件</h5> <p>因为我们使用<code>ts</code>写的，所以需要将入口文件 <code>index.js</code> 改为 <code>index.ts</code>，并新建<code>index.ts</code>文件:(先导出一个简单的加法函数)</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">testFun</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="组件库-这里命名为-sla-ui"><a href="#组件库-这里命名为-sla-ui" class="header-anchor">#</a> 组件库 (这里命名为 sla-ui)</h4> <h5 id="初始化组件库"><a href="#初始化组件库" class="header-anchor">#</a> 初始化组件库</h5> <p><code>components</code>是我们用来存放各种<code>UI组件</code>的包</p> <ol><li>新建<code>components</code>文件夹</li> <li>执行 <code>pnpm init</code> 生成 <code>package.json</code></li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sla-ui&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SLA的UI组件库&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JSH&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="新建入口文件-2"><a href="#新建入口文件-2" class="header-anchor">#</a> 新建入口文件</h5> <p>新建<code>index.ts</code>入口文件并<code>引入utils包</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>testfun<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@kitty-ui/utils'</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testfun</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>由于组件库是基于<code>ts</code>的，所以需要安装<code>esno</code>来执行ts文件便于测试组件之间的引入情况</p> <p>控制台输入<code>esno xxx.ts</code>即可执行ts文件</p> <div class="language- extra-class"><pre class="language-text"><code>npm i esno -g
</code></pre></div></div> <h5 id="包之间本地调试"><a href="#包之间本地调试" class="header-anchor">#</a> 包之间本地调试</h5> <p>进入<code>components</code>文件夹执行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> @sla-ui/utils
</code></pre></div><p>会发现 <code>pnpm</code> 会自动创建个<code>软链接</code>直接指向我们的<code>utils</code>包；此时<code>components</code>下的<code>packages.json</code>会变成下面的样子：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sla-ui&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SLA的UI组件库&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JSH&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@sla-ui/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;workspace:^1.0.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你会发现它的依赖 <code>@sla-ui/utils</code> 对应的版本为：<code>workspace:^1.0.x</code>；因为<code>pnpm</code>是由<code>workspace</code>管理的，所以有一个前缀<code>workspace</code>可以指向<code>utils</code>下的<code>工作空间</code>从而方便本地调试各个包直接的<code>关联引用</code>。</p> <h3 id="尝试开发组件"><a href="#尝试开发组件" class="header-anchor">#</a> 尝试开发组件</h3> <p>到这里基本开发方法我们已经知道啦；接下来就要进入正题了，开发一个<code>button组件</code></p> <h4 id="组件目录"><a href="#组件目录" class="header-anchor">#</a> 组件目录</h4> <p>在<code>components</code>文件夹下新建<code>src</code>，同时在<code>src</code>下新建<code>button组件目录</code>和<code>icon组件目录</code>(新建icon为了便于调试)；</p> <p>此时<code>components</code>文件目录如下</p> <div class="language- extra-class"><pre class="language-text"><code>-- components
  -- src
    -- button
    -- icon
    -- index.ts
  -- package.json
</code></pre></div><h4 id="组件实现"><a href="#组件实现" class="header-anchor">#</a> 组件实现</h4> <p>让我们先测试一下<code>button组件</code>能否在我们搭建的<code>examples</code>下的<code>vue3项目</code>引用</p> <ol><li>在 <code>button</code> 目录下新建一个简单的 <code>index.vue</code></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>测试按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>然后在<code>button/index.ts</code>将其导出</li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./button.vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Button
</code></pre></div><ol start="3"><li>因为开发组件库的时候不可能只有button，所以需要一个<code>components/index.ts</code>将开发的组件一个个的<code>集中导出</code></li></ol> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">&quot;./button&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>Button<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>一个组件的大体目录差不多就是这样了，接下来进入的<code>examples</code>来看看能否引入<code>button组件</code></p> <h3 id="vue3-项目使用组件"><a href="#vue3-项目使用组件" class="header-anchor">#</a> vue3 项目使用组件</h3> <p>上面已经说过执行在<code>workspace</code>执行 <code>pnpm i xxx</code> 的时候<code>pnpm</code>会自动创建个<code>软链接</code>直接指向<code>xxx</code>包。</p> <p>所以这里直接在<code>examples</code>执行：<code>pnpm i sla-ui</code></p> <p>此时会发现<code>packages.json</code>的依赖多了个 <code>&quot;sla-ui&quot;: &quot;workspace:^1.0.0&quot;</code></p> <p>这时候就能直接在<code>测试项目</code>下引入<code>本地</code>的<code>components</code>组件库了，启动测试项目，来到的 <code>examples/app.vue</code> 直接引入 <code>Button</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    启动测试
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'sla-ui'</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>不出意外的话，页面就会展示刚刚写的button组件了。</p> <h3 id="完善组件"><a href="#完善组件" class="header-anchor">#</a> 完善组件</h3> <p>因为 <code>button</code> 组件是需要接收很多<code>属性</code>的，如<code>type</code>、<code>size</code>等等，所以要新建个<code>types.ts</code>文件来规范这些属性</p> <p>在<code>button</code>目录下新建<code>types.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>ExtractPropTypes<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ButtonType <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'warning'</span><span class="token punctuation">,</span> <span class="token string">'danger'</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> ButtonSize <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'large'</span><span class="token punctuation">,</span> <span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'mini'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> buttonProps <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    values<span class="token operator">:</span> ButtonType
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  size<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> String<span class="token punctuation">,</span>
    values<span class="token operator">:</span> ButtonSize
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> ExtractPropTypes<span class="token operator">&lt;</span><span class="token keyword">typeof</span> buttonProps<span class="token operator">&gt;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p><code>import type</code> 表示只导入<code>类型</code>；</p> <p><code>ExtractPropTypes</code>是<code>vue3</code>中内置的类型声明，它的作用是接收一个<code>类型</code>，然后把对应的<code>vue3</code>所接收的<code>props类型</code>提供出来，后面有需要可以直接使用。</p></div> <p>很多时候我们在<code>vue</code>中使用一个组件会用的 <code>app.use</code> 将组件<code>挂载</code>到<code>全局</code>。要使用<code>app.use</code>函数的话我们需要让我们的每个组件都提供一个<code>install</code>方法，<code>app.use()</code>的时候就会调用这个方法；</p> <p>将<code>button/index.ts</code>调整为</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./index.vue'</span>
<span class="token keyword">import</span>  <span class="token keyword">type</span> <span class="token punctuation">{</span> App<span class="token punctuation">,</span> Plugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">SFCWithInstall<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> Plugin
<span class="token keyword">const</span> withInstall <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>comp<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>comp <span class="token keyword">as</span> SFCWithInstall<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token punctuation">(</span>app<span class="token operator">:</span> App<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">(</span>comp <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> comp<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> comp <span class="token keyword">as</span> SFCWithInstall<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">withInstall</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span>
</code></pre></div><p>此时就可以使用<code>app.use</code>来挂载组件啦</p> <h3 id="vite打包"><a href="#vite打包" class="header-anchor">#</a> vite打包</h3> <h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <p>打包们这里选择vite，它有一个<code>库模式</code>专门来打包这种<code>库组件</code>的。</p> <p>前面已经安装过vite了，所以这里直接在<code>components</code>下直接新建<code>vite.config.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    build<span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'modules'</span><span class="token punctuation">,</span>
      <span class="token comment">//打包文件目录</span>
      outDir<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      <span class="token comment">//压缩</span>
      minify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">//css分离</span>
      <span class="token comment">//cssCodeSplit: true,</span>
      rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//忽略打包vue文件</span>
        external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/index.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            format<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
            <span class="token comment">//不用打包成.es.js,这里我们想把它打包成.js</span>
            entryFileNames<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
            <span class="token comment">//让打包目录和我们目录对应</span>
            preserveModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">//配置打包根目录</span>
            dir<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
            preserveModulesRoot<span class="token operator">:</span> <span class="token string">'src'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
            entryFileNames<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
            <span class="token comment">//让打包目录和我们目录对应</span>
            preserveModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">//配置打包根目录</span>
            dir<span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
            preserveModulesRoot<span class="token operator">:</span> <span class="token string">'src'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      lib<span class="token operator">:</span> <span class="token punctuation">{</span>
        entry<span class="token operator">:</span> <span class="token string">'src/index.ts'</span><span class="token punctuation">,</span>
        formats<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'es'</span><span class="token punctuation">,</span> <span class="token string">'cjs'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>这里选择打包<code>cjs(CommonJS)</code>和<code>esm(ESModule)</code>两种形式，<code>cjs模式</code>主要用于<code>服务端引用(ssr)</code>，而<code>esm</code>就是现在经常使用的方式，它本身自带<code>treeShaking</code>而不需要额外配置<code>按需引入</code>(前提是将模块分别导出)，非常好用~</p> <p>其实到这里就已经可以直接打包了；<code>components</code>下执行：<code>pnpm run build</code> 就会发现打包了<code>es</code>和<code>lib</code>两个目录</p> <h5 id="声明文件"><a href="#声明文件" class="header-anchor">#</a> 声明文件</h5> <p>到这里其实打包的组件库<code>只能给js项目使用</code>，在ts项目下运行会出现一些错误，而且使用的时候还会<code>失去代码提示功能</code>，这样的话就失去了用<code>ts</code>开发组件库的意义了。所以需要在打包的库里加入声明文件<code>(.d.ts)</code>。</p> <p>那么如何向打包后的库里加入声明文件呢？其实很简单，只需要引入<code>vite-plugin-dts</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> i vite-plugin-dts -D -w
</code></pre></div><p>然后修改一下<code>vite.config.ts</code>引入这个插件</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>defineConfig<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> dts <span class="token keyword">from</span> <span class="token string">'vite-plugin-dts'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    build<span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'modules'</span><span class="token punctuation">,</span>
      <span class="token comment">//打包文件目录</span>
      outDir<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      <span class="token comment">//压缩</span>
      minify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">//css分离</span>
      <span class="token comment">//cssCodeSplit: true,</span>
      rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">//忽略打包vue文件</span>
        external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/index.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        output<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            format<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
            <span class="token comment">//不用打包成.es.js,这里我们想把它打包成.js</span>
            entryFileNames<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
            <span class="token comment">//让打包目录和我们目录对应</span>
            preserveModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">//配置打包根目录</span>
            dir<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
            preserveModulesRoot<span class="token operator">:</span> <span class="token string">'src'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
            entryFileNames<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
            <span class="token comment">//让打包目录和我们目录对应</span>
            preserveModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">//配置打包根目录</span>
            dir<span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
            preserveModulesRoot<span class="token operator">:</span> <span class="token string">'src'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      lib<span class="token operator">:</span> <span class="token punctuation">{</span>
        entry<span class="token operator">:</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">,</span>
        formats<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'es'</span><span class="token punctuation">,</span> <span class="token string">'cjs'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">dts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//指定使用的tsconfig.json为我们整个项目根目录下掉,如果不配置,你也可以在components下新建tsconfig.json</span>
        tsConfigFilePath<span class="token operator">:</span> <span class="token string">'./../../tsconfig.json'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">//因为这个插件默认打包到es下，我们想让lib目录下也生成声明文件需要再配置一个</span>
      <span class="token function">dts</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        outputDir<span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
        tsConfigFilePath<span class="token operator">:</span> <span class="token string">'./../../tsconfig.json'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>因为这个插件默认打包到<code>es</code>下，想让<code>lib</code>目录下也生成<code>声明文件</code>需要再配置一个<code>dts</code>插件，暂时没有想到其它更好的处理方法</p> <p>然后执行打包命令就会发现<code>es</code>和<code>lib</code>下就有了<code>声明文件</code></p> <p>其实后面就可以进行发布了，发布之前更改一下<code>components</code>下的<code>package.json</code>如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sla-ui&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SLA的UI组件库&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/components/src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span><span class="token string">&quot;es/components/src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JSH&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;lib&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/components/src/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@sla-ui/utils&quot;</span><span class="token operator">:</span> <span class="token string">&quot;workspace:^1.0.1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>解释一下里面部分字段</p> <ul><li><code>pkg.module</code></li></ul> <p>组件库<code>默认入口文件</code>是传统的<code>CommonJS</code>模块，但是如果你的环境支持<code>ESModule</code>的话，构建工具会优先使用我们的<code>module</code>入口</p> <ul><li><code>pkg.files</code></li></ul> <p>files是指需要发布到<code>npm</code>上的目录，因为不可能<code>components</code>下的所有目录都被发布上去</p> <h3 id="开始发布"><a href="#开始发布" class="header-anchor">#</a> 开始发布</h3> <p>其实npm发包是很容易的，就拿我们的组件库 <code>sla-ui</code> 举例吧</p> <p>发布之前记得到npm官网注册个账户，如果你要发布 <code>@xx/xx</code> 这种包的话需要在<code>npm</code>新建个组织，组织组织名就是<code>@后面</code>的，比如我建的组织就是 <code>sla-ui</code>，注册完之后就可以发布了。</p> <p>首先要将我们代码提交到<code>git仓库</code>，不然<code>pnpm</code>发布<code>无法通过</code></p> <p>后面每次发版记得在对应包下执行 <code>pnpm version patch</code> 就会发现这个包的版本号<code>patch(版本号第三个数) +1</code> 了</p> <p>同样的 <code>pnpm version major major</code> 和 <code>pnpm version minor</code> 分别对应版本号的<code>第一</code>和<code>第二</code>位增加。</p> <p>如果你发布的是公共包的话，在对应包下执行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> publish --access public
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">警告</p> <p>发布的时候要将<code>npm</code>的源切换<code>到npm的官方地址</code></p></div> <h3 id="样式问题"><a href="#样式问题" class="header-anchor">#</a> 样式问题</h3> <p>引入打包后的组件会发现<code>没有样式</code>，所以需要在全局引入<code>style.css</code>才行；如<code>main.ts</code>中需要 <code>import 'sla-ui/es/style.css';</code></p> <p>很显然这种组件库并不是我们想要的，我们需要的组件库是每个<code>css样式</code>放在每个组件其<code>对应目录下</code>，这样就不需要每次都全量导入css样式。</p> <h4 id="处理less文件"><a href="#处理less文件" class="header-anchor">#</a> 处理less文件</h4> <p>首先需要将<code>less</code>打包成<code>css</code>然后放到打包后对应的文件目录下，在<code>components</code>下新建<code>build</code>文件夹来存放一些打包工具，然后新建<code>buildLess.ts</code>，首先我们需要先安装一些工具 <code>cpy</code> 和 <code>fast-glob</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> i cpy fast-glob -D -w
</code></pre></div><h5 id="cpy"><a href="#cpy" class="header-anchor">#</a> cpy</h5> <p>它可以直接复制规定的文件，并将文件copy到指定目录，比如 <code>buildLess.ts</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> cpy <span class="token keyword">from</span> <span class="token string">'cpy'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">const</span> sourceDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span>
<span class="token comment">//lib文件</span>
<span class="token keyword">const</span> targetLib <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib'</span><span class="token punctuation">)</span>
<span class="token comment">//es文件</span>
<span class="token keyword">const</span> targetEs <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../es'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sourceDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">buildLess</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">cpy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sourceDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> targetLib<span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">cpy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sourceDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> targetEs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">buildLess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>然后在<code>package.json</code>中新增命令</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:less&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esno build/buildLess&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>终端执行 <code>pnpm run build:less</code> 就会发现lib和es文件对应目录下就出现了<code>less</code>文件.</p> <p>但是最终要的并<code>不是less文件而是css文件</code>，所以我们要将<code>less打包成css</code>，所以我们需要用的<code>less</code>模块。在<code>ts</code>中引入<code>less</code>因为它本身没有声明文件所以会出现类型错误，所以我们要先安装它的 <code>@types/less</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> i --save-dev @types/less -D -w
</code></pre></div><p>buildLess.ts如下</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> cpy <span class="token keyword">from</span> <span class="token string">'cpy'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve<span class="token punctuation">,</span> dirname <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> promises <span class="token keyword">as</span> fs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;fs&quot;</span>
<span class="token keyword">import</span> less <span class="token keyword">from</span> <span class="token string">&quot;less&quot;</span>
<span class="token keyword">import</span> glob <span class="token keyword">from</span> <span class="token string">&quot;fast-glob&quot;</span>

<span class="token comment">//lib文件目录</span>
<span class="token keyword">const</span> targetLib <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../lib'</span><span class="token punctuation">)</span>
<span class="token comment">//es文件目录</span>
<span class="token keyword">const</span> targetEs <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../es'</span><span class="token punctuation">)</span>

<span class="token comment">//src目录</span>
<span class="token keyword">const</span> sourceDir <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">buildLess</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//直接将less文件复制到打包后目录</span>
  <span class="token keyword">await</span> <span class="token function">cpy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sourceDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> targetLib<span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">cpy</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sourceDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*.less</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> targetEs<span class="token punctuation">)</span>

  <span class="token comment">//获取打包后.less文件目录(lib和es一样)</span>
  <span class="token keyword">const</span> lessFils <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">&quot;**/*.less&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> cwd<span class="token operator">:</span> sourceDir<span class="token punctuation">,</span> onlyFiles<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//遍历含有less的目录</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> path <span class="token keyword">in</span> lessFils<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sourceDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lessFils<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token comment">//获取less文件字符串</span>
    <span class="token keyword">const</span> lessCode <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>

    <span class="token comment">//将less解析成css</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token keyword">await</span> less<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>lessCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">//指定src下对应less文件的文件夹为目录</span>
      paths<span class="token operator">:</span> <span class="token punctuation">[</span>sourceDir<span class="token punctuation">,</span> <span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//拿到.css后缀path</span>
    <span class="token keyword">const</span> cssPath <span class="token operator">=</span> lessFils<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.less'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">)</span>

    <span class="token comment">//将css写入对应目录</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>targetLib<span class="token punctuation">,</span> cssPath<span class="token punctuation">)</span><span class="token punctuation">,</span> code<span class="token punctuation">.</span>css<span class="token punctuation">)</span>
    <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>targetEs<span class="token punctuation">,</span> cssPath<span class="token punctuation">)</span><span class="token punctuation">,</span> code<span class="token punctuation">.</span>css<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">buildLess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>执行打包命令之后会发现对应文件夹下多了<code>style.css</code>文件</p> <p>现在已经将css文件放入对应的目录下了，但是我们的相关组件并没有引入这个css文件，所以我们需要的是每个打包后组件的<code>index.js</code>中出现如： <code>import &quot;xxx/xxx.css&quot;</code> 之类的代码我们的css才会生效；所以需要对<code>vite.config.ts</code>进行相关配置</p> <p>首先我们先将<code>.less</code>文件忽略 <strong>external: ['vue', /.less/],</strong> 这时候打包后的文件中如 <code>button/index.js</code> 就会出现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;./style/index.less&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>复制代码
然后我们再将打包后代码的.less换成.css就大功告成了</p> <div class="language- extra-class"><pre class="language-text"><code>plugins: [
            ...

            {
                name: 'style',
                generateBundle(config, bundle) {
                    //这里可以获取打包后的文件目录以及代码code
                    const keys = Object.keys(bundle)

                    for (const key of keys) {
                        const bundler: any = bundle[key as any]
                        //rollup内置方法,将所有输出文件code中的.less换成.css,因为我们当时没有打包less文件

                        this.emitFile({
                            type: 'asset',
                            fileName: key,//文件名名不变
                            source: bundler.code.replace(/\.less/g, '.css')
                        })
                    }
                }
            }
        ...
        ]
</code></pre></div><p>复制代码
我们最终的vite.config.ts如下</p> <div class="language- extra-class"><pre class="language-text"><code>import { defineConfig } from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
import dts from 'vite-plugin-dts'

export default defineConfig(
    {
        build: {
            target: 'modules',
            //打包文件目录
            outDir: &quot;es&quot;,
            //压缩
            minify: false,
            //css分离
            //cssCodeSplit: true,
            rollupOptions: {
                //忽略打包vue和.less文件
                external: ['vue', /\.less/],
                input: ['src/index.ts'],
                output: [
                    {
                        format: 'es',
                        //不用打包成.es.js,这里我们想把它打包成.js
                        entryFileNames: '[name].js',
                        //让打包目录和我们目录对应
                        preserveModules: true,
                        //配置打包根目录
                        dir: 'es',
                        preserveModulesRoot: 'src'
                    },
                    {
                        format: 'cjs',
                        //不用打包成.mjs
                        entryFileNames: '[name].js',
                        //让打包目录和我们目录对应
                        preserveModules: true,
                        //配置打包根目录
                        dir: 'lib',
                        preserveModulesRoot: 'src'
                    }
                ]
            },
            lib: {
                entry: './index.ts',
                formats: ['es', 'cjs']
            }
        },




        plugins: [
            vue(),
            dts({
                //指定使用的tsconfig.json为我们整个项目根目录下掉,如果不配置,你也可以在components下新建tsconfig.json
                tsConfigFilePath: '../../tsconfig.json'
            }),
            //因为这个插件默认打包到es下，我们想让lib目录下也生成声明文件需要再配置一个
            dts({
                outputDir: 'lib',
                tsConfigFilePath: '../../tsconfig.json'
            }),

            {
                name: 'style',
                generateBundle(config, bundle) {
                    //这里可以获取打包后的文件目录以及代码code
                    const keys = Object.keys(bundle)

                    for (const key of keys) {
                        const bundler: any = bundle[key as any]
                        //rollup内置方法,将所有输出文件code中的.less换成.css,因为我们当时没有打包less文件

                        this.emitFile({
                            type: 'asset',
                            fileName: key,//文件名名不变
                            source: bundler.code.replace(/\.less/g, '.css')
                        })
                    }
                }
            }

        ]
    }
)
</code></pre></div><p>复制代码
最后我们将打包less与打包组件合成一个命令(package.json):</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;scripts&quot;: {
    &quot;build&quot;: &quot;vite build &amp; esno build/buildLess&quot;
  },
</code></pre></div><p>复制代码
后续直接执行pnpm run build 即可完成所有打包啦</p> <p>直接使用
如果你不想一步步的搭建，想直接使用现成的话，你可以直接把项目clone下来-&gt; kittyui[3],然后你只需要以下几步便可将其完成</p> <p>安装pnpm npm i pnpm -g
安装esno npm i esno -g
安装所有依赖 pnpm install
本地测试 进入examples文件夹执行 pnpm run dev 启动vue3项目
打包 pnpm run build
写在最后
由于作者水平有限，难免会存在一些错误或不妥之处，希望各位能够不吝指出，一定及时修改。如果你对这个项目有更好的想法或者建议也欢迎在评论区提出，不胜感激。</p> <p>后续我会对一些常用组件进行开发，每个组件的开发都会以文章的形式展现出来以供大家参考。也欢迎大家将项目fork下来，提交自己组件或者对kittyui的修改到kittyui[4]~</p> <p>创作不易，你的点赞就是我的动力！如果感觉对自己有帮助的话就请点个赞吧，感谢~</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E7%BB%84%E4%BB%B6%E5%BA%93" title="标签">#组件库</a></div> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">8/12/2022, 5:42:25 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/Canvas/"><div>
            Canvas 入门
            <!----></div></a> <span class="date">07-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/Vue3/ToolFunction/"><div>
            VUE3工具函数源码解析
            <!----></div></a> <span class="date">07-11</span></dt></dl><dl><dd>03</dd> <dt><a href="/Performance/info/"><div>
            浅谈性能优化
            <!----></div></a> <span class="date">06-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="String" title="1051131737" target="_blank" class="iconfont icon-QQ"></a><a href="String" title="1051131737@qq.com" target="_blank" class="iconfont icon-youjian"></a><a href="String" title="jsh1051131737" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>JSH</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.7b063f2c.js" defer></script><script src="/assets/js/3.904774fa.js" defer></script><script src="/assets/js/74.952acfac.js" defer></script><script src="/assets/js/24.68206407.js" defer></script><script src="/assets/js/8.4300a81b.js" defer></script>
  </body>
</html>
