import{_ as l}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as i,c as u,a as n,f as e,e as r,b as s,d as a,r as p}from"./app.a9ce305a.js";const d={},k=s('<h2 id="\u524D\u8A00" tabindex="-1"><a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a> \u524D\u8A00</h2><p><code>Webpack</code>\u5728\u524D\u7AEF\u6784\u5EFA\u5DE5\u5177\u4E2D\u53EF\u4EE5\u582A\u79F0\u4E2D\u6D41\u7825\u67F1\u822C\u7684\u5B58\u5728\uFF0C\u65E5\u5E38\u4E1A\u52A1\u5F00\u53D1\u3001\u524D\u7AEF\u57FA\u5EFA\u5DE5\u5177\u3001\u9AD8\u7EA7\u524D\u7AEF\u9762\u8BD5...\u4EFB\u4F55\u573A\u666F\u90FD\u4F1A\u51FA\u73B0\u5B83\u7684\u8EAB\u5F71\u3002</p><p>\u4E5F\u8BB8\u5BF9\u4E8E\u5B83\u7684\u5185\u90E8\u5B9E\u73B0\u673A\u5236\uFF0C\u6211\u4EEC\u4E5F\u8BB8\u4F1A\u611F\u5230\u7591\u60D1\uFF0C\u65E5\u5E38\u5DE5\u4F5C\u4E2D\u57FA\u4E8E<code>Webpack Plugin/Loader</code>\u4E4B\u7C7B\u67E5\u9605<code>API</code>\u4ECD\u7136\u4E0D\u660E\u767D\u5404\u4E2A\u53C2\u6570\u7684\u542B\u4E49\u548C\u5E94\u7528\u65B9\u5F0F\u3002\u5176\u5B9E\u8FD9\u4E00\u5207\u539F\u56E0\u672C\u8D28\u4E0A\u90FD\u662F\u57FA\u4E8E<code>Webpack</code>\u5DE5\u4F5C\u6D41\u6CA1\u6709\u4E00\u4E2A\u6E05\u6670\u7684\u8BA4\u77E5\u5BFC\u81F4\u4E86\u6240\u8C13\u7684\u201C\u9762\u5BF9<code>API</code>\u65E0\u4ECE\u4E0B\u624B\u201D\u5F00\u53D1\u3002</p><p>\u4E0B\u9762\uFF0C\u6211\u4EEC\u4F1A\u4ECE\u5982\u4F55\u5B9E\u73B0 <strong>\u6A21\u5757\u5206\u6790\u9879\u76EE\u6253\u5305</strong> \u7684\u89D2\u5EA6\u51FA\u53D1\uFF0C\u4F7F\u7528 <strong>\u6700\u901A\u4FD7\uFF0C\u6700\u7B80\u6D01\uFF0C\u6700\u660E\u4E86</strong> \u7684\u4EE3\u7801\u5E26\u4F60\u63ED\u5F00<code>Webpack</code>\u80CC\u540E\u7684\u795E\u79D8\u9762\u7EB1\uFF0C\u5E26\u4F60\u5B9E\u73B0\u4E00\u4E2A\u7B80\u6613\u7248<code>Webpack</code>\uFF0C\u4ECE\u6B64\u5BF9\u4E8E\u4EFB\u4F55<code>webpack</code>\u76F8\u5173\u5E95\u5C42\u5F00\u53D1\u4E86\u7136\u4E8E\u80F8\u3002\u7528\u6700\u901A\u4FD7\u6613\u61C2\u7684\u4EE3\u7801\u5E26\u4F60\u8D70\u8FDB<code>webpack</code>\u7684\u5DE5\u4F5C\u6D41\u3002</p>',4),m=a("\u53EF\u4EE5\u6839\u636E "),v={href:"https://gitee.com/jin-shaohui/webpack-demo",target:"_blank",rel:"noopener noreferrer"},b=a("\u4EE3\u7801"),g=a(" \u4E00\u8FB9\u770B\u4E00\u8FB9\u5C1D\u8BD5"),y=s('<h2 id="\u524D\u7F6E\u77E5\u8BC6" tabindex="-1"><a class="header-anchor" href="#\u524D\u7F6E\u77E5\u8BC6" aria-hidden="true">#</a> \u524D\u7F6E\u77E5\u8BC6</h2><ul><li><p><strong>Tapable</strong></p><p>Tapable\u5305\u672C\u8D28\u4E0A\u662F\u4E3A\u6211\u4EEC\u66F4\u65B9\u9762\u521B\u5EFA\u81EA\u5B9A\u4E49\u4E8B\u4EF6\u548C\u89E6\u53D1\u81EA\u5B9A\u4E49\u4E8B\u4EF6\u7684\u5E93\uFF0C\u7C7B\u4F3C\u4E8E<code>Nodejs</code>\u4E2D\u7684<code>EventEmitter Api</code>\u3002<code>Webpack</code>\u4E2D\u7684\u63D2\u4EF6\u673A\u5236\u5C31\u662F\u57FA\u4E8ETapable\u5B9E\u73B0\u4E0E\u6253\u5305\u6D41\u7A0B\u89E3\u8026\uFF0C\u63D2\u4EF6\u7684\u6240\u6709\u5F62\u5F0F\u90FD\u662F\u57FA\u4E8E<code>Tapable</code>\u5B9E\u73B0\u3002</p></li><li><p><strong>Webpack Node Api</strong></p><p>\u57FA\u4E8E\u5B66\u4E60\u76EE\u7684\uFF0C\u4F1A\u7740\u91CD\u4E8E<code>Webpack Node Api</code>\u6D41\u7A0B\u53BB\u8BB2\u89E3\uFF0C\u5B9E\u9645\u4E0A\u524D\u7AEF\u65E5\u5E38\u4F7F\u7528\u7684<code>npm run build</code>\u547D\u4EE4\u4E5F\u662F\u901A\u8FC7\u73AF\u5883\u53D8\u91CF\u8C03\u7528<code>bin</code>\u811A\u672C\u53BB\u8C03\u7528<code>Node Api</code>\u53BB\u6267\u884C\u7F16\u8BD1\u6253\u5305\u3002</p></li><li><p><strong>Babel</strong></p><p><code>Webpack</code>\u5185\u90E8\u7684<code>AST</code>\u5206\u6790\u540C\u6837\u4F9D\u8D56\u4E8E<code>Babel</code>\u8FDB\u884C\u5904\u7406\uFF0C\u5982\u679C\u4F60\u5BF9<code>Babel</code>\u4E0D\u662F\u5F88\u719F\u6089\u3002\u5EFA\u8BAE\u53EF\u4EE5\u5148\u53BB\u9605\u8BFB\u4E0B\u8FD9\u4E24\u7BC7\u6587\u7AE0 <strong>\u300C\u524D\u7AEF\u57FA\u5EFA\u300D\u5E26\u4F60\u5728Babel\u7684\u4E16\u754C\u4E2D\u7545\u6E38</strong>\u3001<strong>\u4ECETree Shaking\u6765\u8D70\u8FDBBabel\u63D2\u4EF6\u5F00\u53D1\u8005\u7684\u4E16\u754C</strong>\u3002</p></li></ul><blockquote><p>\u5F53\u7136\u540E\u7EED\u4E5F\u4F1A\u53BB\u8BE6\u89E3\u8FD9\u4E9B\u5185\u5BB9\u5728<code>Webpack</code>\u4E2D\u7684\u5E94\u7528\uFF0C\u4F46\u662F\u6211\u66F4\u52A0\u5E0C\u671B\u5728\u9605\u8BFB\u6587\u7AE0\u4E4B\u524D\u4F60\u53EF\u4EE5\u53BB\u70B9\u4E00\u70B9\u4E0A\u65B9\u7684\u6587\u6863\u7A0D\u5FAE\u4E86\u89E3\u4E00\u4E0B\u524D\u7F6E\u77E5\u8BC6\u3002</p></blockquote><h2 id="\u6D41\u7A0B\u68B3\u7406" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B\u68B3\u7406" aria-hidden="true">#</a> \u6D41\u7A0B\u68B3\u7406</h2><p>\u5728\u5F00\u59CB\u4E4B\u524D\u6211\u4EEC\u5148\u5BF9\u4E8E\u6574\u4E2A\u6253\u5305\u6D41\u7A0B\u8FDB\u884C\u4E00\u6B21\u68B3\u7406\u3002\u8FD9\u91CC\u4EC5\u4EC5\u662F\u4E00\u4E2A\u5168\u6D41\u7A0B\u7684\u68B3\u7406\uFF0C\u73B0\u5728\u6CA1\u6709\u5FC5\u8981\u975E\u5E38\u8BE6\u7EC6\u7684\u53BB\u601D\u8003\u6BCF\u4E00\u4E2A\u6B65\u9AA4\u53D1\u751F\u4E86\u4EC0\u4E48\uFF0C\u6211\u4EEC\u4F1A\u5728\u63A5\u4E0B\u6765\u7684\u6B65\u9AA4\u4E2D\u53BB\u4E00\u6B65\u4E00\u6B65\u5E26\u4F60\u4E32\u8054\u5B83\u4EEC\u3002</p>',5),h=s('<p>\u6574\u4F53\u5C06\u4F1A\u4ECE\u4E0A\u8FB95\u4E2A\u65B9\u9762\u6765\u5206\u6790<code>Webpack</code>\u6253\u5305\u6D41\u7A0B:</p><ol><li><p>\u521D\u59CB\u5316\u53C2\u6570\u9636\u6BB5</p><p>\u8FD9\u4E00\u6B65\u4F1A\u4ECE\u914D\u7F6E\u7684<code>webpack.config.js</code>\u4E2D\u8BFB\u53D6\u5230\u5BF9\u5E94\u7684\u914D\u7F6E\u53C2\u6570\u548C<code>shell</code>\u547D\u4EE4\u4E2D\u4F20\u5165\u7684\u53C2\u6570\u8FDB\u884C\u5408\u5E76\u5F97\u5230\u6700\u7EC8\u6253\u5305\u914D\u7F6E\u53C2\u6570\u3002</p></li><li><p>\u5F00\u59CB\u7F16\u8BD1\u51C6\u5907\u9636\u6BB5</p><p>\u8FD9\u4E00\u6B65\u6211\u4EEC\u4F1A\u901A\u8FC7\u8C03\u7528<code>webpack()</code>\u65B9\u6CD5\u8FD4\u56DE\u4E00\u4E2A<code>compiler</code>\u65B9\u6CD5\uFF0C\u521B\u5EFA\u6211\u4EEC\u7684<code>compiler</code>\u5BF9\u8C61\uFF0C\u5E76\u4E14\u6CE8\u518C\u5404\u4E2A<code>Webpack Plugin</code>\u3002\u627E\u5230\u914D\u7F6E\u5165\u53E3\u4E2D\u7684<code>entry</code>\u4EE3\u7801\uFF0C\u8C03\u7528<code>compiler.run()</code>\u65B9\u6CD5\u8FDB\u884C\u7F16\u8BD1\u3002</p></li><li><p>\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5</p><p>\u4ECE\u5165\u53E3\u6A21\u5757\u8FDB\u884C\u5206\u6790\uFF0C\u8C03\u7528\u5339\u914D\u6587\u4EF6\u7684<code>loaders</code>\u5BF9\u6587\u4EF6\u8FDB\u884C\u5904\u7406\u3002\u540C\u65F6\u5206\u6790\u6A21\u5757\u4F9D\u8D56\u7684\u6A21\u5757\uFF0C\u9012\u5F52\u8FDB\u884C\u6A21\u5757\u7F16\u8BD1\u5DE5\u4F5C\u3002</p></li><li><p>\u5B8C\u6210\u7F16\u8BD1\u9636\u6BB5</p><p>\u5728\u9012\u5F52\u5B8C\u6210\u540E\uFF0C\u6BCF\u4E2A\u5F15\u7528\u6A21\u5757\u901A\u8FC7<code>loaders</code>\u5904\u7406\u5B8C\u6210\u540C\u65F6\u5F97\u5230\u6A21\u5757\u4E4B\u95F4\u7684\u76F8\u4E92\u4F9D\u8D56\u5173\u7CFB\u3002</p></li><li><p>\u8F93\u51FA\u6587\u4EF6\u9636\u6BB5</p><p>\u6574\u7406\u6A21\u5757\u4F9D\u8D56\u5173\u7CFB\uFF0C\u540C\u65F6\u5C06\u5904\u7406\u540E\u7684\u6587\u4EF6\u8F93\u51FA\u5230<code>ouput</code>\u7684\u78C1\u76D8\u76EE\u5F55\u4E2D\u3002 d</p></li></ol><h2 id="\u521B\u5EFA\u76EE\u5F55" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u76EE\u5F55" aria-hidden="true">#</a> \u521B\u5EFA\u76EE\u5F55</h2><p>\u5DE5\u6B32\u5584\u5176\u4E8B\uFF0C\u5FC5\u5148\u5229\u5176\u5668\u3002\u9996\u5148\u8BA9\u6211\u4EEC\u521B\u5EFA\u4E00\u4E2A\u826F\u597D\u7684\u76EE\u5F55\u6765\u7BA1\u7406\u6211\u4EEC\u9700\u8981\u5B9E\u73B0\u7684<code>Packing tool</code>\u5427\uFF01</p><p>\u8BA9\u6211\u4EEC\u6765\u521B\u5EFA\u8FD9\u6837\u4E00\u4E2A\u76EE\u5F55:</p>',5),w=["src"],f=s(`<h2 id="\u521D\u59CB\u5316\u53C2\u6570\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u521D\u59CB\u5316\u53C2\u6570\u9636\u6BB5" aria-hidden="true">#</a> \u521D\u59CB\u5316\u53C2\u6570\u9636\u6BB5</h2><p>\u5F80\u5F80\uFF0C\u6211\u4EEC\u5728\u65E5\u5E38\u4F7F\u7528\u9636\u6BB5\u6709\u4E24\u79CD\u65B9\u5F0F\u53BB\u7ED9<code>webpack</code>\u4F20\u9012\u6253\u5305\u53C2\u6570\uFF0C\u8BA9\u6211\u4EEC\u5148\u6765\u770B\u770B\u5982\u4F55\u4F20\u9012\u53C2\u6570:</p><h3 id="cli\u547D\u4EE4\u884C\u4F20\u9012\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#cli\u547D\u4EE4\u884C\u4F20\u9012\u53C2\u6570" aria-hidden="true">#</a> <code>Cli</code>\u547D\u4EE4\u884C\u4F20\u9012\u53C2\u6570</h3><p>\u901A\u5E38\uFF0C\u6211\u4EEC\u5728\u4F7F\u7528\u8C03\u7528<code>webpack</code>\u547D\u4EE4\u65F6\uFF0C\u6709\u65F6\u4F1A\u4F20\u5165\u4E00\u5B9A\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u6BD4\u5982:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>webpack <span class="token parameter variable">--mode</span><span class="token operator">=</span>production
<span class="token comment"># \u8C03\u7528webpack\u547D\u4EE4\u6267\u884C\u6253\u5305 \u540C\u65F6\u4F20\u5165mode\u4E3Aproduction</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="webpack-config-js\u4F20\u9012\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#webpack-config-js\u4F20\u9012\u53C2\u6570" aria-hidden="true">#</a> <code>webpack.config.js</code>\u4F20\u9012\u53C2\u6570</h3><p>\u53E6\u4E00\u79CD\u65B9\u5F0F\uFF0C\u6211\u76F8\u4FE1\u5C31\u66F4\u52A0\u8001\u751F\u5E38\u8C08\u4E86\u3002</p><p>\u6211\u4EEC\u5728\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u4F7F\u7528<code>webpack.config.js</code>\u5BFC\u51FA\u4E00\u4E2A\u5BF9\u8C61\u8FDB\u884C<code>webpack</code>\u914D\u7F6E:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Plugin1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugins/plugin1&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Plugin2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./plugins/plugin2&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/entry1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">second</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src/entry2.js&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// \u57FA\u7840\u76EE\u5F55\uFF0C\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u7528\u4E8E\u4ECE\u914D\u7F6E\u4E2D\u89E3\u6790\u5165\u53E3\u70B9(entry point)\u548C \u52A0\u8F7D\u5668(loader)\u3002\u6362\u800C\u8A00\u4E4Bentry\u548Cloader\u7684\u6240\u6709\u76F8\u5BF9\u8DEF\u5F84\u90FD\u662F\u76F8\u5BF9\u4E8E\u8FD9\u4E2A\u8DEF\u5F84\u800C\u8A00\u7684</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./build&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name].js&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Plugin1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Plugin2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./loaders/loader1.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./loaders/loader2.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u5F53\u7136\u8FD9\u91CC\u7684<code>loader</code>\u548C<code>plugin</code>\u76EE\u524D\u4F60\u53EF\u4EE5\u4E0D\u7528\u7406\u89E3\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u4F1A\u9010\u6B65\u5B9E\u73B0\u8FD9\u4E9B\u4E1C\u897F\u5E76\u4E14\u6DFB\u52A0\u5230\u6211\u4EEC\u7684\u6253\u5305\u6D41\u7A0B\u4E2D\u53BB\u3002</p></blockquote><h3 id="\u5B9E\u73B0\u5408\u5E76\u53C2\u6570\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u5408\u5E76\u53C2\u6570\u9636\u6BB5" aria-hidden="true">#</a> \u5B9E\u73B0\u5408\u5E76\u53C2\u6570\u9636\u6BB5</h3><p>\u8FD9\u4E00\u6B65\uFF0C\u8BA9\u6211\u4EEC\u771F\u6B63\u5F00\u59CB\u52A8\u624B\u5B9E\u73B0\u6211\u4EEC\u7684<code>webpack</code>\u5427\uFF01</p><p>\u9996\u5148\u8BA9\u6211\u4EEC\u5728<code>webpack/core</code>\u4E0B\u65B0\u5EFA\u4E00\u4E2A<code>index.js</code>\u6587\u4EF6\u4F5C\u4E3A\u6838\u5FC3\u5165\u53E3\u6587\u4EF6\u3002</p><p>\u540C\u65F6\u5EFA\u7ACB\u4E00\u4E2A<code>webpack/core</code>\u4E0B\u65B0\u5EFA\u4E00\u4E2A<code>webpack.js</code>\u6587\u4EF6\u4F5C\u4E3A<code>webpack()</code>\u65B9\u6CD5\u7684\u5B9E\u73B0\u6587\u4EF6\u3002</p><p>\u9996\u5148\uFF0C\u6211\u4EEC\u6E05\u695A\u5728<code>NodeJs Api</code>\u4E2D\u662F\u901A\u8FC7<code>webpack()</code>\u65B9\u6CD5\u53BB\u5F97\u5230<code>compiler</code>\u5BF9\u8C61\u7684\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> compiler <span class="token operator">=</span>  <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> status</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">closeErr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u8BA9\u6211\u4EEC\u6309\u7167\u539F\u672C\u7684<code>webpack</code>\u63A5\u53E3\u683C\u5F0F\u6765\u8865\u5145\u4E00\u4E0B<code>index.js</code>\u4E2D\u7684\u903B\u8F91:</p><ul><li>\u6211\u4EEC\u9700\u8981\u4E00\u4E2A<code>webpack</code>\u65B9\u6CD5\u53BB\u6267\u884C\u8C03\u7528\u547D\u4EE4\u3002</li><li>\u540C\u65F6\u6211\u4EEC\u5F15\u5165<code>webpack.config.js</code>\u914D\u7F6E\u6587\u4EF6\u4F20\u5165<code>webpack</code>\u65B9\u6CD5\u3002</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// index.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../example/webpack.config&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u6B65\u9AA41: \u521D\u59CB\u5316\u53C2\u6570 \u6839\u636E\u914D\u7F6E\u6587\u4EF6\u548Cshell\u53C2\u6570\u5408\u6210\u53C2\u6570</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u55EF\uFF0C\u770B\u8D77\u6765\u8FD8\u4E0D\u9519\u3002\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u53BB\u5B9E\u73B0\u4E00\u4E0B<code>webpack.js</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5408\u5E76\u53C2\u6570 \u5F97\u5230\u5408\u5E76\u540E\u7684\u53C2\u6570 mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u5408\u5E76\u914D\u7F6E\u53C2\u6570</span>
<span class="token keyword">function</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> shellOption <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">option<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> argv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      option<span class="token punctuation">[</span>parseKey<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> option
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token operator">...</span>shellOption<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpack<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u9700\u8981\u989D\u5916\u8BF4\u660E\u7684\u662F</p><p><code>webpack</code>\u6587\u4EF6\u4E2D\u9700\u8981\u5BFC\u51FA\u4E00\u4E2A\u540D\u4E3A<code>webpack</code>\u7684\u65B9\u6CD5\uFF0C\u540C\u65F6\u63A5\u53D7\u5916\u90E8\u4F20\u5165\u7684\u914D\u7F6E\u5BF9\u8C61\u3002\u8FD9\u4E2A\u662F\u6211\u4EEC\u5728\u4E0A\u8FF0\u8BB2\u8FF0\u8FC7\u7684\u3002</p><p>\u5F53\u7136\u5173\u4E8E\u6211\u4EEC\u5408\u5E76\u53C2\u6570\u7684\u903B\u8F91\uFF0C\u662F\u5C06<strong>\u5916\u90E8\u4F20\u5165\u7684\u5BF9\u8C61\u548C\u6267\u884C<code>shell</code>\u65F6\u7684\u4F20\u5165\u53C2\u6570\u8FDB\u884C\u6700\u7EC8\u5408\u5E76</strong>\u3002</p><p>\u5728<code>Node Js</code>\u4E2D\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>process.argv.slice(2)</code>\u6765\u83B7\u5F97<code>shell</code>\u547D\u4EE4\u4E2D\u4F20\u5165\u7684\u53C2\u6570\uFF0C\u6BD4\u5982:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// core/index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Terminal</span>
<span class="token constant">C</span><span class="token operator">:</span>\\Users\\Administrator\\Desktop\\webpack<span class="token operator">-</span>demo<span class="token operator">&gt;</span>node core<span class="token operator">/</span>index<span class="token punctuation">.</span>js <span class="token operator">--</span>mode<span class="token operator">=</span>production <span class="token operator">--</span>devtool<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">[</span> <span class="token string">&#39;--mode=production&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;--devtool=false&#39;</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u7136<code>_mergeOptions</code>\u65B9\u6CD5\u5C31\u662F\u4E00\u4E2A\u7B80\u5355\u7684\u5408\u5E76\u914D\u7F6E\u53C2\u6570\u7684\u65B9\u6CD5\uFF0C\u76F8\u4FE1\u5BF9\u4E8E\u5927\u5BB6\u6765\u8BF4\u5C31\u662F\u5C0F\u83DC\u4E00\u789F\u3002</p><p>\u606D\u559C\u5927\u5BB6\u{1F389}\uFF0C\u5343\u91CC\u4E4B\u884C\u59CB\u4E8E\u8DB3\u4E0B\u3002<strong>\u8FD9\u4E00\u6B65\u6211\u4EEC\u5DF2\u7ECF\u5B8C\u6210\u4E86\u6253\u5305\u6D41\u7A0B\u4E2D\u7684\u7B2C\u4E00\u6B65\uFF1A\u5408\u5E76\u914D\u7F6E\u53C2\u6570</strong>\u3002</p><h2 id="\u7F16\u8BD1\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8BD1\u9636\u6BB5" aria-hidden="true">#</a> \u7F16\u8BD1\u9636\u6BB5</h2><p>\u5728\u5F97\u5230\u6700\u7EC8\u7684\u914D\u7F6E\u53C2\u6570\u4E4B\u540E\uFF0C\u6211\u4EEC\u9700\u8981\u5728<code>webpack()</code>\u51FD\u6570\u4E2D\u505A\u4EE5\u4E0B\u51E0\u4EF6\u4E8B\u60C5:</p><ul><li>\u901A\u8FC7\u53C2\u6570\u521B\u5EFA<code>compiler</code>\u5BF9\u8C61\u3002\u6211\u4EEC\u770B\u5230\u5B98\u65B9\u6848\u4F8B\u4E2D\u901A\u8FC7\u8C03\u7528<code>webpack(options)</code>\u65B9\u6CD5\u8FD4\u56DE\u7684\u662F\u4E00\u4E2A<code>compiler</code>\u5BF9\u8C61\u3002\u5E76\u4E14\u540C\u65F6\u8C03\u7528<code>compiler.run()</code>\u65B9\u6CD5\u542F\u52A8\u7684\u4EE3\u7801\u8FDB\u884C\u6253\u5305\u3002</li><li>\u6CE8\u518C\u6211\u4EEC\u5B9A\u4E49\u7684<code>webpack plugin</code>\u63D2\u4EF6\u3002</li><li>\u6839\u636E\u4F20\u5165\u7684\u914D\u7F6E\u5BF9\u8C61\u5BFB\u627E\u5BF9\u5E94\u7684\u6253\u5305\u5165\u53E3\u6587\u4EF6\u3002</li></ul><h3 id="\u521B\u5EFAcompiler\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFAcompiler\u5BF9\u8C61" aria-hidden="true">#</a> \u521B\u5EFA<code>compiler</code>\u5BF9\u8C61</h3><p>\u8BA9\u6211\u4EEC\u5148\u6765\u5B8C\u6210<code>index.js</code>\u4E2D\u7684\u903B\u8F91\u4EE3\u7801\u8865\u5168:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const webpack = require(&#39;./webpack&#39;);

const config = require(&#39;../example/webpack.config&#39;);

/**
 * \u521D\u59CB\u5316\u53C2\u6570 \u6839\u636E\u914D\u7F6E\u6587\u4EF6\u548Cshell\u53C2\u6570\u5408\u6210\u53C2\u6570
 * \u8C03\u7528 Webpack(options) \u521D\u59CB\u5316compiler\u5BF9\u8C61
 * webpack()\u65B9\u6CD5\u4F1A\u8FD4\u56DE\u4E00\u4E2Acompiler\u5BF9\u8C61
 * */
const compiler = webpack(config);

/**
 * \u8C03\u7528run\u65B9\u6CD5\u8FDB\u884C\u6253\u5305
 * */
compiler.run((err, status) =&gt; {
  if(err) {
    console.log(err)
  }
  // ...
})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6838\u5FC3\u7F16\u8BD1\u5B9E\u73B0\u5728\u4E8E<code>webpack()</code>\u65B9\u6CD5\u8FD4\u56DE\u7684<code>compiler.run()</code>\u65B9\u6CD5\u4E0A\u3002</p><p>\u4E00\u6B65\u4E00\u6B65\u8BA9\u6211\u4EEC\u6765\u5B8C\u5584\u8FD9\u4E2A<code>webpack()</code>\u65B9\u6CD5\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5408\u5E76\u53C2\u6570 \u5F97\u5230\u5408\u5E76\u540E\u7684\u53C2\u6570 mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token comment">// \u521B\u5EFA compiler \u5BF9\u8C61 </span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>mergeOption<span class="token punctuation">)</span>
  <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BA9\u6211\u4EEC\u5728<code>webpack/core</code>\u76EE\u5F55\u4E0B\u540C\u6837\u65B0\u5EFA\u4E00\u4E2A<code>compiler.js</code>\u6587\u4EF6\uFF0C\u4F5C\u4E3A<code>compiler</code>\u7684\u6838\u5FC3\u5B9E\u73B0\u6587\u4EF6:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler \u7C7B\u8FDB\u884C\u6838\u5FC3\u7F16\u8BD1\u5B9E\u73B0
 */</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>

  <span class="token comment">// run\u65B9\u6CD5\u542F\u52A8\u7F16\u8BD1, \u540C\u65F6run\u65B9\u6CD5\u63A5\u53D7\u5916\u90E8\u4F20\u9012\u7684callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u6211\u4EEC\u7684<code>Compiler</code>\u7C7B\u5C31\u5148\u642D\u5EFA\u4E00\u4E2A\u57FA\u7840\u7684\u9AA8\u67B6\u4EE3\u7801\u3002</p><p>\u76EE\u524D\uFF0C\u6211\u4EEC\u62E5\u6709\u4E86:</p><ul><li><code>webpack/core/index.js</code>\u4F5C\u4E3A\u6253\u5305\u547D\u4EE4\u7684\u5165\u53E3\u6587\u4EF6\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u5F15\u7528\u4E86\u6211\u4EEC\u81EA\u5DF1\u5B9E\u73B0\u7684<code>webpack</code>\uFF0C\u540C\u65F6\u5F15\u7528\u4E86\u5916\u90E8\u7684<code>webpack.config.js(options)</code>\u3002\u8C03\u7528<code>webpack(options).run()</code>\u5F00\u59CB\u7F16\u8BD1\u3002</li><li><code>webpack/core/webpack.js</code>\u8FD9\u4E2A\u6587\u4EF6\u76EE\u524D\u5904\u7406\u4E86\u53C2\u6570\u7684\u5408\u5E76\u4EE5\u53CA\u4F20\u5165\u5408\u5E76\u540E\u7684\u53C2\u6570<code>new Compiler(mergeOptions)</code>\uFF0C\u540C\u65F6\u8FD4\u56DE\u521B\u5EFA\u7684<code>Compiler</code>\u5B9E\u529B\u5BF9\u8C61\u3002</li><li><code>webpack/core/compiler</code>\uFF0C\u6B64\u65F6\u6211\u4EEC\u7684<code>compiler</code>\u4EC5\u4EC5\u662F\u4F5C\u4E3A\u4E00\u4E2A\u57FA\u7840\u7684\u9AA8\u67B6\uFF0C\u5B58\u5728\u4E00\u4E2A<code>run()</code>\u542F\u52A8\u65B9\u6CD5\u3002</li></ul><h3 id="\u7F16\u5199plugin" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199plugin" aria-hidden="true">#</a> \u7F16\u5199<code>Plugin</code></h3><p>\u8FD8\u8BB0\u5F97\u6211\u4EEC\u5728<code>webpack.config.js</code>\u4E2D\u4F7F\u7528\u4E86\u4E24\u4E2A<code>plugin</code>---<code>pluginA</code>\u3001<code>pluginB</code>\u63D2\u4EF6\u5417\u3002\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u6765\u4F9D\u6B21\u5B9E\u73B0\u5B83\u4EEC:</p><p>\u5728\u5B9E\u73B0<code>Plugin</code>\u524D\uFF0C\u6211\u4EEC\u9700\u8981\u5148\u6765\u5B8C\u5584\u4E00\u4E0B<code>compiler</code>\u65B9\u6CD5:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler \u7C7B\u8FDB\u884C\u6838\u5FC3\u7F16\u8BD1\u5B9E\u73B0
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token comment">// \u521B\u5EFAplugin\u7684hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5F00\u59CB\u7F16\u8BD1\u7684hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u8F93\u51FA asset \u5230 output \u76EE\u5F55\u4E4B\u524D\u7684hook\uFF0C \u5373\u5199\u5165\u6587\u4EF6\u4E4B\u524D</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u5728 compilation \u5B8C\u6210\u65F6\u6267\u884C \u5168\u90E8\u5B8C\u6210\u7F16\u8BD1\u6267\u884C</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// run\u65B9\u6CD5\u542F\u52A8\u7F16\u8BD1, \u540C\u65F6run\u65B9\u6CD5\u63A5\u53D7\u5916\u90E8\u4F20\u9012\u7684callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\uFF0C\u6211\u4EEC\u5728<code>Compiler</code>\u8FD9\u4E2A\u7C7B\u7684\u6784\u9020\u51FD\u6570\u4E2D\u521B\u5EFA\u4E86\u4E00\u4E2A\u5C5E\u6027<code>hooks</code>\uFF0C\u5B83\u7684\u503C\u662F\u4E09\u4E2A\u5C5E\u6027<code>run</code>\u3001<code>emit</code>\u3001<code>done</code>\u3002</p><p>\u5173\u4E8E\u8FD9\u4E09\u4E2A\u5C5E\u6027\u7684\u503C\u5C31\u662F\u6211\u4EEC\u4E0A\u6587\u63D0\u5230\u524D\u7F6E\u77E5\u8BC6\u7684<code>tapable</code>\u7684<code>SyncHook</code>\u65B9\u6CD5\uFF0C\u672C\u8D28\u4E0A\u4F60\u53EF\u4EE5\u7B80\u5355\u5C06<code>SyncHook()</code>\u65B9\u6CD5\u7406\u89E3\u79F0\u4E3A\u4E00\u4E2A<code>Emitter Event</code>\u7C7B\u3002</p><p>\u5F53\u6211\u4EEC\u901A\u8FC7<code>new SyncHook()</code>\u8FD4\u56DE\u4E00\u4E2A\u5BF9\u8C61\u5B9E\u4F8B\u540E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>this.hook.run.tap(&#39;name&#39;,callback)</code>\u65B9\u6CD5\u4E3A\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u6DFB\u52A0\u4E8B\u4EF6\u76D1\u542C\uFF0C\u7136\u540E\u5728\u901A\u8FC7<code>this.hook.run.call()</code>\u6267\u884C\u6240\u6709<code>tap</code>\u6CE8\u518C\u7684\u4E8B\u4EF6\u3002</p><blockquote><p>\u5F53\u7136<code>webpack</code>\u771F\u5B9E\u6E90\u7801\u4E2D\uFF0C\u8FD9\u91CC\u6709\u975E\u5E38\u591A\u7684<code>hook</code>\u3002\u4EE5\u53CA\u5206\u522B\u5B58\u5728\u540C\u6B65/\u5F02\u6B65\u94A9\u5B50\uFF0C\u8FD9\u91CC\u66F4\u591A\u7684\u662F\u4E3A\u5927\u5BB6\u8BB2\u89E3\u6E05\u695A\u6D41\u7A0B\uFF0C\u6240\u4EE5\u4EC5\u5217\u4E3E\u4E86\u4E09\u4E2A\u5E38\u89C1\u4E14\u7B80\u5355\u7684\u540C\u6B65\u94A9\u5B50\u3002</p></blockquote><p>\u6B64\u65F6\uFF0C\u6211\u4EEC\u9700\u8981\u660E\u767D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>Compiler</code>\u7C7B\u8FD4\u56DE\u7684\u5B9E\u4F8B\u5BF9\u8C61\u4E0A<code>compiler.hooks.run.tap</code>\u6CE8\u518C\u94A9\u5B50\u3002</p><p>\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5207\u56DE\u5230<code>webpack.js</code>\u4E2D\uFF0C\u8BA9\u6211\u4EEC\u6765\u586B\u5145\u5173\u4E8E\u63D2\u4EF6\u6CE8\u518C\u7684\u903B\u8F91:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> Compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./compiler&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5408\u5E76\u53C2\u6570 \u5F97\u5230\u5408\u5E76\u540E\u7684\u53C2\u6570 mergeOptions</span>
  <span class="token keyword">const</span> mergeOption <span class="token operator">=</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token comment">// \u521B\u5EFA compiler \u5BF9\u8C61</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>mergeOption<span class="token punctuation">)</span>
  <span class="token comment">// \u52A0\u8F7D\u63D2\u4EF6</span>
  <span class="token function">_loadPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span>

  <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u5408\u5E76\u914D\u7F6E\u53C2\u6570
 * */</span>
<span class="token keyword">function</span> <span class="token function">_mergeOptions</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> shellOption <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">option<span class="token punctuation">,</span> argv</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> argv<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;=&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseKey <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      option<span class="token punctuation">[</span>parseKey<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> option
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token operator">...</span>shellOption<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u52A0\u8F7D\u63D2\u4EF6\u51FD\u6570
 * */</span>
<span class="token keyword">function</span> <span class="token function">_loadPlugin</span><span class="token punctuation">(</span><span class="token parameter">plugins<span class="token punctuation">,</span> compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpack<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u5728\u521B\u5EFA\u5B8C\u6210<code>compiler</code>\u5BF9\u8C61\u540E\uFF0C\u8C03\u7528\u4E86<code>_loadPlugin</code>\u65B9\u6CD5\u8FDB\u884C<strong>\u6CE8\u518C\u63D2\u4EF6</strong>\u3002</p><p>\u6709\u63A5\u89E6\u8FC7<code>webpack</code>\u63D2\u4EF6\u5F00\u53D1\u7684\u540C\u5B66\uFF0C\u6216\u591A\u6216\u5C11\u53EF\u80FD\u90FD\u6709\u4E86\u89E3\u8FC7\u3002<strong>\u4EFB\u4F55\u4E00\u4E2A<code>webpack</code>\u63D2\u4EF6\u90FD\u662F\u4E00\u4E2A\u7C7B(\u5F53\u7136\u7C7B\u672C\u8D28\u4E0A\u90FD\u662Ffunciton\u7684\u8BED\u6CD5\u7CD6)\uFF0C\u6BCF\u4E2A\u63D2\u4EF6\u90FD\u5FC5\u987B\u5B58\u5728\u4E00\u4E2A<code>apply</code>\u65B9\u6CD5</strong>\u3002</p><p>\u8FD9\u4E2A<code>apply</code>\u65B9\u6CD5\u4F1A\u63A5\u53D7\u4E00\u4E2A<code>compiler</code>\u5BF9\u8C61\u3002\u6211\u4EEC\u4E0A\u8FB9\u505A\u7684\u5C31\u662F\u4F9D\u6B21\u8C03\u7528\u4F20\u5165\u7684<code>plugin</code>\u7684<code>apply</code>\u65B9\u6CD5\u5E76\u4E14\u4F20\u5165\u6211\u4EEC\u7684<code>compiler</code>\u5BF9\u8C61\u3002</p><blockquote><p><strong>\u8FD9\u91CC\u8BF7\u8BB0\u4F4F\u4E0A\u8FB9\u7684\u6D41\u7A0B\uFF0C\u65E5\u5E38\u6211\u4EEC\u7F16\u5199<code>webpack plugin</code>\u65F6\u672C\u8D28\u4E0A\u5C31\u662F\u64CD\u4F5C<code>compiler</code>\u5BF9\u8C61\u4ECE\u800C\u5F71\u54CD\u6253\u5305\u7ED3\u679C\u8FDB\u884C\u3002</strong></p></blockquote><p>\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u53BB\u7F16\u5199\u8FD9\u4E9B\u4E2A\u63D2\u4EF6:</p><p>\u4E0D\u4E86\u89E3\u63D2\u4EF6\u5F00\u53D1\u7684\u540C\u5B66\u53EF\u4EE5\u53BB\u7A0D\u5FAE\u770B\u4E00\u4E0B<strong>\u5B98\u65B9\u7684\u4ECB\u7ECD</strong>\uFF0C\u5176\u5B9E\u4E0D\u662F\u5F88\u96BE\uFF0C\u5F3A\u70C8\u5EFA\u8BAE\u5982\u679C\u4E0D\u4E86\u89E3\u53EF\u4EE5\u5148\u53BB\u770B\u770B\u518D\u56DE\u6765\u7ED3\u5408\u4E0A\u53D8\u8BB2\u7684\u5185\u5BB9\u4F60\u4E00\u5B9A\u4F1A\u6709\u6240\u6536\u83B7\u7684\u3002</p><p>\u9996\u5148\u8BA9\u6211\u4EEC\u5148\u521B\u5EFA\u6587\u4EF6\uFF08plugin1.js\u3001plugin2.js\uFF09:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Plugin1</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6CE8\u518C\u540C\u6B65\u7684\u94A9\u5B50</span>
    <span class="token comment">// \u8FD9\u91CC\u7684 compiler \u5BF9\u8C61\u5C31\u662F\u6211\u4EEC new Compiler() \u521B\u5EFA\u7684\u5B9E\u4F8B</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin 1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u8C03\u7528</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u6CE8\u518C\u63D2\u4EF6 Plugin 1&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Plugin1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Plugin2</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&#39;Plugin 2&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u8C03\u7528</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u6CE8\u518C\u63D2\u4EF6 Plugin 2&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Plugin2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u5230\u8FD9\u91CC\u6211\u76F8\u4FE1\u5927\u90E8\u5206\u540C\u5B66\u90FD\u5DF2\u7ECF\u53CD\u5E94\u8FC7\u6765\u4E86\uFF0C<code>compiler.hooks.run.tap</code>\u548C<code>compiler.hooks.done.tap</code>\u4E0D\u5C31\u662F\u4E0A\u8FB9\u8BB2\u5230\u7684\u901A\u8FC7<code>tapable</code>\u521B\u5EFA\u4E00\u4E2A<code>SyncHook</code>\u5B9E\u4F8B\u7136\u540E\u901A\u8FC7<code>tap</code>\u65B9\u6CD5\u6CE8\u518C\u4E8B\u4EF6\u5417\uFF1F</p><p>\u6CA1\u9519\uFF01\u7684\u786E\u662F\u8FD9\u6837\uFF0C\u5173\u4E8E<code>webpack</code>\u63D2\u4EF6<strong>\u672C\u8D28\u4E0A\u5C31\u662F\u901A\u8FC7\u53D1\u5E03\u8BA2\u9605\u7684\u6A21\u5F0F\uFF0C\u901A\u8FC7<code>compiler</code>\u4E0A\u76D1\u542C\u4E8B\u4EF6\u3002\u7136\u540E\u518D\u6253\u5305\u7F16\u8BD1\u8FC7\u7A0B\u4E2D\u89E6\u53D1\u76D1\u542C\u7684\u4E8B\u4EF6\u4ECE\u800C\u6DFB\u52A0\u4E00\u5B9A\u7684\u903B\u8F91\u5F71\u54CD\u6253\u5305\u7ED3\u679C</strong>\u3002</p><p>\u6211\u4EEC\u5728\u6BCF\u4E2A\u63D2\u4EF6\u7684<code>apply</code>\u65B9\u6CD5\u4E0A\u901A\u8FC7<code>tap</code>\u5728\u7F16\u8BD1\u51C6\u5907\u9636\u6BB5(\u4E5F\u5C31\u662F\u8C03\u7528<code>webpack()</code>\u51FD\u6570\u65F6)\u8FDB\u884C\u8BA2\u9605\u5BF9\u5E94\u7684\u4E8B\u4EF6\uFF0C\u5F53\u6211\u4EEC\u7684\u7F16\u8BD1\u6267\u884C\u5230\u4E00\u5B9A\u9636\u6BB5\u65F6\u53D1\u5E03\u5BF9\u5E94\u7684\u4E8B\u4EF6\u544A\u8BC9\u8BA2\u9605\u8005\u53BB\u6267\u884C\u76D1\u542C\u7684\u4E8B\u4EF6\uFF0C\u4ECE\u800C\u8FBE\u5230\u5728\u7F16\u8BD1\u9636\u6BB5\u7684\u4E0D\u540C\u751F\u547D\u5468\u671F\u5185\u53BB\u89E6\u53D1\u5BF9\u5E94\u7684<code>plugin</code>\u3002</p><blockquote><p>\u6240\u4EE5\u8FD9\u91CC\u5E94\u8BE5\u6E05\u695A\uFF0C\u5728\u8FDB\u884C<code>webpack</code>\u63D2\u4EF6\u5F00\u53D1\u65F6\uFF0C<code>compiler</code>\u5BF9\u8C61\u4E0A\u5B58\u653E\u7740\u672C\u6B21\u6253\u5305\u7684\u6240\u6709\u76F8\u5173\u5C5E\u6027\uFF0C\u6BD4\u5982<code>options</code>\u6253\u5305\u7684\u914D\u7F6E\uFF0C\u4EE5\u53CA\u4E4B\u540E\u8BB2\u5230\u7684\u5404\u79CD\u5C5E\u6027\u3002</p></blockquote><h3 id="\u5BFB\u627Eentry\u5165\u53E3" tabindex="-1"><a class="header-anchor" href="#\u5BFB\u627Eentry\u5165\u53E3" aria-hidden="true">#</a> \u5BFB\u627E<code>entry</code>\u5165\u53E3</h3><p>\u8FD9\u4E4B\u540E\uFF0C\u7EDD\u5927\u591A\u6570\u5185\u5BB9\u90FD\u4F1A\u653E\u5728<code>compiler.js</code>\u4E2D\u53BB\u5B9E\u73B0<code>Compiler</code>\u8FD9\u4E2A\u7C7B\u5B9E\u73B0\u6253\u5305\u7684\u6838\u5FC3\u6D41\u7A0B\u3002</p><p><strong>\u4EFB\u4F55\u4E00\u6B21\u6253\u5305\u90FD\u9700\u8981\u5165\u53E3\u6587\u4EF6\uFF0C\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u5C31\u4ECE\u771F\u6B63\u8FDB\u5165\u6253\u5305\u7F16\u8BD1\u9636\u6BB5\u3002\u9996\u5F53\u5176\u51B2\u7684\u4E8B\u60C5\u5C31\u662F\uFF0C\u6211\u4EEC\u9700\u8981\u6839\u636E\u5165\u53E3\u914D\u7F6E\u6587\u4EF6\u8DEF\u5F84\u5BFB\u627E\u5230\u5BF9\u5E94\u5165\u53E3\u6587\u4EF6\u3002</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler \u7C7B\u8FDB\u884C\u6838\u5FC3\u7F16\u8BD1\u5B9E\u73B0
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> toUnixPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options

    <span class="token comment">// \u76F8\u5BF9\u8DEF\u5F84\u6839\u8DEF\u5F84 Context \u53C2\u6570</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>rootPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>context <span class="token operator">||</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// \u521B\u5EFAplugin\u7684hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5F00\u59CB\u7F16\u8BD1\u7684hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u8F93\u51FA asset \u5230 output \u76EE\u5F55\u4E4B\u524D\u7684hook\uFF0C \u5373\u5199\u5165\u6587\u4EF6\u4E4B\u524D</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u5728 compilation \u5B8C\u6210\u65F6\u6267\u884C \u5168\u90E8\u5B8C\u6210\u7F16\u8BD1\u6267\u884C</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// run\u65B9\u6CD5\u542F\u52A8\u7F16\u8BD1, \u540C\u65F6run\u65B9\u6CD5\u63A5\u53D7\u5916\u90E8\u4F20\u9012\u7684callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5F53\u8C03\u7528run\u65B9\u6CD5\u65F6\uFF0C\u89E6\u53D1\u5F00\u59CB\u7F16\u8BD1\u7684plugin</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u5165\u53E3\u914D\u7F6E\u5BF9\u8C61</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> entry <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">entry</span><span class="token operator">:</span> optionEntry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> optionEntry <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      entry<span class="token punctuation">[</span><span class="token string">&#39;main&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> optionEntry
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      entry <span class="token operator">=</span> optionEntry
    <span class="token punctuation">}</span>

    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryKey</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> entryValue <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryKey<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>entryValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u8F6C\u5316\u4E3A\u7EDD\u5BF9\u8DEF\u5F84\u7684\u540C\u65F6\u540C\u610F\u8DEF\u5F84\u5206\u9694\u7B26\u8BF6 /</span>
        entry<span class="token punctuation">[</span>entryKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> entryValue<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> entry
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * \u7EDF\u4E00\u8DEF\u5F84\u5206\u9694\u7B26 \u4E3B\u8981\u662F\u4E3A\u4E86\u540E\u7EED\u751F\u6210\u6A21\u5757ID\u65B9\u4FBF
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">path</span>
 * <span class="token keyword">@returns</span>
 */</span>
<span class="token keyword">function</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\\\</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E00\u6B65\u6211\u4EEC\u901A\u8FC7<code>options.entry</code>\u5904\u7406\u83B7\u5F97\u5165\u53E3\u6587\u4EF6\u7684\u7EDD\u5BF9\u8DEF\u5F84\u3002</p><p>\u8FD9\u91CC\u6709\u51E0\u4E2A\u9700\u8981\u6CE8\u610F\u7684\u5C0F\u70B9:</p><ul><li><code>this.hooks.run.call()</code></li></ul><p>\u5728\u6211\u4EEC<code>_loadePlugins</code>\u51FD\u6570\u4E2D\u5BF9\u4E8E\u6BCF\u4E00\u4E2A\u4F20\u5165\u7684\u63D2\u4EF6\u5728<code>compiler</code>\u5B9E\u4F8B\u5BF9\u8C61\u4E2D\u8FDB\u884C\u4E86\u8BA2\u9605\uFF0C\u90A3\u4E48\u5F53\u6211\u4EEC\u8C03\u7528<code>run</code>\u65B9\u6CD5\u65F6\uFF0C\u7B49\u4E8E\u771F\u6B63\u5F00\u59CB\u6267\u884C\u7F16\u8BD1\u3002\u8FD9\u4E2A\u9636\u6BB5<strong>\u76F8\u5F53\u4E8E\u6211\u4EEC\u9700\u8981\u544A\u8BC9\u8BA2\u9605\u8005\uFF0C\u53D1\u5E03\u5F00\u59CB\u6267\u884C\u7684\u8BA2\u9605</strong>\u3002\u6B64\u65F6\u6211\u4EEC\u901A\u8FC7<code>this.hooks.run.call()</code>\u6267\u884C\u5173\u4E8E<code>run</code>\u7684\u6240\u6709<code>tap</code>\u76D1\u542C\u65B9\u6CD5\uFF0C\u4ECE\u800C\u89E6\u53D1\u5BF9\u5E94\u7684<code>plugin</code>\u903B\u8F91\u3002</p><ul><li><code>this.rootPath</code>:</li></ul><p>\u5728\u4E0A\u8FF0\u7684\u5916\u90E8<code>webpack.config.js</code>\u4E2D\u6211\u4EEC\u914D\u7F6E\u4E86\u4E00\u4E2A <code>context: process.cwd()</code>\uFF0C\u5176\u5B9E\u771F\u5B9E<code>webpack</code>\u4E2D\u8FD9\u4E2A<code>context</code>\u503C\u9ED8\u8BA4\u4E5F\u662F<code>process.cwd()</code>\u3002</p><p>\u7B80\u800C\u8A00\u4E4B\uFF0C\u8FD9\u4E2A\u8DEF\u5F84\u5C31\u662F\u6211\u4EEC\u9879\u76EE\u542F\u52A8\u7684\u76EE\u5F55\u8DEF\u5F84\uFF0C\u4EFB\u4F55<code>entry</code>\u548C<code>loader</code>\u4E2D\u7684\u76F8\u5BF9\u8DEF\u5F84\u90FD\u662F\u9488\u5BF9\u4E8E<code>context</code>\u8FD9\u4E2A\u53C2\u6570\u7684\u76F8\u5BF9\u8DEF\u5F84\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528<code>this.rootPath</code>\u5728\u6784\u9020\u51FD\u6570\u4E2D\u6765\u4FDD\u5B58\u8FD9\u4E2A\u53D8\u91CF\u3002</p><ul><li><code>toUnixPath</code>\u5DE5\u5177\u65B9\u6CD5:</li></ul><p>\u56E0\u4E3A\u4E0D\u540C\u64CD\u4F5C\u7CFB\u7EDF\u4E0B\uFF0C\u6587\u4EF6\u5206\u9694\u8DEF\u5F84\u662F\u4E0D\u540C\u7684\u3002\u8FD9\u91CC\u6211\u4EEC\u7EDF\u4E00\u4F7F\u7528<code>\\</code>\u6765\u66FF\u6362\u8DEF\u5F84\u4E2D\u7684<code>//</code>\u6765\u66FF\u6362\u6A21\u5757\u8DEF\u5F84\u3002\u540E\u7EED\u6211\u4EEC\u4F1A<strong>\u4F7F\u7528\u6A21\u5757\u76F8\u5BF9\u4E8E<code>rootPath</code>\u7684\u8DEF\u5F84\u4F5C\u4E3A\u6BCF\u4E00\u4E2A\u6587\u4EF6\u7684\u552F\u4E00ID</strong>\uFF0C\u6240\u4EE5\u8FD9\u91CC\u7EDF\u4E00\u5904\u7406\u4E0B\u8DEF\u5F84\u5206\u9694\u7B26\u3002</p><ul><li><code>entry</code>\u7684\u5904\u7406\u65B9\u6CD5:</li></ul><p>\u5173\u4E8E<code>entry</code>\u914D\u7F6E\uFF0C<code>webpack</code>\u4E2D\u5176\u5B9E\u6709\u5F88\u591A\u79CD\u3002\u6211\u4EEC\u8FD9\u91CC\u8003\u8651\u4E86\u6BD4\u8F83\u5E38\u89C1\u7684\u4E24\u79CD\u914D\u7F6E\u65B9\u5F0F:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">&#39;entry1.js&#39;</span>

<span class="token comment">// \u672C\u8D28\u4E0A\u8FD9\u6BB5\u4EE3\u7801\u5728webpack\u4E2D\u4F1A\u88AB\u8F6C\u5316\u4E3A</span>
<span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">main</span><span class="token operator">:</span>&#39;entry1<span class="token punctuation">.</span>js
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">&#39;entry1&#39;</span><span class="token operator">:</span><span class="token string">&#39;./entry1.js&#39;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&#39;entry2&#39;</span><span class="token operator">:</span><span class="token string">&#39;/user/wepback/example/src/entry2.js&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E24\u79CD\u65B9\u5F0F\u4EFB\u4F55\u65B9\u5F0F\u90FD\u4F1A\u7ECF\u8FC7<code>getEntry</code>\u65B9\u6CD5\u6700\u7EC8\u8F6C\u5316\u79F0\u4E3A<code>{ [\u6A21\u5757\u540D]:[\u6A21\u5757\u7EDD\u5BF9\u8DEF\u5F84]... }</code>\u7684\u5F62\u5F0F\uFF0C\u5173\u4E8E<code>getEntry()</code>\u65B9\u6CD5\u5176\u5B9E\u975E\u5E38\u7B80\u5355\uFF0C\u8FD9\u91CC\u5C31\u4E0D\u8FC7\u4E8E\u7D2F\u8D58\u8FD9\u4E2A\u65B9\u6CD5\u7684\u5B9E\u73B0\u8FC7\u7A0B\u4E86\u3002</p><p>\u8FD9\u4E00\u6B65\uFF0C\u6211\u4EEC\u5C31\u901A\u8FC7<code>getEntry</code>\u65B9\u6CD5\u83B7\u5F97\u4E86\u4E00\u4E2A<code>key</code>\u4E3A<code>entryName</code>,<code>value</code>\u4E3A<code>entryAbsolutePath</code>\u7684\u5BF9\u8C61\u4E86\uFF0C\u63A5\u6765\u4E0B\u5C31\u8BA9\u6211\u4EEC\u4ECE\u5165\u53E3\u6587\u4EF6\u51FA\u53D1\u8FDB\u884C\u7F16\u8BD1\u6D41\u7A0B\u5427\u3002</p><h2 id="\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5" aria-hidden="true">#</a> \u6A21\u5757\u7F16\u8BD1\u9636\u6BB5</h2><p>\u4E0A\u8FB9\u6211\u4EEC\u8BB2\u8FF0\u4E86\u5173\u4E8E\u7F16\u8BD1\u9636\u6BB5\u7684\u51C6\u5907\u5DE5\u4F5C:</p><ul><li>\u76EE\u5F55/\u6587\u4EF6\u57FA\u7840\u903B\u8F91\u8865\u5145\u3002</li><li>\u901A\u8FC7<code>hooks.tap</code>\u6CE8\u518C<code>webpack</code>\u63D2\u4EF6\u3002</li><li><code>getEntry</code>\u65B9\u6CD5\u83B7\u5F97\u5404\u4E2A\u5165\u53E3\u7684\u5BF9\u8C61\u3002</li></ul><p>\u63A5\u4E0B\u6765\u8BA9\u6211\u4EEC\u7EE7\u7EED\u5B8C\u5584<code>compiler.js</code>\u3002</p><p>\u5728\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5\uFF0C\u6211\u4EEC\u9700\u8981\u505A\u7684\u4E8B\u4EF6:</p><ul><li>\u6839\u636E\u5165\u53E3\u6587\u4EF6\u8DEF\u5F84\uFF0C\u5206\u6790\u5165\u53E3\u6587\u4EF6\uFF0C\u5BF9\u4E8E\u5165\u53E3\u6587\u4EF6\u8FDB\u884C\u5339\u914D\u5BF9\u5E94\u7684<code>loader</code>\u8FDB\u884C\u5904\u7406\u5165\u53E3\u6587\u4EF6\u3002</li><li>\u5C06<code>loader</code>\u5904\u7406\u5B8C\u6210\u7684\u5165\u53E3\u6587\u4EF6\u4F7F\u7528<code>webpack</code>\u8FDB\u884C\u7F16\u8BD1\u3002</li><li>\u5206\u6790\u5165\u53E3\u6587\u4EF6\u4F9D\u8D56\uFF0C\u91CD\u590D\u4E0A\u8FB9\u4E24\u4E2A\u6B65\u9AA4\u7F16\u8BD1\u5BF9\u5E94\u4F9D\u8D56\u3002</li><li>\u5982\u679C\u5D4C\u5957\u6587\u4EF6\u5B58\u5728\u4F9D\u8D56\u6587\u4EF6\uFF0C\u9012\u5F52\u8C03\u7528\u4F9D\u8D56\u6A21\u5757\u8FDB\u884C\u7F16\u8BD1\u3002</li><li>\u9012\u5F52\u7F16\u8BD1\u5B8C\u6210\u540E\uFF0C\u7EC4\u88C5\u4E00\u4E2A\u4E2A\u5305\u542B\u591A\u4E2A\u6A21\u5757\u7684<code>chunk</code></li></ul><p>\u9996\u5148\uFF0C\u6211\u4EEC\u5148\u6765\u7ED9<code>compiler.js</code>\u7684\u6784\u9020\u51FD\u6570\u4E2D\u8865\u5145\u4E00\u4E0B\u5BF9\u5E94\u7684\u903B\u8F91:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u4FDD\u5B58\u6240\u6709\u5165\u53E3\u6A21\u5757\u5BF9\u8C61</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u4FDD\u5B58\u6240\u6709\u4F9D\u8D56\u6A21\u5757\u5BF9\u8C61</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u6240\u6709\u7684\u4EE3\u7801\u5757\u5BF9\u8C61</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>assets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u5B58\u653E\u672C\u6B21\u4EA7\u51FA\u7684\u6587\u4EF6\u5BF9\u8C61</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \u5B58\u653E\u672C\u6B21\u7F16\u8BD1\u6240\u6709\u4EA7\u51FA\u7684\u6587\u4EF6\u540D</span>

    <span class="token comment">// \u521B\u5EFAplugin\u7684hooks</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u5F00\u59CB\u7F16\u8BD1\u7684hook</span>
      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u8F93\u51FA asset \u5230 output \u76EE\u5F55\u4E4B\u524D\u7684hook\uFF0C \u5373\u5199\u5165\u6587\u4EF6\u4E4B\u524D</span>
      <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// \u5728 compilation \u5B8C\u6210\u65F6\u6267\u884C \u5168\u90E8\u5B8C\u6210\u7F16\u8BD1\u6267\u884C</span>
      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u901A\u8FC7\u7ED9<code>compiler</code>\u6784\u9020\u51FD\u6570\u4E2D\u6DFB\u52A0\u4E00\u4E9B\u5217\u5C5E\u6027\u6765\u4FDD\u5B58\u5173\u4E8E\u7F16\u8BD1\u9636\u6BB5\u751F\u6210\u7684\u5BF9\u5E94\u8D44\u6E90/\u6A21\u5757\u5BF9\u8C61\u3002</p><blockquote><p>\u5173\u4E8E<code>entries\\modules\\chunks\\assets\\files</code>\u8FD9\u51E0\u4E2A<code>Set</code>\u5BF9\u8C61\u662F\u8D2F\u7A7F\u6211\u4EEC\u6838\u5FC3\u6253\u5305\u6D41\u7A0B\u7684\u5C5E\u6027\uFF0C\u5B83\u4EEC\u5404\u81EA\u7528\u6765\u50A8\u5B58\u7F16\u8BD1\u9636\u6BB5\u4E0D\u540C\u7684\u8D44\u6E90\uFF0C\u4ECE\u800C\u6700\u7EC8\u901A\u8FC7\u5BF9\u5E94\u7684\u5C5E\u6027\u8FDB\u884C\u751F\u6210\u7F16\u8BD1\u540E\u7684\u6587\u4EF6\u3002</p></blockquote><h3 id="\u6839\u636E\u5165\u53E3\u6587\u4EF6\u8DEF\u5F84\u5206\u6790\u5165\u53E3\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u6839\u636E\u5165\u53E3\u6587\u4EF6\u8DEF\u5F84\u5206\u6790\u5165\u53E3\u6587\u4EF6" aria-hidden="true">#</a> \u6839\u636E\u5165\u53E3\u6587\u4EF6\u8DEF\u5F84\u5206\u6790\u5165\u53E3\u6587\u4EF6</h3><p>\u4E0A\u8FB9\u8BF4\u5230\u6211\u4EEC\u5728<code>run</code>\u65B9\u6CD5\u4E2D\u5DF2\u7ECF\u53EF\u4EE5\u901A\u8FC7<code>this.getEntry();</code>\u83B7\u5F97\u5BF9\u5E94\u7684\u5165\u53E3\u5BF9\u8C61\u4E86\uFF5E</p><p>\u63A5\u4E0B\u6765\u5C31\u8BA9\u6211\u4EEC\u4ECE\u5165\u53E3\u6587\u4EF6\u5F00\u59CB\u53BB\u5206\u6790\u5165\u53E3\u6587\u4EF6\u5427\uFF01</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * Compiler \u7C7B\u8FDB\u884C\u6838\u5FC3\u7F16\u8BD1\u5B9E\u73B0
 */</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>SyncHook<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;tapable&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>toUnixPath<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// run\u65B9\u6CD5\u542F\u52A8\u7F16\u8BD1, \u540C\u65F6run\u65B9\u6CD5\u63A5\u53D7\u5916\u90E8\u4F20\u9012\u7684callback</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5F53\u8C03\u7528run\u65B9\u6CD5\u65F6\uFF0C\u89E6\u53D1\u5F00\u59CB\u7F16\u8BD1\u7684plugin</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u5165\u53E3\u914D\u7F6E\u5BF9\u8C61</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u7F16\u8BD1\u5165\u53E3\u6587\u4EF6</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildEntryModule</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
      <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u6211\u4EEC\u6DFB\u52A0\u4E86\u4E00\u4E2A\u540D\u4E3A<code>buildEntryModule</code>\u65B9\u6CD5\u4F5C\u4E3A\u5165\u53E3\u6A21\u5757\u7F16\u8BD1\u65B9\u6CD5\u3002\u5FAA\u73AF\u5165\u53E3\u5BF9\u8C61\uFF0C\u5F97\u5230\u6BCF\u4E00\u4E2A\u5165\u53E3\u5BF9\u8C61\u7684\u540D\u79F0\u548C\u8DEF\u5F84\u3002</p><blockquote><p>\u5047\u4F7F\u6211\u4EEC\u5728\u5F00\u5934\u4F20\u5165<code>entry:{ main:&#39;./src/main.js&#39; }</code>\u7684\u8BDD\uFF0C<code>buildEntryModule</code>\u83B7\u5F97\u7684\u5F62\u53C2<code>entry</code>\u4E3A<code>{ main: &quot;/src...[\u4F60\u7684\u7EDD\u5BF9\u8DEF\u5F84]&quot; }</code>\uFF0C\u6B64\u65F6\u6211\u4EEC<code>buildModule</code>\u65B9\u6CD5\u63A5\u53D7\u7684<code>entryName</code>\u4E3A<code>main</code>\uFF0C<code>entryPath</code>\u4E3A\u5165\u53E3\u6587\u4EF6<code>main</code>\u5BF9\u5E94\u7684\u7684\u7EDD\u5BF9\u8DEF\u5F84\u3002\u5355\u4E2A\u5165\u53E3\u7F16\u8BD1\u5B8C\u6210\u540E\uFF0C\u6211\u4EEC\u4F1A\u5728<code>buildModule</code>\u65B9\u6CD5\u4E2D\u8FD4\u56DE\u4E00\u4E2A\u5BF9\u8C61\u3002\u8FD9\u4E2A\u5BF9\u8C61\u5C31\u662F\u6211\u4EEC\u7F16\u8BD1\u5165\u53E3\u6587\u4EF6\u540E\u7684\u5BF9\u8C61\u3002</p></blockquote><h3 id="buildmodule\u6A21\u5757\u7F16\u8BD1\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#buildmodule\u6A21\u5757\u7F16\u8BD1\u65B9\u6CD5" aria-hidden="true">#</a> buildModule\u6A21\u5757\u7F16\u8BD1\u65B9\u6CD5</h3><p>\u5728\u8FDB\u884C\u4EE3\u7801\u7F16\u5199\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u6765\u68B3\u7406\u4E00\u4E0B<code>buildModule</code>\u65B9\u6CD5\u5B83\u9700\u8981\u505A\u54EA\u4E9B\u4E8B\u60C5:</p><ul><li><code>buildModule</code>\u63A5\u53D7\u4E24\u4E2A\u53C2\u6570\u8FDB\u884C\u6A21\u5757\u7F16\u8BD1\uFF0C<strong>\u7B2C\u4E00\u4E2A\u4E3A\u6A21\u5757\u6240\u5C5E\u7684\u5165\u53E3\u6587\u4EF6\u540D\u79F0</strong>\uFF0C\u7B2C\u4E8C\u4E2A\u4E3A\u9700\u8981\u7F16\u8BD1\u7684\u6A21\u5757\u8DEF\u5F84\u3002</li><li><code>buildModule</code>\u65B9\u6CD5\u8981\u8FDB\u884C\u4EE3\u7801\u7F16\u8BD1\u7684\u524D\u63D0\u5C31\u662F\uFF0C\u901A\u8FC7<code>fs</code>\u6A21\u5757\u6839\u636E\u5165\u53E3\u6587\u4EF6\u8DEF\u5F84\u8BFB\u53D6\u6587\u4EF6\u6E90\u4EE3\u7801\u3002</li><li>\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\u4E4B\u540E\uFF0C\u8C03\u7528\u6240\u6709\u5339\u914D\u7684loader\u5BF9\u6A21\u5757\u8FDB\u884C\u5904\u7406\u5F97\u5230\u8FD4\u56DE\u540E\u7684\u7ED3\u679C\u3002</li><li>\u5F97\u5230<code>loader</code>\u5904\u7406\u540E\u7684\u7ED3\u679C\uFF0C\u901A\u8FC7<code>babel</code>\u5206\u6790<code>loader</code>\u5904\u7406\u540E\u7684\u4EE3\u7801\uFF0C\u8FDB\u884C\u4EE3\u7801\u7F16\u8BD1\u3002(\u8FD9\u4E00\u6B65\u7F16\u8BD1\u4E3B\u8981\u662F\u9488\u5BF9<code>require</code>\u8BED\u53E5\uFF0C\u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D<code>require</code>\u8BED\u53E5\u7684\u8DEF\u5F84)\u3002</li><li>\u5982\u679C\u8BE5\u5165\u53E3\u6587\u4EF6\u6CA1\u6709\u4F9D\u8D56\u4E0E\u4EFB\u4F55\u6A21\u5757(<code>require</code>\u8BED\u53E5)\uFF0C\u90A3\u4E48\u8FD4\u56DE\u7F16\u8BD1\u540E\u7684\u6A21\u5757\u5BF9\u8C61\u3002</li><li>\u5982\u679C\u8BE5\u5165\u53E3\u6587\u4EF6\u5B58\u5728\u4F9D\u8D56\u7684\u6A21\u5757\uFF0C\u9012\u5F52<code>buildModule</code>\u65B9\u6CD5\u8FDB\u884C\u6A21\u5757\u7F16\u8BD1\u3002</li></ul><h4 id="\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9" aria-hidden="true">#</a> \u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9</h4><p>\u6211\u4EEC\u5148\u8C03\u7528<code>fs</code>\u6A21\u5757\u8BFB\u53D6\u6587\u4EF6\u5185\u5BB9\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u8BFB\u53D6\u6587\u4EF6\u539F\u59CB\u4EE3\u7801</span>
  <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// moduleCode \u4E3A\u4FEE\u6539\u540E\u4EE3\u7801</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u8C03\u7528loader\u5904\u7406\u5339\u914D\u540E\u7F00\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u8C03\u7528loader\u5904\u7406\u5339\u914D\u540E\u7F00\u6587\u4EF6" aria-hidden="true">#</a> \u8C03\u7528<code>loader</code>\u5904\u7406\u5339\u914D\u540E\u7F00\u6587\u4EF6</h4><p>\u200B \u63A5\u4E0B\u6765\u6211\u4EEC\u83B7\u5F97\u4E86\u6587\u4EF6\u7684\u5177\u4F53\u5185\u5BB9\u4E4B\u540E\uFF0C\u5C31\u9700\u8981\u5339\u914D\u5BF9\u5E94<code>loader</code>\u5BF9\u6211\u4EEC\u7684\u6E90\u4EE3\u7801\u8FDB\u884C\u7F16\u8BD1\u4E86\u3002</p><h5 id="\u5B9E\u73B0\u7B80\u5355\u81EA\u5B9A\u4E49loader" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u7B80\u5355\u81EA\u5B9A\u4E49loader" aria-hidden="true">#</a> \u5B9E\u73B0\u7B80\u5355\u81EA\u5B9A\u4E49loader</h5><p>\u5728\u8FDB\u884C<code>loader</code>\u7F16\u8BD1\u524D\uFF0C\u5148\u6765\u5B9E\u73B0\u4E00\u4E0B\u4E0A\u65B9\u4F20\u5165\u7684\u81EA\u5B9A\u4E49<code>loader</code>\u5427\u3002<code>webpack-demo/loader</code>\u76EE\u5F55\u4E0B\u65B0\u5EFA<code>loader1.js</code>,<code>loader2.js</code>:</p><p>\u9996\u5148\u6211\u4EEC\u9700\u8981\u6E05\u695A<strong>\u7B80\u5355\u6765\u8BF4<code>loader</code>\u672C\u8D28\u4E0A\u5C31\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u63A5\u53D7\u6211\u4EEC\u7684\u6E90\u4EE3\u7801\u4F5C\u4E3A\u5165\u53C2\u540C\u65F6\u8FD4\u56DE\u5904\u7406\u540E\u7684\u7ED3\u679C\u3002</strong></p><blockquote><p>\u56E0\u4E3A\u6587\u7AE0\u4E3B\u8981\u8BB2\u8FF0\u6253\u5305\u6D41\u7A0B\u6240\u4EE5<code>loader</code>\u7B80\u5355\u7684\u4F5C\u4E3A\u5012\u5E8F\u5904\u7406\u3002</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// loader\u672C\u8D28\u4E0A\u5C31\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u63A5\u53D7\u539F\u59CB\u5185\u5BB9\uFF0C\u8FD4\u56DE\u8F6C\u6362\u540E\u7684\u5185\u5BB9</span>
<span class="token keyword">function</span> <span class="token function">loader1</span><span class="token punctuation">(</span><span class="token parameter">sourceCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;use loader1&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sourceCode <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\\n const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// loader\u672C\u8D28\u4E0A\u5C31\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u63A5\u53D7\u539F\u59CB\u5185\u5BB9\uFF0C\u8FD4\u56DE\u8F6C\u6362\u540E\u7684\u5185\u5BB9</span>
<span class="token keyword">function</span> <span class="token function">loader2</span><span class="token punctuation">(</span><span class="token parameter">sourceCode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;use loader2&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sourceCode <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\\n const loader2 = &quot;I&#39;m loader2&quot;;</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="\u4F7F\u7528loader\u5904\u7406\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528loader\u5904\u7406\u6587\u4EF6" aria-hidden="true">#</a> \u4F7F\u7528loader\u5904\u7406\u6587\u4EF6</h5><p>\u641E\u6E05\u695A\u4E86<code>loader</code>\u5C31\u662F\u4E00\u4E2A\u5355\u7EAF\u7684\u51FD\u6570\u4E4B\u540E\uFF0C\u8BA9\u6211\u4EEC\u5728\u8FDB\u884C\u6A21\u5757\u5206\u6790\u4E4B\u524D\u5C06\u5185\u5BB9\u5148\u4EA4\u7ED9\u5339\u914D\u7684loader\u53BB\u5904\u7406\u4E0B\u5427\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.\u8BFB\u53D6\u6587\u4EF6\u539F\u59CB\u4EE3\u7801</span>
  <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">// moduleCode \u4E3A\u4FEE\u6539\u540E\u4EE3\u7801</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
  <span class="token comment">// 2.\u8C03\u7528 loader \u8FDB\u884C\u5904\u7406</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLoader</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">handleLoader</span><span class="token punctuation">(</span><span class="token parameter">modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 1.\u83B7\u53D6\u6240\u6709\u4F20\u5165\u7684loader\u89C4\u5219</span>
  <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules
  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">loader</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> testRule <span class="token operator">=</span> loader<span class="token punctuation">.</span>test
    <span class="token keyword">if</span> <span class="token punctuation">(</span>testRule<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u4EC5\u8003\u8651loader { test:/\\.js$/g, use:[&#39;babel-loader&#39;] } }</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">.</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        matchLoaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        matchLoaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>loader<span class="token punctuation">.</span>use<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.\u5012\u5E8F\u6267\u884Cloader\u4F20\u5165\u7684\u6E90\u4EE3\u7801</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> matchLoaders<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u76EE\u524D\u6211\u4EEC\u5916\u90E8\u4EC5\u652F\u6301\u4F20\u5165\u7EDD\u5BF9\u8DEF\u5F84\u7684loader\u6A21\u5F0F</span>
      <span class="token comment">// require \u5F15\u5165\u5BF9\u5E94\u7684loader</span>
      <span class="token keyword">const</span> loaderFn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>matchLoaders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token comment">// \u901A\u8FC7 loader \u540C\u6B65\u5904\u7406\u6BCF\u4E00\u6B21\u7F16\u8BD1\u7684moduleCode</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> <span class="token function">loaderFn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u901A\u8FC7<code>handleLoader</code>\u51FD\u6570\uFF0C\u5BF9\u4E8E\u4F20\u5165\u7684\u6587\u4EF6\u8DEF\u5F84\u5339\u914D\u5230\u5BF9\u5E94\u540E\u7F00\u7684<code>loader</code>\u540E\uFF0C\u4F9D\u6B21\u5012\u5E8F\u6267\u884Cloader\u5904\u7406\u4EE3\u7801<code>this.moduleCode</code>\u5E76\u4E14\u540C\u6B65\u66F4\u65B0\u6BCF\u6B21<code>moduleCode</code>\u3002</p><p>\u6700\u7EC8\uFF0C\u5728\u6BCF\u4E00\u4E2A\u6A21\u5757\u7F16\u8BD1\u4E2D<code>this.moduleCode</code>\u90FD\u4F1A\u7ECF\u8FC7\u5BF9\u5E94\u7684<code>loader</code>\u5904\u7406\u3002</p><h4 id="webpack\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#webpack\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5" aria-hidden="true">#</a> webpack\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5</h4><p>\u4E0A\u4E00\u6B65\u7ECF\u5386\u8FC7<code>loader</code>\u5904\u7406\u4E86\u5165\u53E3\u6587\u4EF6\u4EE3\u7801\uFF0C\u5E76\u4E14\u5F97\u5230\u4E86\u5904\u7406\u540E\u7684\u4EE3\u7801\u4FDD\u5B58\u5728\u4E86<code>this.moduleCode</code>\u4E2D\u3002</p><p>\u6B64\u65F6\uFF0C\u7ECF\u8FC7<code>loader</code>\u5904\u7406\u540E\u5C31\u8981\u8FDB\u5165<code>webpack</code>\u5185\u90E8\u7684\u7F16\u8BD1\u9636\u6BB5\u4E86\u3002</p><p>\u8FD9\u91CC\u6211\u4EEC\u9700\u8981\u505A\u7684\u662F\uFF1A<strong>\u9488\u5BF9\u5F53\u524D\u6A21\u5757\u8FDB\u884C\u7F16\u8BD1\uFF0C\u5C06\u5F53\u524D\u6A21\u5757\u6240\u6709\u4F9D\u8D56\u7684\u6A21\u5757(<code>require()</code>)\u8BED\u53E5\u5F15\u5165\u7684\u8DEF\u5F84\u53D8\u4E3A\u76F8\u5BF9\u4E8E\u8DDF\u8DEF\u5F84(<code>this.rootPath</code>)\u7684\u76F8\u5BF9\u8DEF\u5F84</strong>\u3002</p><blockquote><p>\u603B\u4E4B\u9700\u8981\u641E\u660E\u767D\u7684\u662F\uFF0C\u8FD9\u91CC\u7F16\u8BD1\u7684\u7ED3\u679C\u662F\u671F\u671B\u5C06\u6E90\u4EE3\u7801\u4E2D\u7684\u4F9D\u8D56\u6A21\u5757\u8DEF\u5F84\u53D8\u4E3A\u76F8\u5BF9\u8DDF\u8DEF\u5F84\u7684\u8DEF\u5F84\uFF0C\u540C\u65F6\u5EFA\u7ACB\u57FA\u7840\u7684\u6A21\u5757\u4F9D\u8D56\u5173\u7CFB\u3002\u540E\u7EED\u4F1A\u8BF4\u660E\u4E3A\u4EC0\u4E48\u9488\u5BF9\u8DEF\u5F84\u8FDB\u884C\u7F16\u8BD1\u3002</p></blockquote><p>\u7EE7\u7EED\u6765\u5B8C\u5584<code>buildModule</code>\u65B9\u6CD5:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>toUnixPath<span class="token punctuation">,</span> tryExtensions<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./utils/index&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/parser&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/traverse&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/generator&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1.\u8BFB\u53D6\u6587\u4EF6\u539F\u59CB\u4EE3\u7801</span>
    <span class="token comment">// const originalSourceCode = (this.originalSourceCode = fs.readFileSync(modulePath, &#39;utf-8&#39;))</span>
    <span class="token keyword">const</span> originalSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// moduleCode \u4E3A\u4FEE\u6539\u540E\u4EE3\u7801</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode <span class="token operator">=</span> originalSourceCode
    <span class="token comment">// 2.\u8C03\u7528 loader \u8FDB\u884C\u5904\u7406</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleLoader</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
    <span class="token comment">// 3.\u8C03\u7528 webpack \u8FDB\u884C\u6A21\u5757\u7F16\u8BD1 \u83B7\u5F97\u6700\u7EC8\u7684 module \u5BF9\u8C61</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWebpackCompiler</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span>
    <span class="token keyword">return</span> module
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
    
  <span class="token comment">// \u4F7F\u7528 webpack \u8FDB\u884C\u6A21\u5757\u7F16\u8BD1</span>
  <span class="token function">handleWebpackCompiler</span><span class="token punctuation">(</span><span class="token parameter">moduleName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5C06\u5F53\u524D\u6A21\u5757\u76F8\u5BF9\u4E8E\u542F\u52A8\u6839\u76EE\u5F55\u8BA1\u7B97\u51FA\u76F8\u5BF9\u8DEF\u5F84 \u4F5C\u4E3A\u6A21\u5757ID</span>
    <span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// \u521B\u5EFA\u6A21\u5757\u5BF9\u8C61</span>
    <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// \u8BE5\u6A21\u5757\u6240\u4F9D\u8D56\u6A21\u5757\u7EDD\u5BF9\u8DEF\u5F84\u5730\u5740</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>moduleName<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// \u8BE5\u6A21\u5FEB\u6240\u5C5E\u7684\u5165\u53E3\u6587\u4EF6</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u8C03\u7528 babel \u5206\u6790\u4EE3\u7801</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>moduleCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// \u6DF1\u5EA6\u4F18\u5316 \u904D\u5386\u8BED\u6CD5tree</span>
    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">CallExpression</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">nodePath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> node <span class="token operator">=</span> nodePath<span class="token punctuation">.</span>node
        <span class="token comment">// \u5F53\u9047\u5230 require \u8BED\u53E5\u65F6</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;require&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// \u83B7\u5F97\u6E90\u4EE3\u7801\u4E2D\u5F15\u5165\u6A21\u5757\u76F8\u5BF9\u8DEF\u5F84</span>
          <span class="token keyword">const</span> moduleName <span class="token operator">=</span> node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
          <span class="token comment">// \u5BFB\u627E\u6A21\u5757\u76F8\u5BF9\u8DEF\u5F84 \u5F53\u524D\u6A21\u5757\u8DEF\u5F84 + require() \u5BF9\u5E94\u7684\u76F8\u5BF9\u8DEF\u5F84</span>
          <span class="token keyword">const</span> moduleDirName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
          <span class="token keyword">const</span> absolutePath <span class="token operator">=</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span>
            <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>moduleDirName<span class="token punctuation">,</span> moduleName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions<span class="token punctuation">,</span>
            moduleName<span class="token punctuation">,</span>
            <span class="token function">toUnixPath</span><span class="token punctuation">(</span>moduleDirName<span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          <span class="token comment">// \u751F\u6210 moduleId - \u9488\u5BF9\u4E8E\u6839\u8DEF\u5F84\u7684\u6A21\u5757ID \u6DFB\u52A0\u8FDB\u5165\u65B0\u7684\u4F9D\u8D56\u6A21\u5757\u8DEF\u5F84</span>
          <span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> absolutePath<span class="token punctuation">)</span>
          <span class="token comment">// \u901A\u8FC7 babel \u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D\u7684 require \u53D8\u6210 __webpack_require__ \u8BED\u53E5</span>
          node<span class="token punctuation">.</span>callee <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;__webpack_require__&#39;</span><span class="token punctuation">)</span>
          <span class="token comment">// \u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D require \u8BED\u53E5\u5F15\u5165\u7684\u6A21\u5757 \u5168\u90E8\u4FEE\u6539\u95EE\u76F8\u5BF9\u4E8E\u6839\u8DEF\u5F84\u6765\u5904\u7406</span>
          node<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">]</span>
          <span class="token comment">// \u4E3A\u5F53\u524D\u6A21\u5757\u6DFB\u52A0 require \u8BED\u53E5\u9020\u6210\u7684\u4F9D\u8D56(\u5185\u5BB9\u4E3A\u76F8\u5BF9\u4E8E\u6839\u8DEF\u5F84\u7684\u6A21\u5757ID)</span>
          module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// \u904D\u5386\u7ED3\u675F\u6839\u636E AST \u751F\u6210\u65B0\u7684\u4EE3\u7801</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
    <span class="token comment">// \u4E3A\u5F53\u524D\u6A21\u5757\u6302\u8F7D\u65B0\u7684\u751F\u6210\u7684\u4EE3\u7801</span>
    module<span class="token punctuation">.</span>_source <span class="token operator">=</span> code
    <span class="token comment">// \u8FD4\u56DE\u5F53\u524D\u6A21\u5757\u5BF9\u8C61</span>
    <span class="token keyword">return</span> module
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E00\u6B65\u5173\u4E8E<code>webpack</code>\u7F16\u8BD1\u7684\u9636\u6BB5\u5C31\u5B8C\u6210\u4E86\u3002</p><p>\u9700\u8981\u6CE8\u610F\u7684\u662F:</p><ul><li><p>\u8FD9\u91CC\u4F7F\u7528<code>babel</code>\u76F8\u5173\u7684<code>API</code>\u9488\u5BF9\u4E8E<code>require</code>\u8BED\u53E5\u8FDB\u884C\u4E86\u7F16\u8BD1\u3002</p></li><li><p>\u540C\u65F6\u4EE3\u7801\u4E2D\u5F15\u7528\u4E86\u4E00\u4E2A<code>tryExtensions()</code>\u5DE5\u5177\u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u65B9\u6CD5\u662F\u9488\u5BF9\u4E8E\u540E\u7F00\u540D\u4E0D\u5168\u7684\u5DE5\u5177\u65B9\u6CD5\uFF0C\u7A0D\u540E\u4F60\u5C31\u53EF\u4EE5\u770B\u5230\u8FD9\u4E2A\u65B9\u6CD5\u7684\u5177\u4F53\u5185\u5BB9\u3002</p></li><li><p>\u9488\u5BF9\u4E8E\u6BCF\u4E00\u6B21\u6587\u4EF6\u7F16\u8BD1\uFF0C\u6211\u4EEC\u90FD\u4F1A\u8FD4\u56DE\u4E00\u4E2A<strong>module</strong>\u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u662F\u91CD\u4E2D\u4E4B\u91CD\u3002</p></li><li><ul><li><code>id</code>\u5C5E\u6027\uFF0C\u8868\u793A\u5F53\u524D\u6A21\u5757\u9488\u5BF9\u4E8E<code>this.rootPath</code>\u7684\u76F8\u5BF9\u76EE\u5F55\u3002</li><li><code>dependencies</code>\u5C5E\u6027\uFF0C\u5B83\u662F\u4E00\u4E2A<code>Set</code>\u5185\u90E8\u4FDD\u5B58\u4E86\u8BE5\u6A21\u5757\u4F9D\u8D56\u7684\u6240\u6709\u6A21\u5757\u7684\u6A21\u5757ID\u3002</li><li><code>name</code>\u5C5E\u6027,\u5B83\u8868\u793A\u8BE5\u6A21\u5757\u5C5E\u4E8E\u54EA\u4E2A\u5165\u53E3\u6587\u4EF6\u3002</li><li><code>_source</code>\u5C5E\u6027\uFF0C\u5B83\u5B58\u653E\u6A21\u5757\u81EA\u8EAB\u7ECF\u8FC7<code>babel</code>\u7F16\u8BD1\u540E\u7684\u5B57\u7B26\u4E32\u4EE3\u7801\u3002</li></ul></li></ul><h5 id="tryextensions\u65B9\u6CD5\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#tryextensions\u65B9\u6CD5\u5B9E\u73B0" aria-hidden="true">#</a> tryExtensions\u65B9\u6CD5\u5B9E\u73B0</h5><p>\u5728\u4E0A\u6587\u7684<code>webpack.config.js</code>\u6709\u8FD9\u4E48\u4E00\u4E2A\u914D\u7F6E\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;.vue&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u719F\u6089<code>webpack</code>\u914D\u7F6E\u53EF\u80FD\u6E05\u695A\uFF0C<strong>resolve.extensions</strong>\u662F\u9488\u5BF9\u4E8E\u5F15\u5165\u4F9D\u8D56\u65F6\uFF0C\u5728\u6CA1\u6709\u4E66\u5199\u6587\u4EF6\u540E\u7F00\u7684\u60C5\u51B5\u4E0B\uFF0C<code>webpack</code>\u4F1A\u81EA\u52A8\u5E2E\u6211\u4EEC\u6309\u7167\u4F20\u5165\u7684\u89C4\u5219\u4E3A\u6587\u4EF6\u6DFB\u52A0\u540E\u7F00\u3002</p><p>\u5728\u6E05\u695A\u4E86\u539F\u7406\u540E\u6211\u4EEC\u6765\u4E00\u8D77\u770B\u770B<code>utils/tryExtensions</code>\u65B9\u6CD5\u7684\u5B9E\u73B0:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">modulePath</span> path.posix.join\u62FF\u5230\u7684\u6A21\u5757\u7EDD\u5BF9\u8DEF\u5F84
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">extensions</span> \u6269\u5C55\u540D\u6570\u7EC4
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">originModulePath</span> \u539F\u59CB\u5F15\u5165\u6A21\u5757\u8DEF\u5F84
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">moduleContext</span> path.posix.dirname\u62FF\u5230\u7684\u5F53\u524D\u6A21\u5757\u6240\u5728\u76EE\u5F55\uFF0C\u6A21\u5757\u4E0A\u4E0B\u6587
 * */</span>
<span class="token keyword">function</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span><span class="token parameter">modulePath<span class="token punctuation">,</span> extensions<span class="token punctuation">,</span> originModulePath<span class="token punctuation">,</span> moduleContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u4F18\u5148\u5C1D\u8BD5\u4E0D\u9700\u8981\u62D3\u5C55\u540D\u7684\u9009\u9879</span>
  extensions<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> extension <span class="token keyword">of</span> extensions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5224\u65AD\u8DEF\u5F84\u662F\u5426\u5B58\u5728</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>modulePath <span class="token operator">+</span> extension<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> modulePath <span class="token operator">+</span> extension
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u672A\u5339\u914D\u5230\u5BF9\u5E94\u6587\u4EF6</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">No module, Error: Can&#39;t resolve </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>originModulePath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>moduleContext<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u65B9\u6CD5\u5F88\u7B80\u5355\uFF0C\u6211\u4EEC\u901A\u8FC7<code>fs.existsSync</code>\u68C0\u67E5\u4F20\u5165\u6587\u4EF6\u7ED3\u5408<code>extensions</code>\u4F9D\u6B21\u904D\u5386\u5BFB\u627E\u5BF9\u5E94\u5339\u914D\u7684\u8DEF\u5F84\u662F\u5426\u5B58\u5728\uFF0C\u5982\u679C\u627E\u5230\u5219\u76F4\u63A5\u8FD4\u56DE\u3002\u5982\u679C\u672A\u627E\u5230\u5219\u7ED9\u4E88\u7528\u4E8E\u4E00\u4E2A\u53CB\u597D\u7684\u63D0\u793A\u9519\u8BEF\u3002</p><blockquote><p>\u9700\u8981\u6CE8\u610F <code>extensions.unshift(&#39;&#39;);</code>\u662F\u9632\u6B62\u7528\u6237\u5982\u679C\u5DF2\u7ECF\u4F20\u5165\u4E86\u540E\u7F00\u65F6\uFF0C\u6211\u4EEC\u4F18\u5148\u5C1D\u8BD5\u76F4\u63A5\u5BFB\u627E\uFF0C\u5982\u679C\u53EF\u4EE5\u627E\u5230\u6587\u4EF6\u90A3\u4E48\u5C31\u76F4\u63A5\u8FD4\u56DE\u3002\u627E\u4E0D\u5230\u7684\u60C5\u51B5\u4E0B\u624D\u4F1A\u4F9D\u6B21\u5C1D\u8BD5\u3002</p></blockquote><h4 id="\u9012\u5F52\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#\u9012\u5F52\u5904\u7406" aria-hidden="true">#</a> \u9012\u5F52\u5904\u7406</h4><p>\u7ECF\u8FC7\u4E0A\u4E00\u6B65\u5904\u7406\uFF0C\u9488\u5BF9\u5165\u53E3\u6587\u4EF6\u6211\u4EEC\u8C03\u7528<code>buildModule</code>\u53EF\u4EE5\u5F97\u5230\u8FD9\u6837\u7684\u8FD4\u56DE\u5BF9\u8C61\u3002</p><p>\u6211\u4EEC\u5148\u6765\u770B\u770B\u8FD0\u884C<code>webpack/core/index.js</code>\u5F97\u5230\u7684\u8FD4\u56DE\u7ED3\u679C\u5427\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\nconst loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\nconst loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u5728<code>buildEntryModule</code>\u4E2D\u6253\u5370\u4E86\u5904\u7406\u5B8C\u6210\u540E\u7684<code>entries</code>\u5BF9\u8C61\u3002\u53EF\u4EE5\u770B\u5230\u6B63\u5982\u6211\u4EEC\u4E4B\u524D\u6240\u671F\u5F85\u7684:</p><ul><li><code>id</code>\u4E3A\u6BCF\u4E2A\u6A21\u5757\u76F8\u5BF9\u4E8E\u8DDF\u8DEF\u5F84\u7684\u6A21\u5757.(\u8FD9\u91CC\u6211\u4EEC\u914D\u7F6E\u7684<code>context:process.cwd()</code>)\u4E3A<code>webpack</code>\u76EE\u5F55\u3002</li><li><code>dependencies</code>\u4E3A\u8BE5\u6A21\u5757\u5185\u90E8\u4F9D\u8D56\u7684\u6A21\u5757\uFF0C\u8FD9\u91CC\u76EE\u524D\u8FD8\u6CA1\u6709\u6DFB\u52A0\u3002</li><li><code>name</code>\u4E3A\u8BE5\u6A21\u5757\u6240\u5C5E\u7684\u5165\u53E3\u6587\u4EF6\u540D\u79F0\u3002</li><li><code>_source</code>\u4E3A\u8BE5\u6A21\u5757\u7F16\u8BD1\u540E\u7684\u6E90\u4EE3\u7801\u3002</li></ul><p>\u6B64\u65F6\u6253\u5F00<code>src</code>\u76EE\u5F55\u4E3A\u5165\u53E3\u6587\u4EF6\u6DFB\u52A0\u4E00\u4E9B\u4F9D\u8D56\u548C\u5185\u5BB9\u5427:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// webpack/example/entry1.js</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// webpack/example/entry2.js</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 2 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// webpack/example/demo.js</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">&#39;JSH&#39;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u8BA9\u6211\u4EEC\u91CD\u65B0\u8FD0\u884C<code>webpack-demo/core/index.js</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OK\uFF0C\u76EE\u524D\u4E3A\u6B62\u9488\u5BF9\u4E8E<code>entry</code>\u7684\u7F16\u8BD1\u53EF\u4EE5\u6682\u65F6\u544A\u4E00\u6BB5\u843D\u4E86\u3002</p><p><strong>\u603B\u4E4B\u4E5F\u5C31\u662F\uFF0C\u8FD9\u4E00\u6B65\u901A\u8FC7\u65B9\u6CD5\u5C06<code>entry</code>\u8FDB\u884C\u5206\u6790\u7F16\u8BD1\u540E\u5F97\u5230\u4E00\u4E2A\u5BF9\u8C61\u3002\u5C06\u8FD9\u4E2A\u5BF9\u8C61\u6DFB\u52A0\u5230<code>this.entries</code>\u4E2D\u53BB\u3002</strong></p><p>\u63A5\u4E0B\u6765\u53BB\u5904\u7406\u4F9D\u8D56\u7684\u6A21\u5757\u3002</p><p>\u5176\u5B9E\u5BF9\u4E8E\u4F9D\u8D56\u7684\u6A21\u5757\u65E0\u975E\u4E5F\u662F\u76F8\u540C\u7684\u6B65\u9AA4\uFF1A</p><ul><li>\u68C0\u67E5\u5165\u53E3\u6587\u4EF6\u4E2D\u662F\u5426\u5B58\u5728\u4F9D\u8D56\u3002</li><li>\u5B58\u5728\u4F9D\u8D56\u7684\u8BDD\uFF0C\u9012\u5F52\u8C03\u7528<code>buildModule</code>\u65B9\u6CD5\u7F16\u8BD1\u6A21\u5757\u3002\u4F20\u5165<code>moduleName</code>\u4E3A\u5F53\u524D\u6A21\u5757\u6240\u5C5E\u7684\u5165\u53E3\u6587\u4EF6\u3002<code>modulePath</code>\u4E3A\u5F53\u524D\u88AB\u4F9D\u8D56\u6A21\u5757\u7684\u7EDD\u5BF9\u8DEF\u5F84\u3002</li><li>\u540C\u7406\u68C0\u67E5\u9012\u5F52\u68C0\u67E5\u88AB\u4F9D\u8D56\u7684\u6A21\u5757\u5185\u90E8\u662F\u5426\u4ECD\u7136\u5B58\u5728\u4F9D\u8D56\uFF0C\u5B58\u5728\u7684\u8BDD\u9012\u5F52\u4F9D\u8D56\u8FDB\u884C\u6A21\u5757\u7F16\u8BD1\u3002\u8FD9\u662F\u4E00\u4E2A<strong>\u6DF1\u5EA6\u4F18\u5148</strong>\u7684\u8FC7\u7A0B\u3002</li><li>\u5C06\u6BCF\u4E00\u4E2A\u7F16\u8BD1\u540E\u7684\u6A21\u5757\u4FDD\u5B58\u8FDB\u5165<code>this.modules</code>\u4E2D\u53BB\u3002</li></ul><p>\u63A5\u4E0B\u6765\u53EA\u8981\u7A0D\u7A0D\u5728<code>handleWebpackCompiler</code>\u65B9\u6CD5\u4E2D\u7A0D\u7A0D\u6539\u52A8\u5C31\u53EF\u4EE5\u4E86:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u9012\u5F52\u4F9D\u8D56\u6DF1\u5EA6\u904D\u5386 \u5B58\u5728\u4F9D\u8D56\u6A21\u5757\u5219\u52A0\u5165</span>
module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dependency</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> depModule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">,</span> dependency<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u5C06\u7F16\u8BD1\u540E\u7684\u4EFB\u4F55\u4F9D\u8D56\u6A21\u5757\u5BF9\u8C61\u52A0\u5165\u5230modules\u5BF9\u8C61\u4E2D\u53BB</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>depModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5BF9\u4E8E\u4F9D\u8D56\u7684\u6A21\u5757\u8FDB\u884C\u4E86\u9012\u5F52\u8C03\u7528<code>buildModule</code>,\u5C06\u8F93\u51FA\u7684\u6A21\u5757\u5BF9\u8C61\u6DFB\u52A0\u8FDB\u5165\u4E86<code>this.modules</code>\u4E2D\u53BB\u3002</p><p>\u6B64\u65F6\u8BA9\u91CD\u65B0\u8FD0\u884C<code>webpack/core/index.js</code>\u8FDB\u884C\u7F16\u8BD1\uFF0C\u8FD9\u91CC\u5728<code>buildEntryModule</code>\u7F16\u8BD1\u7ED3\u675F\u540E\u6253\u5370\u4E86<code>assets</code>\u548C<code>modules</code>:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
    <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;entries&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;modules&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
modules Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\u5DF2\u7ECF\u5C06<code>demo.js</code>\u8FD9\u4E2A\u4F9D\u8D56\u5982\u613F\u4EE5\u507F\u52A0\u5165\u5230<code>modules</code>\u4E2D\u4E86\uFF0C\u540C\u65F6\u5B83\u4E5F\u7ECF\u8FC7<code>loader</code>\u7684\u5904\u7406\u3002\u4F46\u662F\u6211\u4EEC\u53D1\u73B0\u5B83\u88AB\u91CD\u590D\u52A0\u5165\u4E86\u4E24\u6B21\u3002</p><p>\u8FD9\u662F\u56E0\u4E3A<strong>demo.js</strong>\u8FD9\u4E2A\u6A21\u5757\u88AB\u5F15\u7528\u4E86\u4E24\u6B21\uFF0C\u5B83\u88AB<code>entry1</code>\u548C<code>entry2</code>\u90FD\u5DF2\u8FDB\u884C\u4E86\u4F9D\u8D56\uFF0C\u5728\u8FDB\u884C\u9012\u5F52\u7F16\u8BD1\u65F6\u8FDB\u884C\u4E86\u4E24\u6B21<code>buildModule</code>\u76F8\u540C\u6A21\u5757\u3002</p><p>\u90A3\u4E48\u6765\u5904\u7406\u4E0B\u8FD9\u4E2A\u95EE\u9898\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u751F\u6210 moduleId - \u9488\u5BF9\u4E8E\u6839\u8DEF\u5F84\u7684\u6A21\u5757ID \u6DFB\u52A0\u8FDB\u5165\u65B0\u7684\u4F9D\u8D56\u6A21\u5757\u8DEF\u5F84</span>
<span class="token keyword">const</span> moduleId <span class="token operator">=</span> <span class="token string">&#39;./&#39;</span> <span class="token operator">+</span> <span class="token function">toUnixPath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rootPath<span class="token punctuation">,</span> absolutePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// \u901A\u8FC7 babel \u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D\u7684 require \u53D8\u6210 __webpack_require__ \u8BED\u53E5</span>
node<span class="token punctuation">.</span>callee <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;__webpack_require__&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// \u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D require \u8BED\u53E5\u5F15\u5165\u7684\u6A21\u5757 \u5168\u90E8\u4FEE\u6539\u95EE\u76F8\u5BF9\u4E8E\u6839\u8DEF\u5F84\u6765\u5904\u7406</span>
node<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token comment">// \u8F6C\u5316\u5F53\u524D this.modules \u4E3A ids</span>
<span class="token keyword">const</span> alreadyModules <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>alreadyModules<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u4E3A\u5F53\u524D\u6A21\u5757\u6DFB\u52A0 require \u8BED\u53E5\u9020\u6210\u7684\u4F9D\u8D56(\u5185\u5BB9\u4E3A\u76F8\u5BF9\u4E8E\u6839\u8DEF\u5F84\u7684\u6A21\u5757ID)</span>
  module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>id <span class="token operator">===</span> moduleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5728\u6BCF\u4E00\u6B21\u4EE3\u7801\u5206\u6790\u7684\u4F9D\u8D56\u8F6C\u5316\u4E2D\uFF0C\u9996\u5148\u5224\u65AD<code>this.module</code>\u5BF9\u8C61\u662F\u5426\u5DF2\u7ECF\u5B58\u5728\u5F53\u524D\u6A21\u5757\u4E86\uFF08\u901A\u8FC7\u552F\u4E00\u7684\u6A21\u5757id\u8DEF\u5F84\u5224\u65AD\uFF09\u3002</p><p>\u5982\u679C\u4E0D\u5B58\u5728\u5219\u6DFB\u52A0\u8FDB\u5165\u4F9D\u8D56\u4E2D\u8FDB\u884C\u7F16\u8BD1\uFF0C\u5982\u679C\u8BE5\u6A21\u5757\u5DF2\u7ECF\u5B58\u5728\u8FC7\u4E86\u5C31\u8BC1\u660E\u8FD9\u4E2A\u6A21\u5757\u5DF2\u7ECF\u88AB\u7F16\u8BD1\u8FC7\u4E86\u3002\u6240\u4EE5\u6B64\u65F6\u4E0D\u9700\u8981\u5C06\u5B83\u518D\u6B21\u8FDB\u884C\u7F16\u8BD1\uFF0C\u4EC5\u4EC5\u9700\u8981\u66F4\u65B0\u8FD9\u4E2A\u6A21\u5757\u6240\u5C5E\u7684chunk\uFF0C\u4E3A\u5B83\u7684<code>name</code>\u5C5E\u6027\u6DFB\u52A0\u5F53\u524D\u6240\u5C5E\u7684<code>chunk</code>\u540D\u79F0\u3002</p><p>\u91CD\u65B0\u8FD0\u884C\uFF0C\u518D\u6765\u770B\u770B\u6253\u5370\u7ED3\u679C:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>entries Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span> <span class="token string">&#39;./example/src/demo.js&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;second&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
modules Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/demo.js&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./demo&#39;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&quot;const name = &#39;JSH&#39;;\\n&quot;</span> <span class="token operator">+</span>
      <span class="token string">&#39;module.exports = {\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;  name\\n&#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;};\\n&#39;</span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u65F6\u9488\u5BF9\u201C\u6A21\u5757\u7F16\u8BD1\u9636\u6BB5\u201D\u57FA\u672C\u5DF2\u7ECF\u7ED3\u675F\u4E86\uFF0C\u8FD9\u4E00\u6B65\u5BF9\u4E8E\u6240\u6709\u6A21\u5757\u4ECE\u5165\u53E3\u6587\u4EF6\u5F00\u59CB\u8FDB\u884C\u5206\u6790\u3002</p><ul><li>\u4ECE\u5165\u53E3\u51FA\u53D1\uFF0C\u8BFB\u53D6\u5165\u53E3\u6587\u4EF6\u5185\u5BB9\u8C03\u7528\u5339\u914D<code>loader</code>\u5904\u7406\u5165\u53E3\u6587\u4EF6\u3002</li><li>\u901A\u8FC7<code>babel</code>\u5206\u6790\u4F9D\u8D56\uFF0C\u5E76\u4E14\u540C\u65F6\u5C06\u6240\u6709\u4F9D\u8D56\u7684\u8DEF\u5F84\u66F4\u6362\u4E3A\u76F8\u5BF9\u4E8E\u9879\u76EE\u542F\u52A8\u76EE\u5F55<code>options.context</code>\u7684\u8DEF\u5F84\u3002</li><li>\u5165\u53E3\u6587\u4EF6\u4E2D\u5982\u679C\u5B58\u5728\u4F9D\u8D56\u7684\u8BDD\uFF0C\u9012\u5F52\u4E0A\u8FF0\u6B65\u9AA4\u7F16\u8BD1\u4F9D\u8D56\u6A21\u5757\u3002</li><li>\u5C06\u6BCF\u4E2A\u4F9D\u8D56\u7684\u6A21\u5757\u7F16\u8BD1\u540E\u7684\u5BF9\u8C61\u52A0\u5165<code>this.modules</code>\u3002</li><li>\u5C06\u6BCF\u4E2A\u5165\u53E3\u6587\u4EF6\u7F16\u8BD1\u540E\u7684\u5BF9\u8C61\u52A0\u5165<code>this.entries</code>\u3002</li></ul><h2 id="\u7F16\u8BD1\u5B8C\u6210\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8BD1\u5B8C\u6210\u9636\u6BB5" aria-hidden="true">#</a> \u7F16\u8BD1\u5B8C\u6210\u9636\u6BB5</h2><p>\u5728\u4E0A\u4E00\u6B65\u5B8C\u6210\u4E86\u6A21\u5757\u4E4B\u95F4\u7684\u7F16\u8BD1\uFF0C\u5E76\u4E14\u4E3A<code>module</code>\u548C<code>entry</code>\u5206\u522B\u586B\u5145\u4E86\u5185\u5BB9\u3002</p><p>\u5728\u5C06\u6240\u6709\u6A21\u5757\u9012\u5F52\u7F16\u8BD1\u5B8C\u6210\u540E\uFF0C\u9700\u8981<strong>\u6839\u636E\u4E0A\u8FF0\u7684\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7EC4\u5408\u6700\u7EC8\u8F93\u51FA\u7684<code>chunk</code>\u6A21\u5757</strong>\u3002</p><p>\u7EE7\u7EED\u6539\u9020\u6211\u4EEC\u7684<code>Compiler</code>\u5427:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">buildEntryModule</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entryPath <span class="token operator">=</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span>
    <span class="token comment">// \u8C03\u7528 buildModule \u5B9E\u73B0\u771F\u6B63\u7684\u6A21\u5757\u7F16\u8BD1\u903B\u8F91</span>
    <span class="token keyword">const</span> entityObj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryPath<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entityObj<span class="token punctuation">)</span>
    <span class="token comment">// \u6839\u636E\u5F53\u524D\u5165\u53E3\u6587\u4EF6\u548C\u6A21\u5757\u7684\u76F8\u4E92\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7EC4\u88C5\u6210\u4E3A\u4E00\u4E2A\u4E2A\u5305\u542B\u5F53\u524D\u5165\u53E3\u6240\u6709\u4F9D\u8D56\u6A21\u5757\u7684chunk</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildUpChunk</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entityObj<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;entries&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;modules&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;chunks&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

  <span class="token function">buildUpChunk</span><span class="token punctuation">(</span><span class="token parameter">entryName<span class="token punctuation">,</span> entityObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> entryName<span class="token punctuation">,</span> <span class="token comment">// \u6BCF\u4E00\u4E2A\u5165\u53E3\u6587\u4EF6\u4F5C\u4E3A\u4E00\u4E2Achunk</span>
      <span class="token literal-property property">entryModule</span><span class="token operator">:</span> entityObj<span class="token punctuation">,</span>  <span class="token comment">// entry\u7F16\u8BD1\u540E\u7684\u5BF9\u8C61</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \u5BFB\u627E\u4E0E\u5F53\u524Dentry\u6709\u5173\u7684\u6240\u6709module</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u5C06chunk\u6DFB\u52A0\u5230this.chunks\u4E2D\u53BB</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\uFF0C\u6839\u636E\u5BF9\u5E94\u7684\u5165\u53E3\u6587\u4EF6\u901A\u8FC7\u6BCF\u4E00\u4E2A\u6A21\u5757(<code>module</code>)\u7684<code>name</code>\u5C5E\u6027\u67E5\u627E\u5BF9\u5E94\u5165\u53E3\u7684\u6240\u6709\u4F9D\u8D56\u6587\u4EF6\u3002</p><p>\u5148\u6765\u770B\u770B<code>this.chunks</code>\u6700\u7EC8\u4F1A\u8F93\u51FA\u4EC0\u4E48:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chunks Set <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;main&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryModule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry1.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token punctuation">[</span>Set<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;This is entry 1 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;second&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryModule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;./example/src/entry2.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">[</span>Array<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">_source</span><span class="token operator">:</span> <span class="token string">&#39;const demo = __webpack_require__(&quot;./example/src/demo.js&quot;);\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&#39;\\n&#39;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;demo&#39;, demo);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot;console.log(&#39;This is entry 2 !&#39;);\\n&quot;</span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader2 = &quot;I&#39;m loader2&quot;;\\n</span><span class="token template-punctuation string">\`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">const loader1 = &quot;I&#39;m loader1&quot;;</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4E00\u6B65\uFF0C<strong>\u5F97\u5230\u4E86<code>Webpack</code>\u4E2D\u6700\u7EC8\u8F93\u51FA\u7684\u4E24\u4E2A<code>chunk</code></strong>\u3002</p><p>\u5B83\u4EEC\u5206\u522B\u62E5\u6709:</p><ul><li><code>name</code>:\u5F53\u524D\u5165\u53E3\u6587\u4EF6\u7684\u540D\u79F0</li><li><code>entryModule</code>: \u5165\u53E3\u6587\u4EF6\u7F16\u8BD1\u540E\u7684\u5BF9\u8C61\u3002</li><li><code>modules</code>: \u8BE5\u5165\u53E3\u6587\u4EF6\u4F9D\u8D56\u7684\u6240\u6709\u6A21\u5757\u5BF9\u8C61\u7EC4\u6210\u7684\u6570\u7EC4\uFF0C\u5176\u4E2D\u6BCF\u4E00\u4E2A\u5143\u7D20\u7684\u683C\u5F0F\u548C<code>entryModule</code>\u662F\u4E00\u81F4\u7684\u3002</li></ul><p>\u6B64\u65F6\u7F16\u8BD1\u5B8C\u6210\uFF0C\u62FC\u88C5<code>chunk</code>\u7684\u73AF\u8282\u5C31\u5706\u6EE1\u5B8C\u6210\u3002</p><h2 id="\u8F93\u51FA\u6587\u4EF6\u9636\u6BB5" tabindex="-1"><a class="header-anchor" href="#\u8F93\u51FA\u6587\u4EF6\u9636\u6BB5" aria-hidden="true">#</a> \u8F93\u51FA\u6587\u4EF6\u9636\u6BB5</h2><h3 id="\u5206\u6790\u539F\u59CB\u6253\u5305\u8F93\u51FA\u7ED3\u679C" tabindex="-1"><a class="header-anchor" href="#\u5206\u6790\u539F\u59CB\u6253\u5305\u8F93\u51FA\u7ED3\u679C" aria-hidden="true">#</a> \u5206\u6790\u539F\u59CB\u6253\u5305\u8F93\u51FA\u7ED3\u679C</h3><p>\u8FD9\u91CC\uFF0C\u6211\u628A<code>webpack-demo/core/index.js</code>\u4E2D\u505A\u4E86\u5982\u4E0B\u4FEE\u6539:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">-</span> <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./webpack&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;webpack&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u7528\u539F\u672C\u7684<code>webpack</code>\u4EE3\u66FF\u81EA\u5DF1\u5B9E\u73B0\u7684<code>webpack</code>\u5148\u8FDB\u884C\u4E00\u6B21\u6253\u5305\u3002</p><p>\u8FD0\u884C<code>webpack-demo/core/index.js</code>\u540E\uFF0C\u6211\u4EEC\u4F1A\u5728<code>webpack-demo/src/build</code>\u4E2D\u5F97\u5230\u4E24\u4E2A\u6587\u4EF6:<code>main.js</code>\u548C<code>second.js</code>\uFF0C\u4EE5\u5176\u4E2D\u4E00\u4E2A<code>main.js</code>\u6765\u770B\u770B\u5B83\u7684\u5185\u5BB9:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token doc-comment comment">/***/ &quot;./example/src/demo.js&quot;:
/*!*****************************!*\\
  !*** ./example/src/demo.js ***!
  \\*****************************/</span>
<span class="token doc-comment comment">/***/ ((module) =&gt; <span class="token punctuation">{</span>

const name = &#39;JSH&#39;;

module.exports = <span class="token punctuation">{</span>
  name,
<span class="token punctuation">}</span>;
 const loader2 = &quot;I&#39;m loader2&quot;;
 const loader1 = &quot;I&#39;m loader1&quot;;

/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token doc-comment comment">/******/</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/************************************************************************/</span>
<span class="token doc-comment comment">/******/</span>   <span class="token comment">// The module cache</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_module_cache__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>   <span class="token comment">// The require function</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Check if module is in cache</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>     <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>    <span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Create a new module (and put it into the cache)</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">var</span> module <span class="token operator">=</span> __webpack_module_cache__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token doc-comment comment">/******/</span>     <span class="token comment">// no module.id needed</span>
<span class="token doc-comment comment">/******/</span>     <span class="token comment">// no module.loaded needed</span>
<span class="token doc-comment comment">/******/</span>     <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Execute the module function</span>
<span class="token doc-comment comment">/******/</span>    __webpack_modules__<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/******/</span>    <span class="token comment">// Return the exports of the module</span>
<span class="token doc-comment comment">/******/</span>    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token doc-comment comment">/******/</span>   <span class="token punctuation">}</span>
<span class="token doc-comment comment">/******/</span>   
<span class="token doc-comment comment">/************************************************************************/</span>
<span class="token keyword">var</span> __webpack_exports__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">/*!*******************************!*\\
  !*** ./example/src/entry1.js ***!
  \\*******************************/</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./demo */</span> <span class="token string">&quot;./example/src/demo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> loader2 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader2&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> loader1 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6765\u7A0D\u5FAE\u5206\u6790\u4E00\u4E0B\u539F\u59CB\u6253\u5305\u751F\u6210\u7684\u4EE3\u7801\uFF1A</p><p><code>webpack</code>\u6253\u5305\u540E\u7684\u4EE3\u7801\u5185\u90E8\u5B9A\u4E49\u4E86\u4E00\u4E2A<code>__webpack_require__</code>\u7684\u51FD\u6570\u4EE3\u66FF\u4E86<code>NodeJs</code>\u5185\u90E8\u7684<code>require</code>\u65B9\u6CD5\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.</span>
<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">/*!*******************************!*\\
  !*** ./example/src/entry1.js ***!
  \\*******************************/</span>
<span class="token keyword">const</span> demo <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./demo */</span> <span class="token string">&quot;./example/src/demo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;demo&#39;</span><span class="token punctuation">,</span> demo<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is entry 1 !&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> loader2 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader2&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> loader1 <span class="token operator">=</span> <span class="token string">&quot;I&#39;m loader1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/******/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u5757\u4EE3\u7801\u76F8\u6BD4\u5927\u5BB6\u90FD\u5F88\u719F\u6089\u5427\uFF0C\u8FD9\u5C31\u662F\u81EA\u5DF1\u7F16\u8BD1\u540E\u7684\u5165\u53E3\u6587\u4EF6\u4EE3\u7801\u3002\u540C\u65F6\u9876\u90E8\u7684\u4EE3\u7801\u662F\u8BE5\u5165\u53E3\u6587\u4EF6\u4F9D\u8D56\u7684\u6240\u6709\u6A21\u5757\u5B9A\u4E49\u7684\u4E00\u4E2A\u5BF9\u8C61:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/******/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
<span class="token doc-comment comment">/******/</span>   <span class="token keyword">var</span> __webpack_modules__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>

<span class="token doc-comment comment">/***/ &quot;./example/src/demo.js&quot;:
/*!*****************************!*\\
  !*** ./example/src/demo.js ***!
  \\*****************************/</span>
<span class="token doc-comment comment">/***/ ((module) =&gt; <span class="token punctuation">{</span>

const name = &#39;JSH&#39;;

module.exports = <span class="token punctuation">{</span>
  name,
<span class="token punctuation">}</span>;
 const loader2 = &quot;I&#39;m loader2&quot;;
 const loader1 = &quot;I&#39;m loader1&quot;;

/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\u5B9A\u4E49\u4E86\u4E00\u4E2A<code>__webpack__modules</code>\u7684\u5BF9\u8C61\uFF0C\u5BF9\u8C61\u7684<code>key</code>\u4E3A\u8BE5\u4F9D\u8D56\u6A21\u5757\u76F8\u5BF9\u4E8E\u8DDF\u8DEF\u5F84\u7684\u76F8\u5BF9\u8DEF\u5F84\uFF0C\u5BF9\u8C61\u7684<code>value</code>\u8BE5\u4F9D\u8D56\u6A21\u5757\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u3002</p><h3 id="\u8F93\u51FA\u6587\u4EF6\u9636\u6BB5-1" tabindex="-1"><a class="header-anchor" href="#\u8F93\u51FA\u6587\u4EF6\u9636\u6BB5-1" aria-hidden="true">#</a> \u8F93\u51FA\u6587\u4EF6\u9636\u6BB5</h3><p>\u63A5\u4E0B\u91CC\u5728\u5206\u6790\u5B8C<code>webpack</code>\u539F\u59CB\u6253\u5305\u540E\u7684\u4EE3\u7801\u4E4B\u540E\uFF0C\u6765\u7EE7\u7EED\u4E0A\u4E00\u6B65\u3002\u901A\u8FC7<code>this.chunks</code>\u6765\u5C1D\u8BD5\u8F93\u51FA\u6700\u7EC8\u7684\u6548\u679C\u5427\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// run\u65B9\u6CD5\u542F\u52A8\u7F16\u8BD1, \u540C\u65F6run\u65B9\u6CD5\u63A5\u53D7\u5916\u90E8\u4F20\u9012\u7684callback</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5F53\u8C03\u7528run\u65B9\u6CD5\u65F6\uFF0C\u89E6\u53D1\u5F00\u59CB\u7F16\u8BD1\u7684plugin</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u83B7\u53D6\u5165\u53E3\u914D\u7F6E\u5BF9\u8C61</span>
  <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u7F16\u8BD1\u5165\u53E3\u6587\u4EF6</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildEntryModule</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
  <span class="token comment">// \u5BFC\u51FA\u5217\u8868 \u4E4B\u540E\u5C06\u6BCF\u4E2Achunk\u8F6C\u5316\u4E3A\u5355\u72EC\u7684\u6587\u4EF6 \u52A0\u5165\u5230\u8F93\u51FA\u5217\u8868 this.assets \u4E2D</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">exportFile</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728<code>buildEntryModule</code>\u6A21\u5757\u7F16\u8BD1\u5B8C\u6210\u4E4B\u540E\uFF0C\u901A\u8FC7<code>this.exportFile</code>\u65B9\u6CD5\u5B9E\u73B0\u5BFC\u51FA\u6587\u4EF6\u7684\u903B\u8F91\u3002</p><p>\u6765\u4E00\u8D77\u770B\u770B<code>this.exportFile</code>\u65B9\u6CD5:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// \u5C06chunk\u52A0\u5165\u8F93\u51FA\u5217\u8868\u4E2D\u53BB</span>
  <span class="token function">exportFile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>output
    <span class="token comment">// \u6839\u636E chunks \u751F\u6210\u7684 assets \u5185\u5BB9</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> parseFileName <span class="token operator">=</span> output<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;[name]&#39;</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token comment">// assets \u4E2D { &#39;main.js&#39;: &#39;\u4EE3\u7801\u5B57\u7B26\u4E32&#39; }</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>parseFileName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getSourceCode</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
      <span class="token comment">// files \u4E2D\u4FDD\u5B58\u6240\u6709\u7684\u751F\u6210\u6587\u4EF6\u540D</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>parseFileName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// \u8C03\u7528 plugin emit \u94A9\u5B50</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u5224\u65AD\u76EE\u5F55\u662F\u5426\u5B58\u5728 \u5B58\u5728\u5C31\u76F4\u63A5 fs.write \u4E0D\u5B58\u5728\u5C31\u9700\u8981\u65B0\u5EFA\u76EE\u5F55</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u5C06 assets \u4E2D\u7684\u5185\u5BB9\u751F\u6210\u6253\u5305\u6587\u4EF6 \u5199\u5165\u6587\u4EF6\u7CFB\u7EDF\u4E2D</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fileName</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// \u7ED3\u675F\u4E4B\u540E \u8C03\u7528 plugin done \u94A9\u5B50</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">toJSON</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">entries</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>entries<span class="token punctuation">,</span>
          <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span>
          <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span>
          <span class="token literal-property property">assets</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">,</span>
          <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>exportFile</code>\u505A\u4E86\u5982\u4E0B\u51E0\u4EF6\u4E8B:</p><ul><li>\u9996\u5148\u83B7\u53D6\u914D\u7F6E\u53C2\u6570\u7684\u8F93\u51FA\u914D\u7F6E\uFF0C\u8FED\u4EE3\u6211\u4EEC\u7684<code>this.chunks</code>\uFF0C\u5C06<code>output.filename</code>\u4E2D\u7684<code>[name]</code>\u66FF\u6362\u79F0\u4E3A\u5BF9\u5E94\u7684\u5165\u53E3\u6587\u4EF6\u540D\u79F0\u3002\u540C\u65F6\u6839\u636E<code>chunks</code>\u7684\u5185\u5BB9\u4E3A<code>this.assets</code>\u4E2D\u6DFB\u52A0\u9700\u8981\u6253\u5305\u751F\u6210\u7684\u6587\u4EF6\u540D\u548C\u6587\u4EF6\u5185\u5BB9\u3002</li><li>\u5C06\u6587\u4EF6\u5199\u5165\u78C1\u76D8\u524D\u8C03\u7528<code>plugin</code>\u7684<code>emit</code>\u94A9\u5B50\u51FD\u6570\u3002</li><li>\u5224\u65AD<code>output.path</code>\u6587\u4EF6\u5939\u662F\u5426\u5B58\u5728\uFF0C\u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u5219\u901A\u8FC7<code>fs</code>\u65B0\u5EFA\u8FD9\u4E2A\u6587\u4EF6\u5939\u3002</li><li>\u5C06\u672C\u6B21\u6253\u5305\u751F\u6210\u7684\u6240\u6709\u6587\u4EF6\u540D(<code>this.assets</code>\u7684<code>key</code>\u503C\u7EC4\u6210\u7684\u6570\u7EC4)\u5B58\u653E\u8FDB\u5165<code>files</code>\u4E2D\u53BB\u3002</li><li>\u5FAA\u73AF<code>this.assets</code>\uFF0C\u5C06\u6587\u4EF6\u4F9D\u6B21\u5199\u5165\u5BF9\u5E94\u7684\u78C1\u76D8\u4E2D\u53BB\u3002</li><li>\u6240\u6709\u6253\u5305\u6D41\u7A0B\u7ED3\u675F\uFF0C\u89E6\u53D1<code>webpack</code>\u63D2\u4EF6\u7684<code>done</code>\u94A9\u5B50\u3002</li><li>\u540C\u65F6\u4E3A<code>NodeJs Webpack APi</code>\u547C\u5E94\uFF0C\u8C03\u7528<code>run</code>\u65B9\u6CD5\u4E2D\u5916\u90E8\u4F20\u5165\u7684<code>callback</code>\u4F20\u5165\u4E24\u4E2A\u53C2\u6570\u3002</li></ul><p>\u603B\u7684\u6765\u8BF4\uFF0C<code>this.assets</code>\u505A\u7684\u4E8B\u60C5\u4E5F\u6BD4\u8F83\u7B80\u5355\uFF0C\u5C31\u662F\u901A\u8FC7\u5206\u6790<code>chunks</code>\u5F97\u5230<code>assets</code>\u7136\u540E\u8F93\u51FA\u5BF9\u5E94\u7684\u4EE3\u7801\u5230\u78C1\u76D8\u4E2D\u3002</p><p>\u4ED4\u7EC6\u770B\u8FC7\u4E0A\u8FB9\u4EE3\u7801\uFF0C\u4F1A\u53D1\u73B0<code>this.assets</code>\u8FD9\u4E2A<code>Map</code>\u4E2D\u6BCF\u4E00\u4E2A\u5143\u7D20\u7684<code>value</code>\u662F\u901A\u8FC7\u8C03\u7528<code>getSourceCode(chunk)</code>\u65B9\u6CD5\u6765\u751F\u6210\u6A21\u5757\u5BF9\u5E94\u7684\u4EE3\u7801\u7684\u3002</p><p>\u90A3\u4E48<code>getSourceCode</code>\u8FD9\u4E2A\u65B9\u6CD5\u662F\u5982\u4F55\u6839\u636E<code>chunk</code>\u6765\u751F\u6210\u6700\u7EC8\u7F16\u8BD1\u540E\u7684\u4EE3\u7801\u5462\uFF1F\u4E00\u8D77\u6765\u770B\u770B\u5427\uFF01</p><h3 id="getsourcecode\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#getsourcecode\u65B9\u6CD5" aria-hidden="true">#</a> <code>getSourceCode</code>\u65B9\u6CD5</h3><p>\u9996\u5148\u7B80\u5355\u660E\u786E\u4E00\u4E0B\u8FD9\u4E2A\u65B9\u6CD5\u7684\u804C\u8D23\uFF0C\u9700\u8981<code>getSourceCode</code>\u65B9\u6CD5\u63A5\u53D7\u4F20\u5165\u7684<code>chunk</code>\u5BF9\u8C61\u3002\u4ECE\u800C\u8FD4\u56DE\u8BE5<code>chunk</code>\u7684\u6E90\u4EE3\u7801\u3002</p><p>\u5E9F\u8BDD\u4E0D\u591A\u8BF4\uFF0C\u5176\u5B9E\u8FD9\u91CC\u7528\u4E86\u4E00\u4E2A\u6BD4\u8F83\u5077\u61D2\u7684\u529E\u6CD5\uFF0C\u4F46\u662F\u5B8C\u5168\u4E0D\u59A8\u788D\u7406\u89E3<code>Webpack</code>\u6D41\u7A0B\uFF0C\u4E0A\u8FB9\u5206\u6790\u8FC7\u539F\u672C<code>webpack</code>\u6253\u5305\u540E\u7684\u4EE3\u7801<strong>\u4EC5\u4EC5\u53EA\u6709\u5165\u53E3\u6587\u4EF6\u548C\u6A21\u5757\u4F9D\u8D56\u662F\u6BCF\u6B21\u6253\u5305\u4E0D\u540C\u7684\u5730\u65B9\uFF0C\u5173\u4E8E<code>require</code>\u65B9\u6CD5\u4E4B\u7C7B\u90FD\u662F\u76F8\u901A\u7684</strong>\u3002</p><p>\u628A\u63E1\u6BCF\u6B21\u7684\u4E0D\u540C\u70B9\uFF0C\u76F4\u63A5\u5148\u6765\u770B\u770B\u5B83\u7684\u5B9E\u73B0\u65B9\u5F0F:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">chunk</span>
 * name\u5C5E\u6027\u5165\u53E3\u6587\u4EF6\u540D\u79F0
 * entryModule\u5165\u53E3\u6587\u4EF6module\u5BF9\u8C61
 * modules \u4F9D\u8D56\u6A21\u5757\u8DEF\u5F84
 */</span>
<span class="token keyword">function</span> <span class="token function">getSourceCode</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> entryModule<span class="token punctuation">,</span> modules <span class="token punctuation">}</span> <span class="token operator">=</span> chunk<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
(() =&gt; {
var __webpack_modules__ = ({
  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span> modules<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>module<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;: ((module) =&gt; {</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>module<span class="token punctuation">.</span>_source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">})</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">).join(&#39;,&#39;) }
 \\t});

 \\tvar __webpack_module_cache__ = {};

 \\tfunction __webpack_require__(moduleId) {
 \\t\\tvar cachedModule = __webpack_module_cache__[moduleId];
 \\t\\tif (cachedModule !== undefined) {
 \\t\\t\\treturn cachedModule.exports;
 \\t\\t}
 \\t\\tvar module = __webpack_module_cache__[moduleId] = {
 \\t\\t\\texports: {}
 \\t\\t};

 \\t\\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);

 \\t\\treturn module.exports;
\\t}

  var __webpack_exports__ = {};
  (() =&gt; {
    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span> entryModule<span class="token punctuation">.</span>_source <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  })();

 })()
;
  </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6BB5\u4EE3\u7801\u5176\u5B9E\u975E\u5E38\u7B80\u5355\uFF0C\u8FDC\u8FDC\u6CA1\u6709\u60F3\u8C61\u96BE\uFF01\u6709\u70B9\u8FD4\u749E\u5F52\u771F\u7684\u611F\u89C9\u662F\u5417\u54C8\u54C8\u3002</p><p>\u5728<code>getSourceCode</code>\u65B9\u6CD5\u4E2D\uFF0C\u901A\u8FC7\u7EC4\u5408\u800C\u6765\u7684<code>chunk</code>\u83B7\u5F97\u5BF9\u5E94\u7684:</p><ul><li><code>name</code>: \u8BE5\u5165\u53E3\u6587\u4EF6\u5BF9\u5E94\u8F93\u51FA\u6587\u4EF6\u7684\u540D\u79F0\u3002</li><li><code>entryModule</code>: \u5B58\u653E\u8BE5\u5165\u53E3\u6587\u4EF6\u7F16\u8BD1\u540E\u7684\u5BF9\u8C61\u3002</li><li><code>modules</code>:\u5B58\u653E\u8BE5\u5165\u53E3\u6587\u4EF6\u4F9D\u8D56\u7684\u6240\u6709\u6A21\u5757\u7684\u5BF9\u8C61\u3002</li></ul><p><strong>\u901A\u8FC7\u5B57\u7B26\u4E32\u62FC\u63A5\u7684\u65B9\u5F0F\u53BB\u5B9E\u73B0\u4E86<code>__webpack__modules</code>\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027\uFF0C\u540C\u65F6\u4E5F\u5728\u5E95\u90E8\u901A\u8FC7<code>\${entryModule._source}</code>\u62FC\u63A5\u51FA\u5165\u53E3\u6587\u4EF6\u7684\u4EE3\u7801\u3002</strong></p><blockquote><p>\u4E0A\u6587\u63D0\u5230\u8FC7\u4E3A\u4EC0\u4E48\u8981\u5C06\u6A21\u5757\u7684<code>require</code>\u65B9\u6CD5\u7684\u8DEF\u5F84\u8F6C\u5316\u4E3A\u76F8\u5BF9\u4E8E\u8DDF\u8DEF\u5F84(<code>context</code>)\u7684\u8DEF\u5F84\uFF0C\u770B\u5230\u8FD9\u91CC\u76F8\u4FE1\u5927\u5BB6\u90FD\u5DF2\u7ECF\u4E86\u7136\u4E8E\u80F8\u4E86\u3002\u56E0\u4E3A\u6700\u7EC8\u5B9E\u73B0\u7684<code>__webpack_require__</code>\u65B9\u6CD5\u5168\u90FD\u662F\u9488\u5BF9\u4E8E\u6A21\u5757\u76F8\u5BF9\u4E8E\u8DDF\u8DEF\u5F84\u7684\u76F8\u5BF9\u8DEF\u5F84\u5B9E\u73B0\u7684<code>require</code>\u65B9\u6CD5\u3002\u540C\u65F6\u5982\u679C\u4E0D\u592A\u6E05\u695A<code>require</code>\u65B9\u6CD5\u662F\u5982\u4F55\u8F6C\u6210\u4E3A<code>__webpack_require__</code>\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u91CD\u65B0\u56DE\u5230\u7F16\u8BD1\u73AF\u8282\u91CD\u65B0\u9605\u8BFB\uFF5E\u901A\u8FC7<code>babel</code>\u5728<code>AST</code>\u8F6C\u5316\u9636\u6BB5\u5C06<code>require</code>\u65B9\u6CD5\u8C03\u7528\u53D8\u6210\u4E86<code>__webpack_require__</code>\u3002</p></blockquote><h1 id="\u5927\u529F\u544A\u6210" tabindex="-1"><a class="header-anchor" href="#\u5927\u529F\u544A\u6210" aria-hidden="true">#</a> \u5927\u529F\u544A\u6210</h1><p>\u81F3\u6B64\uFF0C\u8BA9\u6211\u4EEC\u56DE\u5230<code>webpack-demo/core/index.js</code>\u4E2D\u53BB\u3002\u91CD\u65B0\u8FD0\u884C\u8FD9\u4E2A\u6587\u4EF6\uFF0C\u4F60\u4F1A\u53D1\u73B0<code>webpack-demo/example</code>\u76EE\u5F55\u4E0B\u4F1A\u591A\u51FA\u4E00\u4E2A<code>build</code>\u76EE\u5F55\u3002</p><p>\u5230\u8FD9\u5B9E\u73B0\u5C5E\u4E8E\u6211\u4EEC\u81EA\u5DF1\u7684<code>webpack</code>\u3002</p><p>\u5B9E\u8D28\u4E0A\uFF0C\u5BF9\u4E8E\u5B9E\u73B0\u4E00\u4E2A\u7B80\u5355\u7248\u7684<code>webpack</code>\u6838\u5FC3\uFF0C\u8FD8\u662F\u5E0C\u671B\u5927\u5BB6\u53EF\u4EE5\u5728\u7406\u89E3\u5B83\u7684\u5DE5\u4F5C\u6D41\u7684\u540C\u65F6\u5F7B\u5E95\u7406\u89E3<code>compiler</code>\u8FD9\u4E2A\u5BF9\u8C61\u3002</p><p>\u5728\u4E4B\u540E\u7684\u5173\u4E8E<code>webpack</code>\u76F8\u5173\u5E95\u5C42\u5F00\u53D1\u4E2D\uFF0C\u771F\u6B63\u505A\u5230\u5BF9\u4E8E<code>compiler</code>\u7684\u7528\u6CD5\u4E86\u7136\u4E8E\u80F8\u3002\u4E86\u89E3<code>compiler</code>\u4E0A\u7684\u5404\u79CD\u5C5E\u6027\u662F\u5982\u4F55\u5F71\u54CD\u5230\u7F16\u8BD1\u6253\u5305\u7ED3\u679C\u7684\u3002</p>`,222);function _(t,j){const o=p("ExternalLinkIcon"),c=p("Mermaid");return i(),u("div",null,[k,n("blockquote",null,[n("p",null,[m,n("a",v,[b,e(o)]),g])]),r(" more "),y,e(c,{id:"mermaid-382ee1c9",code:"%20%20%20graph%20LR%0A%20%20%20A%5B%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0%5D%20--%3EB%5B%E7%BC%96%E8%AF%91%5D%0A%20%20%20%20B%20--%3E%20C%5B%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91%5D%0A%20%20%20%20C%20--%3E%20D%5B%E5%AE%8C%E6%88%90%E7%BC%96%E8%AF%91%5D%0A%20%20%20%20D%20--%3E%20E%5B%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%5D%0A"}),h,n("img",{src:t.$withBase("/assets/knowledge/frontEnd/configuration/webpack/fileDirectory.jpg")},null,8,w),f])}const P=l(d,[["render",_],["__file","index.html.vue"]]);export{P as default};
