<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器缓存 | 繁华中自律，落魄中自愈</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <link rel="javascript" href="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="Just playing around">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.296af3c4.css" as="style"><link rel="preload" href="/assets/js/app.0fce6bc4.js" as="script"><link rel="preload" href="/assets/js/3.112caaf3.js" as="script"><link rel="preload" href="/assets/js/12.195031a5.js" as="script"><link rel="preload" href="/assets/js/20.e3cfb8e1.js" as="script"><link rel="preload" href="/assets/js/9.6fa6f9fb.js" as="script"><link rel="prefetch" href="/assets/js/10.342ae458.js"><link rel="prefetch" href="/assets/js/11.b46a05ce.js"><link rel="prefetch" href="/assets/js/13.cd8e0535.js"><link rel="prefetch" href="/assets/js/14.d2eedf34.js"><link rel="prefetch" href="/assets/js/15.aea9e2e9.js"><link rel="prefetch" href="/assets/js/16.3670cb6a.js"><link rel="prefetch" href="/assets/js/17.e290339e.js"><link rel="prefetch" href="/assets/js/18.270a6946.js"><link rel="prefetch" href="/assets/js/19.b5b6fb2e.js"><link rel="prefetch" href="/assets/js/21.614b13f2.js"><link rel="prefetch" href="/assets/js/22.fd3675a8.js"><link rel="prefetch" href="/assets/js/23.7c695225.js"><link rel="prefetch" href="/assets/js/24.f55d5481.js"><link rel="prefetch" href="/assets/js/25.11e25262.js"><link rel="prefetch" href="/assets/js/26.06fb44d6.js"><link rel="prefetch" href="/assets/js/27.1a5b1c26.js"><link rel="prefetch" href="/assets/js/28.51c28132.js"><link rel="prefetch" href="/assets/js/29.df08e2dc.js"><link rel="prefetch" href="/assets/js/30.ba1f0a8d.js"><link rel="prefetch" href="/assets/js/31.10698ecc.js"><link rel="prefetch" href="/assets/js/32.c62a8944.js"><link rel="prefetch" href="/assets/js/33.0c12dd81.js"><link rel="prefetch" href="/assets/js/34.270c4c83.js"><link rel="prefetch" href="/assets/js/35.9d47726d.js"><link rel="prefetch" href="/assets/js/36.2570c124.js"><link rel="prefetch" href="/assets/js/37.99106624.js"><link rel="prefetch" href="/assets/js/38.5bc67747.js"><link rel="prefetch" href="/assets/js/39.caca6fc0.js"><link rel="prefetch" href="/assets/js/4.45f7d4b0.js"><link rel="prefetch" href="/assets/js/40.5f6ecbf4.js"><link rel="prefetch" href="/assets/js/41.1ac9ba29.js"><link rel="prefetch" href="/assets/js/42.25831dc8.js"><link rel="prefetch" href="/assets/js/43.790a4af5.js"><link rel="prefetch" href="/assets/js/44.7bb4c4d6.js"><link rel="prefetch" href="/assets/js/45.c7a205b3.js"><link rel="prefetch" href="/assets/js/46.1c392480.js"><link rel="prefetch" href="/assets/js/47.cd1928d6.js"><link rel="prefetch" href="/assets/js/48.fbbc43d5.js"><link rel="prefetch" href="/assets/js/49.c2647c61.js"><link rel="prefetch" href="/assets/js/5.f5664d7c.js"><link rel="prefetch" href="/assets/js/50.de4915a6.js"><link rel="prefetch" href="/assets/js/51.36a0f3d8.js"><link rel="prefetch" href="/assets/js/52.5bb27189.js"><link rel="prefetch" href="/assets/js/53.6355c81e.js"><link rel="prefetch" href="/assets/js/54.815f4877.js"><link rel="prefetch" href="/assets/js/55.6a599773.js"><link rel="prefetch" href="/assets/js/56.16348509.js"><link rel="prefetch" href="/assets/js/57.1ebe2526.js"><link rel="prefetch" href="/assets/js/58.5da2cf8f.js"><link rel="prefetch" href="/assets/js/59.9d7c85b0.js"><link rel="prefetch" href="/assets/js/6.db7cc03d.js"><link rel="prefetch" href="/assets/js/60.1cd6226b.js"><link rel="prefetch" href="/assets/js/61.f8d6a4cf.js"><link rel="prefetch" href="/assets/js/62.9e41bba7.js"><link rel="prefetch" href="/assets/js/63.c3032fd5.js"><link rel="prefetch" href="/assets/js/64.f34037da.js"><link rel="prefetch" href="/assets/js/65.c45aa02f.js"><link rel="prefetch" href="/assets/js/66.2f46bd50.js"><link rel="prefetch" href="/assets/js/67.5c9c3e90.js"><link rel="prefetch" href="/assets/js/68.c61489b2.js"><link rel="prefetch" href="/assets/js/69.0bd9f6a2.js"><link rel="prefetch" href="/assets/js/7.e1b95a34.js"><link rel="prefetch" href="/assets/js/70.d74f9a65.js"><link rel="prefetch" href="/assets/js/71.910c2184.js"><link rel="prefetch" href="/assets/js/8.3832550c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b2910093.js">
    <link rel="stylesheet" href="/assets/css/0.styles.296af3c4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="繁华中自律，落魄中自愈" class="logo"> <span class="site-name can-hide">繁华中自律，落魄中自愈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/FrontEnd/" class="nav-link">前端知识库</a></div><div class="nav-item"><a href="/BackEnd/" class="nav-link">后端知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/bingbing.jpg"> <div class="blogger-info"><h3>石怜安</h3> <span>在线找大长腿小姐姐</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/FrontEnd/" class="nav-link">前端知识库</a></div><div class="nav-item"><a href="/BackEnd/" class="nav-link">后端知识库</a></div><div class="nav-item"><a href="/DesignPattern/" class="nav-link">设计模式</a></div><div class="nav-item"><a href="/Algorithm/Dichotomy/" class="nav-link">常用算法</a></div><div class="nav-item"><a href="/Git/" class="nav-link">Git</a></div><div class="nav-item"><a href="/Server/" class="nav-link">服务器</a></div><div class="nav-item"><a href="/Performance/" class="nav-link">性能优化</a></div><div class="nav-item"><a href="/Recommend/" class="nav-link">推荐</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=FrontEnd" title="分类" data-v-1baff76c>FrontEnd</a></li><li data-v-1baff76c><a href="/categories/?category=Network" title="分类" data-v-1baff76c>Network</a></li><li data-v-1baff76c><a href="/categories/?category=BrowserCache" title="分类" data-v-1baff76c>BrowserCache</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="404" target="_blank" title="作者" class="beLink" data-v-1baff76c>JSH</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-06-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="/bingbing.jpg">浏览器缓存<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h1> <p><strong>我们把浏览器缓存问题拆分下，可以从以下几个方面来回答这个问题:</strong></p> <ul><li>缓存的类型 (强缓存or协商缓存)</li> <li>缓存位置 (Service Worker、Memory Cache...)</li> <li>缓存过程分析</li> <li>缓存策略的实际场景应用</li></ul> <h2 id="缓存的类型"><a href="#缓存的类型" class="header-anchor">#</a> 缓存的类型</h2> <p>首先从缓存的类型上来说，可以分为两种: <strong>强缓存</strong> 与 <strong>协商缓存</strong></p> <p>强缓存是<strong>不需要发送HTTP请求的，而协商缓存需要</strong></p> <p>也就是在发送HTTP请求之前，浏览器会先检查一下强缓存，如果命中直接使用，否则就进入下一步。</p> <h3 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h3> <p>浏览器检查强缓存的方式主要是判断这两个字段:</p> <ul><li>HTTP/1.0时期使用的是Expires;</li> <li>HTTP/1.1使用的是Cache-Control;</li></ul> <h4 id="expires"><a href="#expires" class="header-anchor">#</a> Expires</h4> <p>Expires字面意思是 有效期，那么很好理解，它表示的就是一个具体的时间</p> <p>例如:</p> <div class="language-http request extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Expires</span><span class="token punctuation">:</span> <span class="token header-value">Wed，Nov 11 2020 08:00:00 GMT</span></span>
</code></pre></div><p>表示的就是这个资源在2020年11月11日8点过期，到了过期时间了就得向服务端发请求了。</p> <p>很有意思的是，若是设置了Expires，但是服务器的时间与浏览器的时间不一致的时候(比如你手动修改了本地的时间)，那么就可能会造成缓存失效，因此这种方式强缓存方式并不是很准确，它也因此在HTTP/1。1中被摒弃了。</p> <h4 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h4> <p>摒弃了Expires之后，HTTP/1。1采用了Cache-Control这个重要的规则。<br>
它设置的是一个具体的过期时长，其中的一个属性是max-age。</p> <p>例如🌰:</p> <div class="language-http request extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=300</span></span>
</code></pre></div><p>表示的是这个资源在响应之后的300s内过期，也就是5分钟之内再次获取这个资源会直接使用缓存。</p> <p>Cache-Control不仅仅有max-age 这一个属性，其实它有很多的用法，你甚至可以采用组合的方式:</p> <div class="language-http request extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">public,max-age=300</span></span>
</code></pre></div><p>上面用法的意思是响应可以被任何对象(客户端，代理服务器等)缓存，且过期时长为5分钟。
(因为一个请求经历的不仅仅是客户端(浏览器)和目标服务器，它中间有可能会经过不同的代理服务器)</p> <p>下面来例举一些常用的指令:</p> <ul><li>public: 客户端和代理服务器都可以缓存。</li></ul> <blockquote><p>响应可以被中间任何的一个节点缓存，比如一个请求要经历 Browser -&gt; proxy1 -&gt; proxy2 -&gt; Server，中间的代理(proxy)可以缓存资源。 下次再请求同一资源的时候，浏览器就会直接到proxy1中拿缓存的东西而不必向proxy2拿。</p></blockquote> <ul><li>private: 这个是Cache-Control默认的取值，只有客户端可以缓存，中间节点不允许缓存。</li></ul> <blockquote><p>在 Browser -&gt; proxy1 -&gt; proxy2 -&gt; Server 这个过程中，代理(proxy)不会缓存任何数据，当Browser再次请求时，proxy会把Server返回的数据发送给Brower，做好请求转发，而不是给自己缓存的数据。</p></blockquote> <ul><li>no-cache: 表示不进行强缓存验证，而是用协商缓存来验证。</li> <li>no-store: 所有内容都不会被缓存，不进行强缓存，也不进行协商缓存。</li> <li>max-age: 表示在多久之后过期，比如max-age=300表示在300s后缓存内容失效。</li> <li>s-max-age: 它的作用和max-age很像， 不过max-age 用于普通缓存，而s-max-age用于代理缓存，且s-max-age的优先级更高。</li> <li>max-stale: 能容忍的最大过期时间。</li></ul> <blockquote><p>max-stale指令表示客户端愿意接收一个已经过期了的响应。</p></blockquote> <ul><li>min-fresh：能够容忍的最小新鲜度。</li></ul> <blockquote><p>min-fresh表示客户端不愿意接受新鲜度不多于当前的age加上min-fresh设定的时间之和的响应。</p></blockquote> <p>基于上面的这些指令，我们可以将它们进行组合，达到多个目的， 不同的效果。
有一张来自<a href="https://www.jianshu.com/p/54cc04190252" target="_blank" rel="noopener noreferrer">《浪里行舟-深入理解浏览器的缓存机制》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的图表述的非常好:</p> <img src="/assets/img/001.7c84b41d.jpg"> <h4 id="expires和cache-control的对比"><a href="#expires和cache-control的对比" class="header-anchor">#</a> Expires和Cache-control的对比</h4> <ul><li>Expires产于HTTP/1。0，Cache-control产于HTTP/1。1;</li> <li>Expires设置的是一个具体的时间，Cache-control 可以设置具体时常还有其它的属性;</li> <li>两者同时存在，Cache-control的优先级更高;</li> <li>在不支持HTTP/1。1的环境下，Expires就会发挥作用，所以先阶段的存在是为了做一些兼容的处理。</li></ul> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>在上面我们已经介绍了强缓存，它是不需要发送HTTP请求的，若是强缓存失效，则会进入协商缓存。</p> <p>协商缓存概括来说 就是浏览器会携带缓存标识(tag)向服务器发送请求，服务器会根据缓存标识(tag)来决定是否使用缓存。</p> <p>所以对于服务器的返回结果会有这两种情况:</p> <ul><li>协商缓存生效，返回304和Not Modified(空的响应体)</li> <li>协商缓存失效，返回200和请求结果</li></ul> <p>而刚刚提到的这个缓存标识(tag)也是有两种。</p> <p>分为Last-Modified和 ETag。</p> <h4 id="last-modified-和-if-modified-since"><a href="#last-modified-和-if-modified-since" class="header-anchor">#</a> Last-Modified 和 If-Modified-Since</h4> <p>从字面意思上我们可以看出，Last-Modified表示的是资源的最后修改时间，因此其中一种协商缓存判断的就是最后修改时间。</p> <p>那它具体是怎样实现的呢?</p> <p>其实使用Last-Modified进行协商缓存会经过以下几步:</p> <ol><li>浏览器第一次向服务器请求这个资源</li> <li>服务器在返回这个资源的时候，在response header中添加Last-Modified的header，值为该资源在服务器上最后的修改时间</li> <li>浏览器接收到后缓存文件和这个header</li> <li>当下次浏览器再次请求这个资源的时候， 检测到有Last-Modified这个header，就会在请求头中添加If-Modified-Since这个header，该值就是Last-Modified</li> <li>服务器再次接收到该资源的请求，则根据If-Modified-Since与服务器中的这个资源的最后修改时间做对比</li> <li>对比结果相同则返回304和一个空的响应体，告诉浏览器从自己(浏览器)的缓存中拿</li> <li>对比结果不同(If-Modified-Since &lt; 服务器资源最后修改时间)，则表示资源被修改了，则返回200和最新的资源文件(当然还包括最新的Last-Modefied)</li></ol> <img src="/assets/img/002.695ee881.jpg"> <h4 id="etag-与-if-none-match"><a href="#etag-与-if-none-match" class="header-anchor">#</a> ETag 与 If-None-Match</h4> <p>ETag其实与Last-Modefied的原理差不多，不过它不是根据资源的最后修改时间来判断的，而是通过一个唯一的标识。</p> <p>在浏览器请求服务器资源的时候，服务器会根据当前文件的内容，给文件生成一个唯一的标识，若是文件发生了改变，则这个标识就会改变。</p> <p>服务器会将这个标识ETag放到响应体的header中与请求的资源一起返回给浏览器，而浏览器同样也会缓存文件与这个header。</p> <p>在下一次再次加载该资源时，浏览器会将刚刚缓存的ETag放到请求体头部(request header)的If-None-Match里发送给服务器。</p> <p>同样的服务器接收到了之后与该资源自身的ETag做对比，如果一致，则表示该资源未发生改变，则直接返回304知会客户端直接使用本地缓存即可。 若是不一致，则返回200和最新的资源文件(当然还包括最新的ETag)</p> <p>如下图:</p> <img src="/assets/img/003.c92ce5d6.jpg"> <h4 id="两者对比"><a href="#两者对比" class="header-anchor">#</a> 两者对比</h4> <p>在进行对比之前，我们先来看看两者都有什么优缺点呢?</p> <p>首先对于Last-Modified:</p> <ul><li>若是本地打开了缓存文件，并没有进行修改，也还是会改变最后修改时间，导致缓存失败;</li> <li>由于Last-Modified是以秒来计时的，若是某个文件在一秒内被修改了很多次，那么这时候的 Last-Modified 并没有体现出修改了。</li></ul> <p>然后对于ETag:</p> <ul><li>性能上的不足,只要文件发生改变,ETag就会发生改变。  ETag需要服务器通过算法来计算出一个hash值。</li></ul> <p><strong>总结，所以对于两种协商缓存:</strong></p> <ul><li>准确度上ETag更强;</li> <li>性能上Last-Modified更好;</li> <li>两者都支持的话，ETag优先级更高。</li></ul> <h2 id="缓存位置"><a href="#缓存位置" class="header-anchor">#</a> 缓存位置</h2> <p>在上面我们已经介绍完了缓存的类型，但是之前也提到过了，若是命中了强缓存或者服务器返回了304之后，
要浏览器从缓存中过去资源，那这些缓存具体是存储在哪里呢?</p> <p>从优先级上来说分为以下四种:</p> <ul><li>Service Worker</li> <li>Memory Cache</li> <li>Disk Cache</li> <li>Push Cache</li></ul> <h3 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> Service Worker</h3> <p>Service Worker是运行在浏览器背后的独立线程，也就是说它脱离了浏览器的窗体，无法直接访问DOM。
功能上主要是能实现: 离线缓存、消息推送、网络代理等。比如离线缓存就是Service Worker Cache。</p> <p>简单来说，它有以下几个特点:</p> <ul><li>借鉴了Web Worker的思路</li> <li>使用Service Worker会涉及到请求拦截，所以需要用HTTPS协议来保证安全，传输协议必须是HTTPS</li> <li>与浏览器其它内建的缓存机制不同，它可以让我们自由的控制缓存哪些文件、如何匹配读取缓存，且缓存是持续性的</li> <li>Service Worker同时也是PWA的重要实现机制</li></ul> <h3 id="memory-cache"><a href="#memory-cache" class="header-anchor">#</a> Memory Cache</h3> <p>从命名上来说，Memory Cache就是内存中的缓存，存储的主要是当前页面已经抓取到的资源，
比如页面上已经下载的样式、脚本、图片等。</p> <p>Memory Cache的特点:</p> <ul><li>读取效率快，可是缓存持续时间短，会随着进程的释放而释放(一旦关闭Tab页面，就被释放了，还有可能在没关闭之前，排在前面的缓存就失效了，例如一个页面的缓存占用了超级多的内存)</li> <li>几乎所有的请求资源都能进入memory Cache，细分来说主要分为preloader和preload这两块。</li> <li>在从memory Cache读取缓存时，浏览器会忽视Cache-Control中的一些max-age、no-cache等头部配置，除非设置了no-store这个头部配置。</li></ul> <p><strong>preloader</strong></p> <p>上面提到的preloader是页面优化的常见手段之一，它的作用主要是用于在浏览器打开一个网页的时候,能够一边解析执行js/css，一边去请求下一个资源，而这些被 preloader 请求来的资源就会被放入 memory Cache 中，供之后的解析执行操作使用。</p> <p><strong>preload</strong></p> <p>preload与preloader仅两个字母之差，它能显式指定预加载的资源，这些资源也会被放进memory Cache中，例如<link rel="preload"></p> <h3 id="disk-cache"><a href="#disk-cache" class="header-anchor">#</a> Disk Cache</h3> <p>Disk Cache，也叫做HTTP Cache，是存储在硬盘上的缓存，所以它是持久存储，是实际存在于文件系统中的。</p> <p>从存储效率上说，它比内存缓存慢，但是优势在于存储容量更大，且存储时长更长。</p> <p>在所有浏览器缓存中，Disk Cache是覆盖面最大的。 它会根据前面我们提到的HTTP header中的缓存字段来判断哪些资源需要缓存，哪些资源不需要请求而直接使用，哪些已经过期了需要重新请求获取。</p> <p>若是命中了缓存之后，浏览器会从硬盘中直接读取资源，虽然没有从内存中读取的快，但是却是比网络缓存快。</p> <p>前面提到的强缓存和协商缓存也是属于Disk Cache，它们最终都存储在硬盘里。</p> <p><strong>Memory Cache与Disk Cache两者的对比:</strong></p> <ul><li>比较大的JS、CSS文件会被丢硬盘中存储，反之则存储在内存中</li> <li>当前系统内存使用率比较高的时候，文件优先进入磁盘</li></ul> <h3 id="push-cache"><a href="#push-cache" class="header-anchor">#</a> Push Cache</h3> <p>Push Cache(推送缓存)，它是浏览器缓存的最后一段防线，当以上三种缓存都没有命中的时候，它才会被使用。</p> <p>我所知道的，它只会在会话(Session)中存在，一旦会话结束它就会被释放，并且缓存时间也很短暂，在Chrome浏览器中只有5分钟。</p> <p>另外由于它是 HTTP/2 中的内容，因此在国内不是很普及，这里贴上一个比较好的总结:</p> <ul><li>所有的资源都能被推送，并且能够被缓存,但是 Edge 和 Safari 浏览器支持相对比较差</li> <li>可以推送 no-cache 和 no-store 的资源</li> <li>一旦连接被关闭，Push Cache 就被释放</li> <li>多个页面可以使用同一个HTTP/2的连接，也就可以使用同一个Push Cache。这主要还是依赖浏览器的实现而定，出于对性能的考虑，有的浏览器会对相同域名但不同的tab标签使用同一个HTTP连接。</li> <li>Push Cache 中的缓存只能被使用一次</li> <li>浏览器可以拒绝接受已经存在的资源推送</li> <li>你可以给其他域名推送资源</li></ul> <h2 id="缓存过程分析"><a href="#缓存过程分析" class="header-anchor">#</a> 缓存过程分析</h2> <p>上面已经向大家介绍了缓存类型已经缓存的位置，那么浏览器具体的一个缓存行径是怎样的呢?</p> <p>从浏览器发起HTTP请求到获得请求结果，可以分为以下几个过程:</p> <ol><li>浏览器第一次发起HTTP请求，在浏览器缓存中没有发现请求的缓存结果和缓存标识</li> <li>因此向服务器发起HTTP请求，获得该请求的结果还有缓存规则(也就是Last-Modified 或者ETag)</li> <li>浏览器把响应内容存入Disk Cache，把响应内容的引用存入Memory Cache</li> <li>把响应内容存入 Service Worker 的 Cache Storage (如果 Service Worker 的脚本调用了 cache.put())</li></ol> <p>下一次请求相同资源的时候:</p> <ol><li>调用Service Worker 的fetch事件响应</li> <li>查看memory Cache</li> <li>查看disk Cache。 这里细分为:</li></ol> <blockquote><p>有强缓存且未失效，则使用强缓存，不请求服务器，返回的状态码都是200
有强缓存且已失效，使用协商缓存判断，是返回304还是200(读取缓存还是重新获取)</p></blockquote> <h2 id="缓存策略的实际场景应用"><a href="#缓存策略的实际场景应用" class="header-anchor">#</a> 缓存策略的实际场景应用</h2> <p>说了这么多缓存策略，那么在实际使用上来说，我们一般是怎样使用它的呢?</p> <p><strong>不常变化的资源</strong></p> <p>对于不常变化的资源:</p> <div class="language-http request extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=31536000</span></span>
</code></pre></div><p>通常是给Cache-Control设置成一个很大的值，(31536000，一年)。 这个也很好理解，不常变化的资源，直接让它使用缓存就是了。</p> <p>但是有时候为了解决更新的问题，我们需要在文件名中添加上hash，版本号等动态字段，这样就达到了更改引用URL 的目的。</p> <p><strong>常变化的资源</strong></p> <p>经常变化的资源，我们进行以下配置:</p> <div class="language-http request extra-class"><pre class="language-http"><code><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">no-cache</span></span>
</code></pre></div><p>设置成以上配置，使得浏览器每次都请求服务器，然后配合ETag或者Last-Modified来验证资源是否有效。</p> <h2 id="后语"><a href="#后语" class="header-anchor">#</a> 后语</h2> <p>浏览器缓存的内容其实还有很多可以说的，这里主要是总结了一些面试时常问到的，你可以转化成自己的言语来回答面试官。</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E7%BC%93%E5%AD%98" title="标签">#缓存</a></div> <div class="last-updated"><span class="prefix">最近更新时间:</span> <span class="time">2022/6/1 16:30:10</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/SkillPoint/@Hook/"><div>
            父组件里监听子组件的生命周期
            <!----></div></a> <span class="date">06-14</span></dt></dl><dl><dd>02</dd> <dt><a href="/SkillPoint/Context/"><div>
            上下文批量引入
            <!----></div></a> <span class="date">06-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/SkillPoint/LazyComponent/"><div>
            组件懒加载
            <!----></div></a> <span class="date">06-14</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="String" title="1051131737" target="_blank" class="iconfont icon-QQ"></a><a href="String" title="1051131737@qq.com" target="_blank" class="iconfont icon-youjian"></a><a href="String" title="jsh1051131737" target="_blank" class="iconfont icon-weixin"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>JSH</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><!----><!----><div></div><div></div></div></div>
    <script src="/assets/js/app.0fce6bc4.js" defer></script><script src="/assets/js/3.112caaf3.js" defer></script><script src="/assets/js/12.195031a5.js" defer></script><script src="/assets/js/20.e3cfb8e1.js" defer></script><script src="/assets/js/9.6fa6f9fb.js" defer></script>
  </body>
</html>
